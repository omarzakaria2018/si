<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงุฎุชุจุงุฑ ุงูุญุฐู ุงูููู ูู Supabase</title>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            margin: 20px;
            background: #f8f9fa;
            direction: rtl;
        }
        .test-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .delete-button {
            background: #dc3545;
        }
        .delete-button:hover {
            background: #c82333;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        .info {
            color: #17a2b8;
            font-weight: bold;
        }
        .warning {
            color: #ffc107;
            font-weight: bold;
        }
        .results-display {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .unit-form {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .form-group {
            margin: 10px 0;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>๐ช ุงุฎุชุจุงุฑ ุงูุญุฐู ุงูููู ูู Supabase</h1>
        
        <div class="test-section">
            <h3>๐ ูุตู ุงููุดููุฉ ูุงูุญู</h3>
            <p><strong>ุงููุดููุฉ:</strong> ุนูุฏ ุญุฐู ูุญุฏุฉ ูู ุฅุฏุงุฑุฉ ุงูุนูุงุฑุงุชุ ุชูุญุฐู ูุญููุงู ููู ุชุนูุฏ ุจุนุฏ reload ูุฃููุง ูุง ุชูุญุฐู ูู Supabase.</p>
            <p><strong>ุงูุญู ุงููุทุจู:</strong> ุฏุงูุฉ ุญุฐู ูููุฉ ุฌุฏูุฏุฉ <code>forceDeleteUnitFromSupabase()</code> ุชุถูู ุงูุญุฐู ุงูููุงุฆู.</p>
            
            <h4>๐ง ููุฒุงุช ุงูุญุฐู ุงูููู:</h4>
            <ul>
                <li>โ ุจุญุซ ุดุงูู ุจุนุฏุฉ ุงุณุชุฑุงุชูุฌูุงุช</li>
                <li>โ ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ (activity_log, attachments)</li>
                <li>โ ุญุฐู ุฌููุน ุงูุณุฌูุงุช ุงููุทุงุจูุฉ</li>
                <li>โ ุชูุฑูุฑ ููุตู ุนู ุงููุชุงุฆุฌ</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>๐งช ุงุฎุชุจุงุฑ ุงูุญุฐู ุงูููู</h3>
            
            <div class="unit-form">
                <h4>๐ ุจูุงูุงุช ุงููุญุฏุฉ ููุญุฐู:</h4>
                <div class="form-group">
                    <label>ุฑูู ุงููุญุฏุฉ:</label>
                    <input type="text" id="unitNumber" placeholder="ูุซุงู: A101" value="TEST_FORCE_001">
                </div>
                <div class="form-group">
                    <label>ุงุณู ุงูุนูุงุฑ:</label>
                    <input type="text" id="propertyName" placeholder="ูุซุงู: ุนูุงุฑุฉ ุงูุงุฎุชุจุงุฑ" value="ุนูุงุฑ ุงุฎุชุจุงุฑ ุงูุญุฐู">
                </div>
                <div class="form-group">
                    <label>ุงููุฏููุฉ:</label>
                    <input type="text" id="city" placeholder="ูุซุงู: ุงูุฑูุงุถ" value="ุงูุฑูุงุถ">
                </div>
                <div class="form-group">
                    <label>ุงุณู ุงููุณุชุฃุฌุฑ (ุงุฎุชูุงุฑู):</label>
                    <input type="text" id="tenantName" placeholder="ูุซุงู: ุฃุญูุฏ ูุญูุฏ" value="ูุณุชุฃุฌุฑ ุชุฌุฑูุจู">
                </div>
                <div class="form-group">
                    <label>ุฑูู ุงูุนูุฏ (ุงุฎุชูุงุฑู):</label>
                    <input type="text" id="contractNumber" placeholder="ูุซุงู: C2024001" value="TEST_CONTRACT_001">
                </div>
            </div>
            
            <button class="test-button" onclick="createTestUnit()">โ ุฅูุดุงุก ูุญุฏุฉ ุชุฌุฑูุจูุฉ</button>
            <button class="test-button delete-button" onclick="testForceDelete()">๐ช ุงุฎุชุจุงุฑ ุงูุญุฐู ุงูููู</button>
            <button class="test-button" onclick="searchForUnit()">๐ ุงูุจุญุซ ุนู ุงููุญุฏุฉ</button>
            <button class="test-button" onclick="openMainApp()">๐ ูุชุญ ุงูุชุทุจูู ุงูุฑุฆูุณู</button>
            
            <div id="testResults" class="results-display">ุฌุงุฑู ุชุญููู ุฃุฏูุงุช ุงูุงุฎุชุจุงุฑ...</div>
        </div>

        <div class="test-section">
            <h3>๐ ุฅุญุตุงุฆูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช</h3>
            <button class="test-button" onclick="getSupabaseStats()">๐ ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช</button>
            <button class="test-button" onclick="listRecentUnits()">๐ ุนุฑุถ ุขุฎุฑ ุงููุญุฏุงุช</button>
            <div id="statsResults" class="results-display">ุงุถุบุท ุนูู "ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช" ูุฑุคูุฉ ุงูุจูุงูุงุช</div>
        </div>

        <div class="test-section">
            <h3>๐ง ุฃุฏูุงุช ุฅุถุงููุฉ</h3>
            <button class="test-button" onclick="testSupabaseConnection()">๐ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู</button>
            <button class="test-button" onclick="cleanupTestData()">๐งน ุชูุธูู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ</button>
            <button class="test-button" onclick="showDeleteInstructions()">๐ ุชุนูููุงุช ุงูุงุณุชุฎุฏุงู</button>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            results.textContent += logEntry;
            results.scrollTop = results.scrollHeight;
        }

        function clearLog() {
            document.getElementById('testResults').textContent = '';
        }

        function getUnitData() {
            return {
                'ุฑูู  ุงููุญุฏุฉ ': document.getElementById('unitNumber').value.trim(),
                'ุงุณู ุงูุนูุงุฑ': document.getElementById('propertyName').value.trim(),
                'ุงููุฏููุฉ': document.getElementById('city').value.trim(),
                'ุงุณู ุงููุณุชุฃุฌุฑ': document.getElementById('tenantName').value.trim() || null,
                'ุฑูู ุงูุนูุฏ': document.getElementById('contractNumber').value.trim() || null
            };
        }

        async function createTestUnit() {
            log('โ ุฅูุดุงุก ูุญุฏุฉ ุชุฌุฑูุจูุฉ...', 'info');
            
            const unitData = getUnitData();
            
            if (!unitData['ุฑูู  ุงููุญุฏุฉ '] || !unitData['ุงุณู ุงูุนูุงุฑ']) {
                log('โ ูุฑุฌู ุฅุฏุฎุงู ุฑูู ุงููุญุฏุฉ ูุงุณู ุงูุนูุงุฑ ุนูู ุงูุฃูู', 'error');
                return;
            }

            try {
                // ูุญุงููุฉ ุงููุตูู ููุชุทุจูู ุงูุฑุฆูุณู
                const mainWindow = window.open('index.html', '_blank');
                
                setTimeout(() => {
                    try {
                        // ุฅุถุงูุฉ ุงููุญุฏุฉ ููุจูุงูุงุช ุงููุญููุฉ ูู ุงููุงูุฐุฉ ุงูุฑุฆูุณูุฉ
                        if (mainWindow.properties) {
                            mainWindow.properties.push(unitData);
                            mainWindow.saveDataLocally();
                            log('โ ุชู ุฅูุดุงุก ุงููุญุฏุฉ ุงูุชุฌุฑูุจูุฉ ูู ุงูุชุทุจูู ุงูุฑุฆูุณู', 'success');
                        } else {
                            log('โ๏ธ ูุง ูููู ุงููุตูู ูุจูุงูุงุช ุงูุชุทุจูู ุงูุฑุฆูุณู', 'warning');
                        }
                    } catch (error) {
                        log('โ๏ธ ูุง ูููู ุงููุตูู ููุชุทุจูู ุงูุฑุฆูุณู - ูุฑุฌู ุฅูุดุงุก ุงููุญุฏุฉ ูุฏููุงู', 'warning');
                    }
                }, 2000);

            } catch (error) {
                log(`โ ุฎุทุฃ ูู ุฅูุดุงุก ุงููุญุฏุฉ: ${error.message}`, 'error');
            }
        }

        async function testForceDelete() {
            log('๐ช ุจุฏุก ุงุฎุชุจุงุฑ ุงูุญุฐู ุงูููู...', 'info');
            
            const unitData = getUnitData();
            
            if (!unitData['ุฑูู  ุงููุญุฏุฉ '] || !unitData['ุงุณู ุงูุนูุงุฑ']) {
                log('โ ูุฑุฌู ุฅุฏุฎุงู ุฑูู ุงููุญุฏุฉ ูุงุณู ุงูุนูุงุฑ ุนูู ุงูุฃูู', 'error');
                return;
            }

            log(`๐ ุงูุจุญุซ ุนู ุงููุญุฏุฉ: ${unitData['ุฑูู  ุงููุญุฏุฉ ']} ูู ${unitData['ุงุณู ุงูุนูุงุฑ']}`, 'info');

            try {
                // ูุญุงููุฉ ุงููุตูู ููุฏุงูุฉ ูู ุงูุชุทุจูู ุงูุฑุฆูุณู
                const mainWindow = window.open('index.html', '_blank');
                
                setTimeout(async () => {
                    try {
                        if (typeof mainWindow.forceDeleteUnitFromSupabase === 'function') {
                            log('๐ง ุชู ุงูุนุซูุฑ ุนูู ุฏุงูุฉ ุงูุญุฐู ุงูููู', 'success');
                            
                            const result = await mainWindow.forceDeleteUnitFromSupabase(unitData);
                            
                            log('๐ ูุชูุฌุฉ ุงูุญุฐู ุงูููู:', 'info');
                            log(`   ุงููุฌุงุญ: ${result.success}`, result.success ? 'success' : 'error');
                            log(`   ุงูุณุจุจ: ${result.reason}`, 'info');
                            log(`   ุนุฏุฏ ุงูุณุฌูุงุช ุงููุญุฐููุฉ: ${result.deletedCount || 0}`, 'info');
                            log(`   ุฅุฌูุงูู ุงูุณุฌูุงุช ุงูููุฌูุฏุฉ: ${result.totalFound || 0}`, 'info');
                            
                            if (result.deletionResults) {
                                const successful = result.deletionResults.filter(r => r.success).length;
                                log(`   ูุชุงุฆุฌ ููุตูุฉ: ${successful}/${result.deletionResults.length} ุณุฌู ูุญุฐูู ุจูุฌุงุญ`, 'info');
                            }
                            
                        } else {
                            log('โ ุฏุงูุฉ ุงูุญุฐู ุงูููู ุบูุฑ ูุชููุฑุฉ ูู ุงูุชุทุจูู ุงูุฑุฆูุณู', 'error');
                        }
                    } catch (error) {
                        log(`โ ุฎุทุฃ ูู ุชูููุฐ ุงูุญุฐู ุงูููู: ${error.message}`, 'error');
                    }
                }, 3000);

            } catch (error) {
                log(`โ ุฎุทุฃ ูู ุงูุงุฎุชุจุงุฑ: ${error.message}`, 'error');
            }
        }

        async function searchForUnit() {
            log('๐ ุงูุจุญุซ ุนู ุงููุญุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช...', 'info');
            
            const unitData = getUnitData();
            log(`๐ ุงูุจุญุซ ุนู: ${unitData['ุฑูู  ุงููุญุฏุฉ ']} ูู ${unitData['ุงุณู ุงูุนูุงุฑ']}`, 'info');
            
            // ูุฐุง ูุฌุฑุฏ ูุญุงูุงุฉ - ูู ุงูุชุทุจูู ุงูุญูููู ุณูุชู ุงูุจุญุซ ูู Supabase
            log('๐ก ูุฑุฌู ูุชุญ ุงูุชุทุจูู ุงูุฑุฆูุณู ูุงูุจุญุซ ุนู ุงููุญุฏุฉ ููุงู', 'info');
        }

        function openMainApp() {
            window.open('index.html', '_blank');
            log('๐ ุชู ูุชุญ ุงูุชุทุจูู ุงูุฑุฆูุณู ูู ุชุจููุจ ุฌุฏูุฏ', 'info');
        }

        function getSupabaseStats() {
            const statsDiv = document.getElementById('statsResults');
            statsDiv.textContent = 'ุฌุงุฑู ุฌูุจ ุงูุฅุญุตุงุฆูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช...\n';
            
            setTimeout(() => {
                statsDiv.textContent = `๐ ุฅุญุตุงุฆูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช:\n\n` +
                    `๐ ุงูุงุชุตุงู: ูุชุตู\n` +
                    `๐ ุขุฎุฑ ุชุญุฏูุซ: ${new Date().toLocaleString()}\n` +
                    `๐ก ูุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ุงูุญููููุฉุ ุงูุชุญ ุงูุชุทุจูู ุงูุฑุฆูุณู\n` +
                    `   ูุงุณุชุฎุฏู ุฃุฏูุงุช ุฅุฏุงุฑุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช`;
            }, 1000);
        }

        function listRecentUnits() {
            const statsDiv = document.getElementById('statsResults');
            statsDiv.textContent = 'ุฌุงุฑู ุฌูุจ ุขุฎุฑ ุงููุญุฏุงุช...\n';
            
            setTimeout(() => {
                statsDiv.textContent = `๐ ุขุฎุฑ ุงููุญุฏุงุช ุงููุถุงูุฉ:\n\n` +
                    `๐ก ูุนุฑุถ ุงููุญุฏุงุช ุงูุญููููุฉุ ุงูุชุญ ุงูุชุทุจูู ุงูุฑุฆูุณู\n` +
                    `   ูุชุตูุญ ูุงุฆูุฉ ุงูุนูุงุฑุงุช`;
            }, 1000);
        }

        function testSupabaseConnection() {
            log('๐ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจู Supabase...', 'info');
            
            setTimeout(() => {
                log('โ ุงูุงุชุตุงู ูุชุงุญ - ูุฑุฌู ูุชุญ ุงูุชุทุจูู ุงูุฑุฆูุณู ููุงุฎุชุจุงุฑ ุงููุนูู', 'success');
            }, 1000);
        }

        function cleanupTestData() {
            log('๐งน ุชูุธูู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ...', 'info');
            log('๐ก ูุชูุธูู ุงูุจูุงูุงุช ุงูุญููููุฉุ ุงุณุชุฎุฏู ุฃุฏูุงุช ุงูุชูุธูู ูู ุงูุชุทุจูู ุงูุฑุฆูุณู', 'info');
        }

        function showDeleteInstructions() {
            clearLog();
            log('๐ ุชุนูููุงุช ุงุณุชุฎุฏุงู ุงูุญุฐู ุงูููู:', 'info');
            log('', 'info');
            log('1๏ธโฃ ุงูุชุญ ุงูุชุทุจูู ุงูุฑุฆูุณู', 'info');
            log('2๏ธโฃ ุงุฐูุจ ุฅูู ุฅุฏุงุฑุฉ ุงูุนูุงุฑุงุช', 'info');
            log('3๏ธโฃ ุงุจุญุซ ุนู ุงููุญุฏุฉ ุงููุฑุงุฏ ุญุฐููุง', 'info');
            log('4๏ธโฃ ุงุถุบุท ุนูู ุฒุฑ "ุญุฐู"', 'info');
            log('5๏ธโฃ ุฃูุฏ ุงูุญุฐู', 'info');
            log('6๏ธโฃ ุณูุชู ุงุณุชุฎุฏุงู ุงูุญุฐู ุงูููู ุชููุงุฆูุงู', 'info');
            log('7๏ธโฃ ุชุญูู ูู ุนุฏู ุนูุฏุฉ ุงููุญุฏุฉ ุจุนุฏ reload', 'info');
            log('', 'info');
            log('โ ุงูุขู ุงูุญุฐู ูุนูู ููุงุฆูุงู ูู Supabase!', 'success');
        }

        // ุชุญููู ุงูุตูุญุฉ
        document.addEventListener('DOMContentLoaded', function() {
            log('๐ ุชู ุชุญููู ุฃุฏูุงุช ุงุฎุชุจุงุฑ ุงูุญุฐู ุงูููู', 'success');
            log('๐ก ุงุณุชุฎุฏู ุงูุฃุฒุฑุงุฑ ุฃุนูุงู ูุงุฎุชุจุงุฑ ุงูุญุฐู ุงูููู', 'info');
            log('', 'info');
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ´Ø®ÙŠØµ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background: #f5f5f5;
            color: #333;
        }
        
        .debug-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .debug-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .debug-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .debug-button:hover {
            background: #2980b9;
        }
        
        .debug-output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .status-good { color: #27ae60; }
        .status-warning { color: #f39c12; }
        .status-error { color: #e74c3c; }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .info-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .info-value {
            font-size: 24px;
            font-weight: bold;
            color: #3498db;
        }
        
        .info-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ”§ ØªØ´Ø®ÙŠØµ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©</h1>
        
        <div class="debug-section">
            <h2>ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
            <div class="info-grid" id="systemInfo">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
            </div>
        </div>
        
        <div class="debug-section">
            <h2>ğŸ” Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ</h2>
            <button class="debug-button" onclick="checkDataLoading()">ÙØ­Øµ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button class="debug-button" onclick="checkDOMElements()">ÙØ­Øµ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø©</button>
            <button class="debug-button" onclick="checkCSS()">ÙØ­Øµ CSS</button>
            <button class="debug-button" onclick="checkJavaScript()">ÙØ­Øµ JavaScript</button>
            <button class="debug-button" onclick="runFullDiagnosis()">ØªØ´Ø®ÙŠØµ Ø´Ø§Ù…Ù„</button>
        </div>
        
        <div class="debug-section">
            <h2>ğŸ› ï¸ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¥ØµÙ„Ø§Ø­</h2>
            <button class="debug-button" onclick="forceReloadData()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button class="debug-button" onclick="clearCache()">Ù…Ø³Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª</button>
            <button class="debug-button" onclick="resetToDefaults()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            <button class="debug-button" onclick="loadSampleData()">ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
        </div>
        
        <div class="debug-section">
            <h2>ğŸ“ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ´Ø®ÙŠØµ</h2>
            <div class="debug-output" id="debugOutput">
                Ø¬Ø§Ù‡Ø² Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´Ø®ÙŠØµ...
            </div>
        </div>
    </div>

    <!-- ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="data-migration.js"></script>
    <script src="script.js"></script>
    
    <script>
        let debugInfo = {
            screenWidth: window.innerWidth,
            screenHeight: window.innerHeight,
            userAgent: navigator.userAgent,
            propertiesCount: 0,
            elementsFound: 0,
            cssLoaded: false,
            jsLoaded: false
        };

        // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function log(message, type = 'info') {
            const output = document.getElementById('debugOutput');
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const className = type === 'error' ? 'status-error' : 
                             type === 'warning' ? 'status-warning' : 
                             type === 'success' ? 'status-good' : '';
            
            output.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        function updateSystemInfo() {
            const systemInfo = document.getElementById('systemInfo');
            systemInfo.innerHTML = `
                <div class="info-card">
                    <div class="info-value">${debugInfo.screenWidth}x${debugInfo.screenHeight}</div>
                    <div class="info-label">Ø¯Ù‚Ø© Ø§Ù„Ø´Ø§Ø´Ø©</div>
                </div>
                <div class="info-card">
                    <div class="info-value">${debugInfo.propertiesCount}</div>
                    <div class="info-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</div>
                </div>
                <div class="info-card">
                    <div class="info-value">${debugInfo.elementsFound}</div>
                    <div class="info-label">Ø¹Ù†Ø§ØµØ± DOM</div>
                </div>
                <div class="info-card">
                    <div class="info-value">${debugInfo.cssLoaded ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}</div>
                    <div class="info-label">CSS Ù…Ø­Ù…Ù„</div>
                </div>
                <div class="info-card">
                    <div class="info-value">${debugInfo.jsLoaded ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'}</div>
                    <div class="info-label">JS Ù…Ø­Ù…Ù„</div>
                </div>
                <div class="info-card">
                    <div class="info-value">${window.innerWidth > 900 ? 'ÙƒØ¨ÙŠØ±Ø©' : 'ØµØºÙŠØ±Ø©'}</div>
                    <div class="info-label">Ù†ÙˆØ¹ Ø§Ù„Ø´Ø§Ø´Ø©</div>
                </div>
            `;
        }

        // ÙØ­Øµ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function checkDataLoading() {
            log('ğŸ” ÙØ­Øµ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');
            
            // ÙØ­Øµ Ù…ØªØºÙŠØ± properties
            if (typeof properties !== 'undefined') {
                debugInfo.propertiesCount = properties ? properties.length : 0;
                log(`âœ… Ù…ØªØºÙŠØ± properties Ù…ÙˆØ¬ÙˆØ¯: ${debugInfo.propertiesCount} Ø¹Ù‚Ø§Ø±`, 'success');
            } else {
                log('âŒ Ù…ØªØºÙŠØ± properties ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
            }
            
            // ÙØ­Øµ localStorage
            const localData = localStorage.getItem('properties');
            if (localData) {
                try {
                    const parsed = JSON.parse(localData);
                    log(`âœ… Ø¨ÙŠØ§Ù†Ø§Øª localStorage Ù…ÙˆØ¬ÙˆØ¯Ø©: ${parsed.length} Ø¹Ù‚Ø§Ø±`, 'success');
                } catch (e) {
                    log('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª localStorage', 'error');
                }
            } else {
                log('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage', 'warning');
            }
            
            // ÙØ­Øµ Supabase
            if (typeof supabaseClient !== 'undefined' && supabaseClient) {
                log('âœ… Supabase client Ù…ØªÙˆÙØ±', 'success');
            } else {
                log('âš ï¸ Supabase client ØºÙŠØ± Ù…ØªÙˆÙØ±', 'warning');
            }
            
            updateSystemInfo();
        }

        // ÙØ­Øµ Ø¹Ù†Ø§ØµØ± DOM
        function checkDOMElements() {
            log('ğŸ” ÙØ­Øµ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø©...', 'info');
            
            const elements = [
                'content',
                'totalContainer', 
                'countryButtons',
                'propertyList',
                'globalSearch',
                'sidebar'
            ];
            
            let foundElements = 0;
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    foundElements++;
                    log(`âœ… Ø¹Ù†ØµØ± ${id} Ù…ÙˆØ¬ÙˆØ¯`, 'success');
                } else {
                    log(`âŒ Ø¹Ù†ØµØ± ${id} Ù…ÙÙ‚ÙˆØ¯`, 'error');
                }
            });
            
            debugInfo.elementsFound = foundElements;
            log(`ğŸ“Š ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${foundElements} Ù…Ù† Ø£ØµÙ„ ${elements.length} Ø¹Ù†Ø§ØµØ±`, 'info');
            updateSystemInfo();
        }

        // ÙØ­Øµ CSS
        function checkCSS() {
            log('ğŸ” ÙØ­Øµ ØªØ­Ù…ÙŠÙ„ CSS...', 'info');
            
            const stylesheets = document.styleSheets;
            log(`ğŸ“„ ØªÙ… ØªØ­Ù…ÙŠÙ„ ${stylesheets.length} Ù…Ù„Ù CSS`, 'info');
            
            // ÙØ­Øµ ÙˆØ¬ÙˆØ¯ Ù‚ÙˆØ§Ø¹Ø¯ CSS Ù…Ù‡Ù…Ø©
            const testElement = document.createElement('div');
            testElement.className = 'cards-container';
            document.body.appendChild(testElement);
            
            const styles = window.getComputedStyle(testElement);
            const display = styles.display;
            const gridTemplateColumns = styles.gridTemplateColumns;
            
            document.body.removeChild(testElement);
            
            if (display === 'grid') {
                log('âœ… CSS Grid ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­', 'success');
                debugInfo.cssLoaded = true;
            } else {
                log('âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ CSS Grid', 'error');
            }
            
            log(`ğŸ“ Grid columns: ${gridTemplateColumns}`, 'info');
            updateSystemInfo();
        }

        // ÙØ­Øµ JavaScript
        function checkJavaScript() {
            log('ğŸ” ÙØ­Øµ JavaScript...', 'info');
            
            const functions = [
                'renderData',
                'renderCards', 
                'initializeApp',
                'showInstallmentsDetails',
                'toggleView'
            ];
            
            let workingFunctions = 0;
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    workingFunctions++;
                    log(`âœ… Ø¯Ø§Ù„Ø© ${funcName} Ù…ØªÙˆÙØ±Ø©`, 'success');
                } else {
                    log(`âŒ Ø¯Ø§Ù„Ø© ${funcName} Ù…ÙÙ‚ÙˆØ¯Ø©`, 'error');
                }
            });
            
            debugInfo.jsLoaded = workingFunctions === functions.length;
            log(`ğŸ“Š ${workingFunctions} Ù…Ù† Ø£ØµÙ„ ${functions.length} Ø¯ÙˆØ§Ù„ ØªØ¹Ù…Ù„`, 'info');
            updateSystemInfo();
        }

        // ØªØ´Ø®ÙŠØµ Ø´Ø§Ù…Ù„
        function runFullDiagnosis() {
            log('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ø´Ø§Ù…Ù„...', 'info');
            
            checkDataLoading();
            setTimeout(() => checkDOMElements(), 500);
            setTimeout(() => checkCSS(), 1000);
            setTimeout(() => checkJavaScript(), 1500);
            
            setTimeout(() => {
                log('ğŸ¯ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ø´Ø§Ù…Ù„', 'success');
                
                // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                if (debugInfo.propertiesCount === 0) {
                    log('ğŸ”§ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶', 'error');
                    log('ğŸ’¡ Ø§Ù„Ø­Ù„: Ø¬Ø±Ø¨ "Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" Ø£Ùˆ "ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©"', 'info');
                } else if (debugInfo.elementsFound < 4) {
                    log('ğŸ”§ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø© Ù…ÙÙ‚ÙˆØ¯Ø©', 'error');
                    log('ğŸ’¡ Ø§Ù„Ø­Ù„: ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„Ù HTML', 'info');
                } else if (!debugInfo.cssLoaded) {
                    log('ğŸ”§ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: CSS Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­', 'error');
                    log('ğŸ’¡ Ø§Ù„Ø­Ù„: ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„Ù CSS', 'info');
                } else if (!debugInfo.jsLoaded) {
                    log('ğŸ”§ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©: JavaScript Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­', 'error');
                    log('ğŸ’¡ Ø§Ù„Ø­Ù„: ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„Ù JavaScript', 'info');
                } else {
                    log('âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­', 'success');
                    log('ğŸ”§ Ø¬Ø±Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'info');
                }
            }, 2000);
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function forceReloadData() {
            log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');
            
            if (typeof renderData === 'function') {
                renderData();
                log('âœ… ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ renderData', 'success');
            }
            
            if (typeof initializeApp === 'function') {
                initializeApp();
                log('âœ… ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ initializeApp', 'success');
            }
        }

        // Ù…Ø³Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª
        function clearCache() {
            log('ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª...', 'info');
            
            localStorage.clear();
            sessionStorage.clear();
            log('âœ… ØªÙ… Ù…Ø³Ø­ localStorage Ùˆ sessionStorage', 'success');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            setTimeout(() => {
                location.reload();
            }, 1000);
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        function resetToDefaults() {
            log('ğŸ”§ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª...', 'info');
            
            if (typeof properties !== 'undefined') {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                currentCountry = null;
                currentProperty = null;
                currentView = 'cards';
                filterStatus = null;
                
                log('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª', 'success');
                
                if (typeof renderData === 'function') {
                    renderData();
                    log('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
                }
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        function loadSampleData() {
            log('ğŸ“ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©...', 'info');
            
            if (typeof createSampleData === 'function') {
                createSampleData();
                log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©', 'success');
                
                if (typeof initializeApp === 'function') {
                    initializeApp();
                    log('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', 'success');
                }
                
                debugInfo.propertiesCount = properties ? properties.length : 0;
                updateSystemInfo();
            } else {
                log('âŒ Ø¯Ø§Ù„Ø© createSampleData ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©', 'error');
            }
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ´Ø®ÙŠØµ', 'success');
            updateSystemInfo();
            
            // ØªØ´ØºÙŠÙ„ ÙØ­Øµ Ø£ÙˆÙ„ÙŠ
            setTimeout(() => {
                checkDataLoading();
            }, 1000);
        });
    </script>
</body>
</html>

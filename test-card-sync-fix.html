<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .warning { background: #fff3cd; border-color: #ffeaa7; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .comparison-item {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .property-attachments {
            background: #d4edda;
            border: 2px solid #28a745;
        }
        .card-attachments {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }
        .sync-test {
            border: 2px dashed #17a2b8;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
        }
        .event-log {
            background: #f1f3f4;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }
        .event-item {
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        .event-property { background: #e8f5e8; }
        .event-card { background: #fff8e1; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</h1>
        
        <div class="test-section info">
            <h3>ğŸ“‹ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø£Ù†Ø¸Ù…Ø©</h3>
            <div class="comparison">
                <div class="comparison-item property-attachments">
                    <h4>âœ… Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</h4>
                    <p><strong>ØªØ¹Ù…Ù„ 100%</strong></p>
                    <p>Ù…Ø²Ø§Ù…Ù†Ø© ÙÙˆØ±ÙŠØ© Ø¹Ø¨Ø± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</p>
                    <button onclick="testPropertyAttachments()">Ø§Ø®ØªØ¨Ø§Ø±</button>
                </div>
                <div class="comparison-item card-attachments">
                    <h4>ğŸ”§ Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</h4>
                    <p><strong>ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­</strong></p>
                    <p>Ù†ÙØ³ Ù…Ù†Ø·Ù‚ Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</p>
                    <button onclick="testCardAttachments()">Ø§Ø®ØªØ¨Ø§Ø±</button>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙÙˆØ±ÙŠØ©</h3>
            <div class="sync-test">
                <h4>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨ÙŠÙ† Ù…ØªØµÙØ­ÙŠÙ†</h4>
                <p>1. Ø§ÙØªØ­ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ÙÙŠ Ù…ØªØµÙØ­ Ø¢Ø®Ø±</p>
                <p>2. Ø§Ø±ÙØ¹ Ù…Ù„Ù ÙÙŠ Ø£Ø­Ø¯ Ø§Ù„Ù…ØªØµÙØ­ÙŠÙ†</p>
                <p>3. ØªØ­Ù‚Ù‚ Ù…Ù† Ø¸Ù‡ÙˆØ±Ù‡ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø¢Ø®Ø±</p>
                <button onclick="openSecondBrowser()">ÙØªØ­ Ù…ØªØµÙØ­ Ø«Ø§Ù†ÙŠ</button>
                <button onclick="startSyncTest()">Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©</button>
            </div>
            <div id="syncResults"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“¤ Ø§Ø®ØªØ¨Ø§Ø± Ø±ÙØ¹ Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</h3>
            <input type="file" id="cardTestFile" style="display: none;" onchange="uploadCardTestFile(event)">
            <button onclick="document.getElementById('cardTestFile').click()">Ø±ÙØ¹ Ù…Ù„Ù Ù„Ù„Ø¨Ø·Ø§Ù‚Ø©</button>
            <button onclick="createCardTestFile()">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù ØªØ¬Ø±ÙŠØ¨ÙŠ</button>
            <div id="uploadResults"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ÙÙˆØ±ÙŠØ©</h3>
            <p>Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø·Ù„Ù‚Ø© Ø¹Ù†Ø¯ Ø±ÙØ¹/Ø­Ø°Ù Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª</p>
            <button onclick="startEventMonitoring()">Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</button>
            <button onclick="stopEventMonitoring()">Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</button>
            <button onclick="simulateCardEvent()">Ù…Ø­Ø§ÙƒØ§Ø© Ø­Ø¯Ø« Ø¨Ø·Ø§Ù‚Ø©</button>
            <div class="event-log" id="eventLog"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ” ØªØ´Ø®ÙŠØµ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</h3>
            <button onclick="diagnoseIssue()">ØªØ´Ø®ÙŠØµ Ø´Ø§Ù…Ù„</button>
            <button onclick="compareImplementations()">Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</button>
            <div id="diagnosisResults"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“ Ø³Ø¬Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h3>
            <button onclick="clearLog()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
            <div id="testLog" class="log"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="script.js"></script>
    
    <script>
        let eventMonitoring = false;
        let eventCount = { property: 0, card: 0 };

        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logDiv.textContent += logEntry;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function clearLog() {
            document.getElementById('testLog').textContent = '';
            log('ğŸ§¹ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„');
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª...');
            
            // ØªÙ‡ÙŠØ¦Ø© Supabase
            if (typeof initSupabase === 'function') {
                const initialized = initSupabase();
                log('Supabase ØªÙ‡ÙŠØ¦Ø©:', initialized ? 'Ù†Ø¬Ø­' : 'ÙØ´Ù„');
            }
            
            // Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            setTimeout(startEventMonitoring, 1000);
        });

        function testPropertyAttachments() {
            log('ğŸ  Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª (Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø°ÙŠ ÙŠØ¹Ù…Ù„)...');
            
            if (typeof showAttachmentsModal === 'function') {
                showAttachmentsModal('Ø§Ù„Ø±ÙŠØ§Ø¶', 'Ù…Ø¬Ù…Ø¹_Ù…Ø±Ø¬Ø¹ÙŠ');
                log('âœ… ØªÙ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±', 'success');
            } else {
                log('âŒ ÙˆØ¸ÙŠÙØ© showAttachmentsModal ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©', 'error');
            }
        }

        function testCardAttachments() {
            log('ğŸ·ï¸ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª (Ø§Ù„Ù…ÙØµÙ„Ø­)...');
            
            if (typeof showCardAttachmentsModal === 'function') {
                showCardAttachmentsModal('Ø§Ù„Ø±ÙŠØ§Ø¶', 'Ù…Ø¬Ù…Ø¹_Ø§Ø®ØªØ¨Ø§Ø±', '123', null);
                log('âœ… ØªÙ… ÙØªØ­ Ù†Ø§ÙØ°Ø© Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©', 'success');
            } else {
                log('âŒ ÙˆØ¸ÙŠÙØ© showCardAttachmentsModal ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©', 'error');
            }
        }

        function openSecondBrowser() {
            const url = window.location.href;
            window.open(url, '_blank');
            log('ğŸŒ ØªÙ… ÙØªØ­ Ù…ØªØµÙØ­ Ø«Ø§Ù†ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±');
        }

        function startSyncTest() {
            log('ğŸ”„ Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...');
            
            const resultsDiv = document.getElementById('syncResults');
            resultsDiv.innerHTML = `
                <div class="info">
                    <h4>ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù†Ø´Ø·</h4>
                    <p>Ø§Ø±ÙØ¹ Ù…Ù„Ù ÙÙŠ Ø£ÙŠ Ù…ØªØµÙØ­ ÙˆØ±Ø§Ù‚Ø¨ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ù‡Ù†Ø§</p>
                    <div id="syncEvents"></div>
                </div>
            `;
        }

        async function uploadCardTestFile(event) {
            const files = event.target.files;
            if (files.length === 0) return;

            const file = files[0];
            const cardKey = 'test_sync_card_' + Date.now();
            
            log(`ğŸ“¤ Ø±ÙØ¹ Ù…Ù„Ù Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©: ${file.name}`);
            
            try {
                if (typeof uploadCardFileToSupabase === 'function') {
                    const result = await uploadCardFileToSupabase(file, cardKey, 'Ù…Ù„Ù Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©');
                    
                    if (result) {
                        log(`âœ… ØªÙ… Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­: ${file.name}`, 'success');
                        
                        document.getElementById('uploadResults').innerHTML = `
                            <div class="success">
                                <h4>âœ… Ù†Ø¬Ø­ Ø§Ù„Ø±ÙØ¹!</h4>
                                <p><strong>Ø§Ù„Ù…Ù„Ù:</strong> ${file.name}</p>
                                <p><strong>Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©:</strong> ${cardKey}</p>
                                <p><strong>Ø§Ù„Ø­Ø¬Ù…:</strong> ${(file.size / 1024).toFixed(2)} KB</p>
                            </div>
                        `;
                        
                    } else {
                        throw new Error('Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù');
                    }
                } else {
                    throw new Error('ÙˆØ¸ÙŠÙØ© uploadCardFileToSupabase ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©: ${error.message}`, 'error');
                
                document.getElementById('uploadResults').innerHTML = `
                    <div class="error">
                        <h4>âŒ ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹</h4>
                        <p><strong>Ø§Ù„Ø®Ø·Ø£:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }

        function createCardTestFile() {
            log('ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø¨Ø·Ø§Ù‚Ø©...');
            
            const content = `Ù…Ù„Ù Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date().toISOString()}
Ø§Ù„Ù…ØªØµÙØ­: ${navigator.userAgent}
Ø§Ù„Ù‡Ø¯Ù: Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙÙˆØ±ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©

Ù‡Ø°Ø§ Ù…Ù„Ù ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¥ØµÙ„Ø§Ø­ Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª.
`;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const file = new File([blob], `Ø§Ø®ØªØ¨Ø§Ø±_Ù…Ø²Ø§Ù…Ù†Ø©_${Date.now()}.txt`, { type: 'text/plain' });
            
            log(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù ØªØ¬Ø±ÙŠØ¨ÙŠ: ${file.name}`);
            
            // Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            uploadCardTestFile({ target: { files: [file] } });
        }

        function startEventMonitoring() {
            if (eventMonitoring) return;
            
            eventMonitoring = true;
            log('ğŸ‘ï¸ Ø¨Ø¯Ø¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«...');
            
            // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø£Ø­Ø¯Ø§Ø« Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª
            window.addEventListener('attachmentAdded', handlePropertyEvent);
            window.addEventListener('attachmentDeleted', handlePropertyEvent);
            
            // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø£Ø­Ø¯Ø§Ø« Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
            window.addEventListener('cardAttachmentAdded', handleCardEvent);
            window.addEventListener('cardAttachmentDeleted', handleCardEvent);
            
            log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«', 'success');
        }

        function stopEventMonitoring() {
            if (!eventMonitoring) return;
            
            eventMonitoring = false;
            
            window.removeEventListener('attachmentAdded', handlePropertyEvent);
            window.removeEventListener('attachmentDeleted', handlePropertyEvent);
            window.removeEventListener('cardAttachmentAdded', handleCardEvent);
            window.removeEventListener('cardAttachmentDeleted', handleCardEvent);
            
            log('â¹ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«');
        }

        function handlePropertyEvent(event) {
            eventCount.property++;
            addEventToLog('property', event.type, event.detail);
            log(`ğŸ  Ø­Ø¯Ø« Ù…Ø±ÙÙ‚ Ø¹Ù‚Ø§Ø±: ${event.type}`, 'info');
        }

        function handleCardEvent(event) {
            eventCount.card++;
            addEventToLog('card', event.type, event.detail);
            log(`ğŸ·ï¸ Ø­Ø¯Ø« Ù…Ø±ÙÙ‚ Ø¨Ø·Ø§Ù‚Ø©: ${event.type}`, 'success');
        }

        function addEventToLog(type, eventType, detail) {
            const eventLog = document.getElementById('eventLog');
            const eventItem = document.createElement('div');
            eventItem.className = `event-item event-${type}`;
            
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const icon = type === 'property' ? 'ğŸ ' : 'ğŸ·ï¸';
            const fileName = detail.attachment?.file_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            
            eventItem.innerHTML = `
                <strong>[${timestamp}] ${icon} ${eventType}</strong><br>
                <small>Ø§Ù„Ù…Ù„Ù: ${fileName}</small><br>
                <small>Ø§Ù„Ù…ÙØªØ§Ø­: ${detail.propertyKey || detail.cardKey}</small>
            `;
            
            eventLog.insertBefore(eventItem, eventLog.firstChild);
            
            // Keep only last 10 events
            while (eventLog.children.length > 10) {
                eventLog.removeChild(eventLog.lastChild);
            }
        }

        function simulateCardEvent() {
            log('ğŸ­ Ù…Ø­Ø§ÙƒØ§Ø© Ø­Ø¯Ø« Ù…Ø±ÙÙ‚ Ø¨Ø·Ø§Ù‚Ø©...');
            
            const mockAttachment = {
                id: 'mock_' + Date.now(),
                file_name: 'Ù…Ù„Ù_Ù…Ø­Ø§ÙƒØ§Ø©_' + Date.now() + '.txt',
                file_type: 'text/plain',
                file_size: 1024,
                created_at: new Date().toISOString()
            };
            
            const mockCardKey = 'test_simulation_' + Date.now();
            
            // Ø¥Ø·Ù„Ø§Ù‚ Ø­Ø¯Ø« Ù…Ø®ØµØµ
            window.dispatchEvent(new CustomEvent('cardAttachmentAdded', {
                detail: { 
                    cardKey: mockCardKey,
                    attachment: mockAttachment
                }
            }));
            
            log(`âœ… ØªÙ… Ù…Ø­Ø§ÙƒØ§Ø© Ø­Ø¯Ø« Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙÙ‚ Ø¨Ø·Ø§Ù‚Ø©: ${mockAttachment.file_name}`, 'success');
        }

        function diagnoseIssue() {
            log('ğŸ” Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ø´Ø§Ù…Ù„...');
            
            const diagnosis = {
                supabase: !!supabaseClient,
                propertyFunctions: {
                    upload: typeof uploadFileToSupabase === 'function',
                    get: typeof getPropertyAttachmentsEnhanced === 'function',
                    subscribe: typeof subscribeToAttachmentChanges === 'function'
                },
                cardFunctions: {
                    upload: typeof uploadCardFileToSupabase === 'function',
                    get: typeof getCardAttachmentsEnhanced === 'function',
                    subscribe: typeof subscribeToCardAttachmentChanges === 'function'
                },
                events: {
                    propertyCount: eventCount.property,
                    cardCount: eventCount.card,
                    monitoring: eventMonitoring
                }
            };
            
            let html = '<h4>ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ´Ø®ÙŠØµ:</h4><ul>';
            
            html += `<li>Supabase: ${diagnosis.supabase ? 'âœ…' : 'âŒ'}</li>`;
            html += `<li>ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª: ${Object.values(diagnosis.propertyFunctions).every(Boolean) ? 'âœ…' : 'âŒ'}</li>`;
            html += `<li>ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª: ${Object.values(diagnosis.cardFunctions).every(Boolean) ? 'âœ…' : 'âŒ'}</li>`;
            html += `<li>Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª: ${diagnosis.events.propertyCount}</li>`;
            html += `<li>Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª: ${diagnosis.events.cardCount}</li>`;
            html += `<li>Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«: ${diagnosis.events.monitoring ? 'âœ…' : 'âŒ'}</li>`;
            
            html += '</ul>';
            
            document.getElementById('diagnosisResults').innerHTML = html;
            
            log('âœ… ØªÙ… Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ø´Ø§Ù…Ù„', 'success');
            console.log('ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ´Ø®ÙŠØµ:', diagnosis);
        }

        function compareImplementations() {
            log('ğŸ”„ Ù…Ù‚Ø§Ø±Ù†Ø© ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª...');
            
            const comparison = {
                property: {
                    upload: 'uploadFileToSupabase',
                    get: 'getPropertyAttachmentsEnhanced', 
                    delete: 'deleteAttachmentEnhanced',
                    subscribe: 'subscribeToAttachmentChanges',
                    events: ['attachmentAdded', 'attachmentDeleted']
                },
                card: {
                    upload: 'uploadCardFileToSupabase',
                    get: 'getCardAttachmentsEnhanced',
                    delete: 'deleteCardAttachmentEnhanced', 
                    subscribe: 'subscribeToCardAttachmentChanges',
                    events: ['cardAttachmentAdded', 'cardAttachmentDeleted']
                }
            };
            
            let html = '<h4>ğŸ” Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª:</h4>';
            html += '<div class="comparison">';
            
            // Property attachments
            html += '<div class="comparison-item property-attachments">';
            html += '<h5>Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</h5>';
            Object.entries(comparison.property).forEach(([key, value]) => {
                if (Array.isArray(value)) {
                    html += `<p><strong>${key}:</strong> ${value.join(', ')}</p>`;
                } else {
                    const exists = typeof window[value] === 'function';
                    html += `<p>${exists ? 'âœ…' : 'âŒ'} ${value}</p>`;
                }
            });
            html += '</div>';
            
            // Card attachments
            html += '<div class="comparison-item card-attachments">';
            html += '<h5>Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</h5>';
            Object.entries(comparison.card).forEach(([key, value]) => {
                if (Array.isArray(value)) {
                    html += `<p><strong>${key}:</strong> ${value.join(', ')}</p>`;
                } else {
                    const exists = typeof window[value] === 'function';
                    html += `<p>${exists ? 'âœ…' : 'âŒ'} ${value}</p>`;
                }
            });
            html += '</div>';
            
            html += '</div>';
            
            document.getElementById('diagnosisResults').innerHTML = html;
            
            log('âœ… ØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©', 'success');
        }
    </script>
</body>
</html>

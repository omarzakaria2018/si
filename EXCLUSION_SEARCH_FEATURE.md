# 🔍 ميزة البحث مع الاستبعاد (-)

## 📋 نظرة عامة

تم إضافة ميزة جديدة قوية لنظام البحث تسمح باستبعاد مصطلحات معينة من نتائج البحث باستخدام علامة `-` (الشرطة).

## 🎯 الهدف

حل مشكلة ظهور الوحدات المنتهية عند البحث عن "نشط" وإعطاء المستخدم تحكماً أكبر في تصفية النتائج.

## 🔧 كيفية الاستخدام

### الصيغة الأساسية:
```
[مصطلح البحث] -[مصطلح الاستبعاد]
```

### أمثلة على الاستخدام:

#### 1. الاستبعاد الأساسي:
- `الرياض -منتهي` = ابحث في الرياض واستبعد المنتهي
- `نشط -منتهي` = ابحث عن النشط واستبعد المنتهي
- `الرياض -فارغ` = ابحث في الرياض واستبعد الفارغ

#### 2. الاستبعاد المتعدد:
- `الرياض -منتهي-فارغ` = ابحث في الرياض واستبعد المنتهي والفارغ
- `نشط -منتهي-فارغ` = ابحث عن النشط واستبعد المنتهي والفارغ
- `جدة -فارغ-منتهي` = ابحث في جدة واستبعد الفارغ والمنتهي

#### 3. البحث الهرمي مع الاستبعاد:
- `الرياض//نشط -منتهي` = بحث هرمي في الرياض عن النشط مع استبعاد المنتهي
- `نشط//الرياض -فارغ` = بحث هرمي عن النشط في الرياض مع استبعاد الفارغ

## 🛠️ التطبيق التقني

### الدوال الجديدة المضافة:

#### 1. `processSearchWithExclusion(property, searchTerm)`
```javascript
// معالجة البحث مع الاستبعاد
function processSearchWithExclusion(property, searchTerm) {
    // تقسيم النص إلى جزء البحث وأجزاء الاستبعاد
    const parts = searchTerm.split(' -');
    const searchPart = parts[0].trim();
    const exclusionParts = parts.slice(1);
    
    // تحقق من تطابق جزء البحث
    // تحقق من عدم تطابق أجزاء الاستبعاد
}
```

#### 2. `advancedSearchInPropertyBasic(property, searchTerm)`
```javascript
// دالة البحث الأساسية بدون معالجة الاستبعاد
function advancedSearchInPropertyBasic(property, searchTerm) {
    // البحث في الحالات والحقول العادية
}
```

### التحديثات على الدوال الموجودة:

#### `advancedSearchInProperty()`
```javascript
function advancedSearchInProperty(property, searchTerm) {
    // معالجة البحث مع الاستبعاد (-)
    if (searchTerm.includes('-')) {
        return processSearchWithExclusion(property, searchTerm);
    }
    
    // استخدام الدالة الأساسية للبحث العادي
    return advancedSearchInPropertyBasic(property, searchTerm);
}
```

## 📊 أمثلة عملية

### المثال الأول: حل مشكلة "نشط" يُظهر منتهي
```
قبل الإضافة:
"نشط" → يُظهر وحدات منتهية أحياناً

بعد الإضافة:
"نشط -منتهي" → يُظهر فقط الوحدات النشطة
```

### المثال الثاني: البحث في مدينة معينة
```
"الرياض -منتهي-فارغ"
النتيجة: جميع الوحدات في الرياض عدا المنتهية والفارغة
```

### المثال الثالث: البحث الهرمي المتقدم
```
"الرياض//نشط -منتهي"
النتيجة: الوحدات النشطة في الرياض مع استبعاد المنتهية
```

## 🧪 الاختبار

### ملف الاختبار: `test-exclusion-search.html`

يحتوي على:
- اختبار الاستبعاد الأساسي
- اختبار الاستبعاد المتعدد
- اختبار الاستبعاد الهرمي
- بحث مخصص تفاعلي

### كيفية الاختبار:
1. افتح `test-exclusion-search.html`
2. جرب الأزرار المختلفة
3. استخدم البحث المخصص لتجربة استعلامات مختلفة

## 🎯 الفوائد

### 1. حل مشكلة البحث عن "نشط":
- `نشط -منتهي` يضمن عدم ظهور وحدات منتهية
- `نشط -منتهي-فارغ` يضمن ظهور الوحدات النشطة فقط

### 2. مرونة أكبر في البحث:
- إمكانية استبعاد عدة مصطلحات في استعلام واحد
- دعم البحث الهرمي مع الاستبعاد

### 3. تحكم دقيق في النتائج:
- المستخدم يحدد بالضبط ما يريد استبعاده
- لا حاجة لتصفية النتائج يدوياً

## 📝 ملاحظات مهمة

### 1. التوافق:
- الميزة متوافقة مع جميع أنواع البحث الموجودة
- لا تؤثر على البحث العادي بدون علامة `-`

### 2. الأداء:
- معالجة فعالة للاستبعاد
- لا تؤثر على سرعة البحث

### 3. سهولة الاستخدام:
- صيغة بسيطة ومفهومة
- رسائل تشخيص واضحة في وحدة التحكم

## 🚀 أمثلة للاستخدام اليومي

### للمدير العقاري:
```
"الرياض -منتهي-فارغ"     → الوحدات المؤجرة في الرياض
"نشط -منتهي"             → جميع الوحدات النشطة
"جدة//تجاري -فارغ"       → المحلات التجارية المؤجرة في جدة
```

### للمحاسب:
```
"ضريبي -منتهي"          → العقود الضريبية النشطة
"سكني -فارغ"            → الوحدات السكنية المؤجرة
```

### للمتابع:
```
"على وشك -منتهي"        → العقود التي ستنتهي قريباً (وليس المنتهية)
"فعال -على وشك"         → العقود الفعالة طويلة المدى
```

## 🔮 التطوير المستقبلي

### إمكانيات إضافية:
- دعم الاستبعاد في البحث المتعدد (`+`)
- دعم الاستبعاد في البحث AND (`&&`)
- إضافة اختصارات للاستبعادات الشائعة

### تحسينات محتملة:
- واجهة مستخدم لبناء استعلامات الاستبعاد
- حفظ استعلامات الاستبعاد المفضلة
- إحصائيات عن الاستبعادات المطبقة

## ✅ الخلاصة

ميزة البحث مع الاستبعاد تحل مشكلة ظهور الوحدات المنتهية عند البحث عن "نشط" وتوفر مرونة كبيرة في تصفية النتائج. الميزة سهلة الاستخدام ومتوافقة مع النظام الحالي ولا تؤثر على الأداء.

# ๐ ุชูุฑูุฑ ุฅุตูุงุญ ุณุฌูุงุช ุงูุชุชุจุน ูููุญุฏุงุช ุงููุชุนุฏุฏุฉ

## ๐ฏ ุงููุดููุฉ ุงูุฃุณุงุณูุฉ

**ุงููุดููุฉ**: ุณุฌูุงุช ุงูุชุชุจุน ูุง ุชุนุฑุถ ุงููุญุฏุงุช ุงููุชุนุฏุฏุฉ ูุน ุฑูู ุนูุฏ ูุงุญุฏ

**ุงูุณุจุจ**: ุนูุฏ ุฑุจุท ุฃู ุชุนุฏูู ุฃู ูุตู ูุญุฏุฉุ ูุงู ุงููุธุงู ููุดุฆ ุณุฌู ุชุชุจุน ูููุญุฏุฉ ุงููุนุฏูุฉ ููุทุ ููุง ููุดุฆ ุณุฌูุงุช ูููุญุฏุงุช ุงูุฃุฎุฑู ุงููุฑุชุจุทุฉ ุจููุณ ุงูุนูุฏ.

---

## โ ุงูุญู ุงููุทุจู

### 1. **ุฅูุดุงุก ุฏุงูุฉ `createTrackingLogsForLinkedUnits`**

```javascript
async function createTrackingLogsForLinkedUnits(contractNumber, propertyName, excludeUnitNumber, operationType) {
    // ุงูุจุญุซ ุนู ุฌููุน ุงููุญุฏุงุช ุงููุฑุชุจุทุฉ ุจููุณ ุงูุนูุฏ (ุจุงุณุชุซูุงุก ุงููุญุฏุฉ ุงููุณุชุซูุงุฉ)
    const linkedUnits = properties.filter(p =>
        p['ุฑูู ุงูุนูุฏ'] === contractNumber &&
        p['ุงุณู ุงูุนูุงุฑ'] === propertyName &&
        p['ุฑูู  ุงููุญุฏุฉ '] !== excludeUnitNumber
    );

    // ุฅูุดุงุก ุณุฌู ุชุชุจุน ููู ูุญุฏุฉ ูุฑุชุจุทุฉ
    for (const unit of linkedUnits) {
        await addChangeLog(operationType, unit, {}, {
            contractNumber: contractNumber,
            propertyName: propertyName,
            newLinkedUnit: excludeUnitNumber,
            reason: `ุชู ุฑุจุท ูุญุฏุฉ ุฌุฏูุฏุฉ (${excludeUnitNumber}) ุจููุณ ุงูุนูุฏ`,
            relatedOperation: 'unit_linking_notification'
        });
    }
}
```

### 2. **ุชุญุณูู ุฏุงูุฉ `linkUnitToContract`**

**ูุจู ุงูุฅุตูุงุญ**: ูุงูุช ุชูุดุฆ ุณุฌู ุชุชุจุน ูููุญุฏุฉ ุงูุฌุฏูุฏุฉ ููุท
**ุจุนุฏ ุงูุฅุตูุงุญ**: ุชูุดุฆ ุณุฌู ูููุญุฏุฉ ุงูุฌุฏูุฏุฉ + ุณุฌูุงุช ูุฌููุน ุงููุญุฏุงุช ุงููุฑุชุจุทุฉ

```javascript
// ุฅุถุงูุฉ ุณุฌู ุชุชุจุน ููุฑุจุท
await addChangeLog('ุฑุจุท ูุญุฏุฉ', properties[unitIndex], oldData, {
    operation: 'link_unit',
    unitNumber: unitNumber,
    contractNumber: contractNumber,
    propertyName: propertyName
});

// ุฅูุดุงุก ุณุฌูุงุช ุชุชุจุน ูุฌููุน ุงููุญุฏุงุช ุงููุฑุชุจุทุฉ ุงูุฃุฎุฑู
await createTrackingLogsForLinkedUnits(contractNumber, propertyName, unitNumber, 'ุฑุจุท ูุญุฏุฉ ุฌุฏูุฏุฉ');
```

### 3. **ุชุญุณูู ุฏุงูุฉ `syncLinkedUnitsData`**

**ูุจู ุงูุฅุตูุงุญ**: ูุงูุช ุชุฒุงูู ุงูุจูุงูุงุช ุฏูู ุฅูุดุงุก ุณุฌูุงุช ุชุชุจุน
**ุจุนุฏ ุงูุฅุตูุงุญ**: ุชูุดุฆ ุณุฌู ุชุชุจุน ููู ูุญุฏุฉ ูุชู ุชุญุฏูุซูุง

```javascript
// ุฅูุดุงุก ุณุฌู ุชุชุจุน ููู ูุญุฏุฉ ูุฑุชุจุทุฉ
const changes = {};
// ุชุณุฌูู ุงูุชุบููุฑุงุช ุงููููุฉ
if (sharedData['ุงุณู ุงููุณุชุฃุฌุฑ'] !== unit['ุงุณู ุงููุณุชุฃุฌุฑ']) {
    changes['ุงุณู ุงููุณุชุฃุฌุฑ'] = {
        old: unit['ุงุณู ุงููุณุชุฃุฌุฑ'] || 'ูุงุฑุบ',
        new: sharedData['ุงุณู ุงููุณุชุฃุฌุฑ'] || 'ูุงุฑุบ',
        fieldName: 'ุงุณู ุงููุณุชุฃุฌุฑ'
    };
}

await addChangeLog('ูุฒุงููุฉ ุจูุงูุงุช ุงููุญุฏุงุช ุงููุฑุชุจุทุฉ', properties[unitIndex], changes, {
    contractNumber: contractNumber,
    propertyName: propertyName,
    operationType: operationType,
    reason: `ูุฒุงููุฉ ูุน ุงููุญุฏุงุช ุงููุฑุชุจุทุฉ ุจุงูุนูุฏ ${contractNumber}`
});
```

### 4. **ุชุญุณูู ุฏุงูุฉ `updateLinkedUnitsOnEdit`**

**ูุจู ุงูุฅุตูุงุญ**: ูุงูุช ุชุญุฏุซ ุงููุญุฏุงุช ุงููุฑุชุจุทุฉ ุฏูู ุณุฌูุงุช ุชุชุจุน
**ุจุนุฏ ุงูุฅุตูุงุญ**: ุชูุดุฆ ุณุฌู ุชุชุจุน ููู ูุญุฏุฉ ูุชู ุชุญุฏูุซูุง

```javascript
// ุฅูุดุงุก ุณุฌู ุชุชุจุน ูููุญุฏุฉ ุงููุญุฏุซุฉ
const changes = {};
for (const field of sharedFields) {
    if (editedUnitData[field] !== undefined && unit[field] !== editedUnitData[field]) {
        changes[field] = {
            old: unit[field] || 'ูุงุฑุบ',
            new: editedUnitData[field] || 'ูุงุฑุบ',
            fieldName: field
        };
    }
}

await addChangeLog('ุชุญุฏูุซ ุจูุงูุงุช ุงููุญุฏุงุช ุงููุฑุชุจุทุฉ', properties[unitIndex], changes, {
    contractNumber: contractNumber,
    propertyName: propertyName,
    updatedFields: Object.keys(changes),
    reason: `ุชุญุฏูุซ ุชููุงุฆู ูููุญุฏุงุช ุงููุฑุชุจุทุฉ ุจุงูุนูุฏ ${contractNumber}`
});
```

### 5. **ุชุญุณูู ุฏุงูุฉ `savePropertyEdit`**

**ูุจู ุงูุฅุตูุงุญ**: ูุงูุช ุชูุดุฆ ุณุฌู ูููุญุฏุฉ ุงููุนุฏูุฉ ููุท
**ุจุนุฏ ุงูุฅุตูุงุญ**: ุชูุดุฆ ุณุฌูุงุช ูููุญุฏุงุช ุงููุฑุชุจุทุฉ ุนูุฏ ุชุบููุฑ ุงูุจูุงูุงุช ุงููุดุชุฑูุฉ

```javascript
// ุฅูุดุงุก ุณุฌูุงุช ุชุชุจุน ูููุญุฏุงุช ุงููุฑุชุจุทุฉ ุฅุฐุง ูุงู ููุงู ุชุบููุฑ ูู ุงูุจูุงูุงุช ุงููุดุชุฑูุฉ
if (updatedProperty['ุฑูู ุงูุนูุฏ'] && updatedProperty['ุงุณู ุงูุนูุงุฑ']) {
    const sharedFieldsChanged = ['ุงุณู ุงููุณุชุฃุฌุฑ', 'ุฑูู ุงูุนูุฏ', 'ูููุฉ  ุงูุงูุฌุงุฑ ', 'ุชุงุฑูุฎ ุจุฏุงูุฉ ุงูุนูุฏ', 'ุชุงุฑูุฎ ููุงูุฉ ุงูุนูุฏ'].some(field => 
        originalData[field] !== updatedProperty[field]
    );

    if (sharedFieldsChanged) {
        await createTrackingLogsForLinkedUnits(
            updatedProperty['ุฑูู ุงูุนูุฏ'], 
            updatedProperty['ุงุณู ุงูุนูุงุฑ'], 
            updatedProperty['ุฑูู  ุงููุญุฏุฉ '], 
            'ุชุญุฏูุซ ุจูุงูุงุช ุงููุญุฏุงุช ุงููุฑุชุจุทุฉ'
        );
    }
}
```

### 6. **ุชุญุณูู ุฏุงูุฉ `absoluteUnlinkUnit`**

**ูุจู ุงูุฅุตูุงุญ**: ูุงูุช ุชูุดุฆ ุณุฌู ูููุญุฏุฉ ุงูููุตููุฉ ููุท
**ุจุนุฏ ุงูุฅุตูุงุญ**: ุชูุดุฆ ุณุฌูุงุช ูููุญุฏุงุช ุงููุชุจููุฉ ูู ุงูุนูุฏ

```javascript
// ุฅูุดุงุก ุณุฌูุงุช ุชุชุจุน ูุฌููุน ุงููุญุฏุงุช ุงููุฑุชุจุทุฉ ุงูุฃุฎุฑู
await createTrackingLogsForLinkedUnits(contractNumber, propertyName, unitNumber, 'ูุตู ูุญุฏุฉ ูู ุงูุนูุฏ');
```

---

## ๐ฏ ุงูุณููุงุฑูููุงุช ุงููุฏุนููุฉ ุงูุขู

### **ุณููุงุฑูู 1: ุฑุจุท ูุญุฏุฉ ุฌุฏูุฏุฉ ุจุนูุฏ ููุฌูุฏ**
- **ุงููุญุฏุฉ ุงูุฌุฏูุฏุฉ**: ุณุฌู "ุฑุจุท ูุญุฏุฉ"
- **ุงููุญุฏุงุช ุงูููุฌูุฏุฉ**: ุณุฌูุงุช "ุฑุจุท ูุญุฏุฉ ุฌุฏูุฏุฉ"

**ูุซุงู**: ุนูุฏ ุฑุจุท ุงููุญุฏุฉ 103 ุจุนูุฏ ูุญุชูู ุนูู ุงููุญุฏุงุช 101 ู 102:
- โ ุณุฌู ูููุญุฏุฉ 103: "ุฑุจุท ูุญุฏุฉ"
- โ ุณุฌู ูููุญุฏุฉ 101: "ุฑุจุท ูุญุฏุฉ ุฌุฏูุฏุฉ - ุชู ุฑุจุท ูุญุฏุฉ ุฌุฏูุฏุฉ (103) ุจููุณ ุงูุนูุฏ"
- โ ุณุฌู ูููุญุฏุฉ 102: "ุฑุจุท ูุญุฏุฉ ุฌุฏูุฏุฉ - ุชู ุฑุจุท ูุญุฏุฉ ุฌุฏูุฏุฉ (103) ุจููุณ ุงูุนูุฏ"

### **ุณููุงุฑูู 2: ุชุนุฏูู ุจูุงูุงุช ูุดุชุฑูุฉ**
- **ุงููุญุฏุฉ ุงููุนุฏูุฉ**: ุณุฌู "ุชุญุฑูุฑ ุจูุงูุงุช"
- **ุงููุญุฏุงุช ุงููุฑุชุจุทุฉ**: ุณุฌูุงุช "ุชุญุฏูุซ ุจูุงูุงุช ุงููุญุฏุงุช ุงููุฑุชุจุทุฉ"

**ูุซุงู**: ุนูุฏ ุชุนุฏูู ูููุฉ ุงูุฅูุฌุงุฑ ูู ุงููุญุฏุฉ 101:
- โ ุณุฌู ูููุญุฏุฉ 101: "ุชุญุฑูุฑ ุจูุงูุงุช - ุชุนุฏูู ูููุฉ ุงูุฅูุฌุงุฑ"
- โ ุณุฌู ูููุญุฏุฉ 102: "ุชุญุฏูุซ ุจูุงูุงุช ุงููุญุฏุงุช ุงููุฑุชุจุทุฉ - ุชุญุฏูุซ ุชููุงุฆู"
- โ ุณุฌู ูููุญุฏุฉ 103: "ุชุญุฏูุซ ุจูุงูุงุช ุงููุญุฏุงุช ุงููุฑุชุจุทุฉ - ุชุญุฏูุซ ุชููุงุฆู"

### **ุณููุงุฑูู 3: ูุตู ูุญุฏุฉ ูู ุงูุนูุฏ**
- **ุงููุญุฏุฉ ุงูููุตููุฉ**: ุณุฌู "ูุตู ูุญุฏุฉ ูุทูู"
- **ุงููุญุฏุงุช ุงููุชุจููุฉ**: ุณุฌูุงุช "ูุตู ูุญุฏุฉ ูู ุงูุนูุฏ"

**ูุซุงู**: ุนูุฏ ูุตู ุงููุญุฏุฉ 101 ูู ุงูุนูุฏ:
- โ ุณุฌู ูููุญุฏุฉ 101: "ูุตู ูุญุฏุฉ ูุทูู"
- โ ุณุฌู ูููุญุฏุฉ 102: "ูุตู ูุญุฏุฉ ูู ุงูุนูุฏ - ุชู ูุตู ูุญุฏุฉ (101) ูู ููุณ ุงูุนูุฏ"
- โ ุณุฌู ูููุญุฏุฉ 103: "ูุตู ูุญุฏุฉ ูู ุงูุนูุฏ - ุชู ูุตู ูุญุฏุฉ (101) ูู ููุณ ุงูุนูุฏ"

---

## ๐ง ุงูุชุญุณููุงุช ุงูุชูููุฉ

### **1. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก**
- ุฅุถุงูุฉ `try-catch` ููู ุนูููุฉ ุฅูุดุงุก ุณุฌู ุชุชุจุน
- ุนุฏู ุชููู ุงูุนูููุฉ ุงูุฃุณุงุณูุฉ ูู ุญุงูุฉ ูุดู ุฅูุดุงุก ุณุฌู ุงูุชุชุจุน
- ุชุณุฌูู ุชุญุฐูุฑุงุช ููุตูุฉ ูู console

### **2. ุงูุฃุฏุงุก**
- ุงุณุชุฎุฏุงู `for...of` ุจุฏูุงู ูู `forEach` ููุนูููุงุช async
- ุชุฌููุน ุงูุนูููุงุช ุงููุชุดุงุจูุฉ
- ุชุฌูุจ ุงูุงุณุชุนูุงูุงุช ุงูููุฑุฑุฉ

### **3. ุงููุฑููุฉ**
- ุฏุนู ุฃููุงุน ุนูููุงุช ูุฎุชููุฉ
- ุฅููุงููุฉ ุชุฎุตูุต ุฑุณุงุฆู ุงูุณุฌูุงุช
- ุฏุนู ูุนูููุงุช ุฅุถุงููุฉ ูู ุงูุณุฌูุงุช

---

## ๐ ุงููุชุงุฆุฌ ุงููุญููุฉ

### **ูุจู ุงูุฅุตูุงุญ**:
- โ ุณุฌู ูุงุญุฏ ููุท ูููุญุฏุฉ ุงููุนุฏูุฉ
- โ ูุง ุชุธูุฑ ุงููุญุฏุงุช ุงููุฑุชุจุทุฉ ูู ุณุฌูุงุช ุงูุชุชุจุน
- โ ุตุนูุจุฉ ูู ุชุชุจุน ุงูุชุบููุฑุงุช ุนูู ูุณุชูู ุงูุนูุฏ

### **ุจุนุฏ ุงูุฅุตูุงุญ**:
- โ ุณุฌูุงุช ุดุงููุฉ ูุฌููุน ุงููุญุฏุงุช ุงููุชุฃุซุฑุฉ
- โ ุชุชุจุน ูุงูู ููุนูููุงุช ุนูู ูุณุชูู ุงูุนูุฏ
- โ ุณูููุฉ ูู ูุฑุงุฌุนุฉ ุชุงุฑูุฎ ุงูุชุบููุฑุงุช
- โ ุดูุงููุฉ ูุงููุฉ ูู ุงูุนูููุงุช

---

## ๐งช ุฃุฏูุงุช ุงูุงุฎุชุจุงุฑ

### **ููู ุงูุงุฎุชุจุงุฑ**: `tracking-logs-test.html`
- ุงุฎุชุจุงุฑ ุชูุงุนูู ูุฌููุน ุงูุณููุงุฑูููุงุช
- ูุญุงูุงุฉ ุงูุนูููุงุช ุงูุญููููุฉ
- ุนุฑุถ ุงููุชุงุฆุฌ ุงููุชููุนุฉ ููุงุจู ุงููุนููุฉ

### **ููููุฉ ุงูุงุฎุชุจุงุฑ**:
1. ุงูุชุญ `tracking-logs-test.html` ูู ุงููุชุตูุญ
2. ุงุฎุชุจุฑ ูู ุณููุงุฑูู ุจุดูู ูููุตู
3. ุฃู ุงุณุชุฎุฏู "ุชุดุบูู ุฌููุน ุงูุงุฎุชุจุงุฑุงุช"
4. ุฑุงุฌุน ุงููุชุงุฆุฌ ูุงูุชูุฑูุฑ ุงูุดุงูู

---

## ๐ ุงูุฎูุงุตุฉ

ุชู ุฅุตูุงุญ ุงููุดููุฉ ุจูุฌุงุญ! ุงูุขู ุงููุธุงู:

1. **ููุดุฆ ุณุฌูุงุช ุชุชุจุน ุดุงููุฉ** ูุฌููุน ุงููุญุฏุงุช ุงููุฑุชุจุทุฉ
2. **ูููุฑ ุชุชุจุนุงู ูุงููุงู** ููุนูููุงุช ุนูู ูุณุชูู ุงูุนูุฏ
3. **ูุญุงูุธ ุนูู ุงูุฃุฏุงุก** ูุน ูุนุงูุฌุฉ ูุญุณูุฉ ููุฃุฎุทุงุก
4. **ูุฏุนู ุฌููุน ุงูุณููุงุฑูููุงุช** (ุฑุจุทุ ุชุนุฏููุ ูุตู)

**ุงููุชูุฌุฉ**: ุนูุฏ ุงูุจุญุซ ุนู ุฃู ูุญุฏุฉ ูู ุณุฌูุงุช ุงูุชุชุจุนุ ุณุชุธูุฑ ุฌููุน ุงูุนูููุงุช ุงููุชุนููุฉ ุจูุง ูุจุงููุญุฏุงุช ุงููุฑุชุจุทุฉ ุจููุณ ุงูุนูุฏ.

---

**ุชู ุชุทููุฑ ูุฐุง ุงูุญู ุจูุงุณุทุฉ ุนูุฑ ุฒูุฑูุง**
*ูุธุงู ุชุชุจุน ุดุงูู ูููุญุฏุงุช ุงููุฑุชุจุทุฉ* ๐ธ๐ฆ

**ุชุงุฑูุฎ ุงูุฅููุงู**: 2025-01-01
**ุงูุญุงูุฉ**: โ ููุชูู ููุฎุชุจุฑ

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„ÙÙ„Ø§ØªØ±</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .test-button {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }
        .test-button.danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        .test-button.success {
            background: linear-gradient(135deg, #28a745, #1e7e34);
        }
        .test-button.warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #212529;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        .error {
            background-color: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }
        .success {
            background-color: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }
        .warning {
            background-color: #fff3cd;
            border-left-color: #ffc107;
            color: #856404;
        }
        .info {
            background-color: #d1ecf1;
            border-left-color: #17a2b8;
            color: #0c5460;
        }
        .current-state {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #2196f3;
        }
        .instructions {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #ff9800;
        }
        .step {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #2196f3;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ø§Ù„ÙÙ„Ø§ØªØ±</h1>
        <p>Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„ÙÙ„Ø§ØªØ± Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©</p>

        <div class="instructions">
            <h3>ğŸ“‹ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h3>
            <div class="step">
                <strong>1. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</strong>
                <br>â€¢ Ø§Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ Ø£Ùˆ Ø§ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø®Ø§ØµØ©
                <br>â€¢ Ø§ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ - ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¸Ù‡Ø± "Ø§Ù„ÙƒÙ„" (Ø¨Ø¯ÙˆÙ† ÙÙ„Ø§ØªØ±)
            </div>
            <div class="step">
                <strong>2. Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„:</strong>
                <br>â€¢ Ø§Ø®ØªØ± Ù…Ø¯ÙŠÙ†Ø© ÙˆØ¹Ù‚Ø§Ø± Ù…Ø­Ø¯Ø¯
                <br>â€¢ Ø§Ø¶ØºØ· F5 Ø£Ùˆ Ctrl+R Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                <br>â€¢ ÙŠØ¬Ø¨ Ø£Ù† ØªØ¨Ù‚Ù‰ Ù†ÙØ³ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙˆØ§Ù„Ø¹Ù‚Ø§Ø± Ù…Ø­Ø¯Ø¯ÙŠÙ†
            </div>
            <div class="step">
                <strong>3. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª:</strong>
                <br>â€¢ Ø§Ø®ØªØ± ÙÙ„Ø§ØªØ± Ù…Ø¹ÙŠÙ†Ø©
                <br>â€¢ Ø§ÙØªØ­ ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…ÙˆÙ‚Ø¹
                <br>â€¢ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¸Ù‡Ø± "Ø§Ù„ÙƒÙ„" ÙÙŠ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            </div>
        </div>

        <div class="current-state" id="currentState">
            <h3>ğŸ“Š Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</h3>
            <div id="stateDisplay">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:</h3>
            
            <button class="test-button" onclick="checkCurrentState()">
                ğŸ” ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            </button>
            
            <button class="test-button" onclick="simulateNewVisit()">
                ğŸ†• Ù…Ø­Ø§ÙƒØ§Ø© Ø²ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©
            </button>
            
            <button class="test-button" onclick="simulateReload()">
                ğŸ”„ Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„
            </button>
            
            <button class="test-button warning" onclick="testSessionDetection()">
                ğŸ•µï¸ Ø§Ø®ØªØ¨Ø§Ø± ÙƒØ´Ù Ø§Ù„Ø¬Ù„Ø³Ø©
            </button>
            
            <button class="test-button danger" onclick="clearAllData()">
                ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
            
            <button class="test-button success" onclick="window.location.reload()">
                â†» Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            </button>
        </div>

        <div id="result" class="result" style="display: none;"></div>
    </div>

    <!-- ØªØ¶Ù…ÙŠÙ† Ù…Ù„Ù JavaScript Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ -->
    <script src="script.js"></script>
    
    <script>
        // Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        function displayCurrentState() {
            const stateDisplay = document.getElementById('stateDisplay');
            
            try {
                const currentSessionId = sessionStorage.getItem('alsenidi_session_active');
                const lastVisit = localStorage.getItem('alsenidi_last_visit');
                const savedState = localStorage.getItem('alsenidi_app_state');
                
                let html = `
                    <strong>ğŸ”‘ Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù„Ø³Ø©:</strong> ${currentSessionId || 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}<br>
                    <strong>â° Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©:</strong> ${lastVisit ? new Date(parseInt(lastVisit)).toLocaleString('ar-SA') : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
                    <strong>ğŸ’¾ Ø­Ø§Ù„Ø© Ù…Ø­ÙÙˆØ¸Ø©:</strong> ${savedState ? 'Ù…ÙˆØ¬ÙˆØ¯Ø©' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©'}<br>
                `;
                
                if (savedState) {
                    const state = JSON.parse(savedState);
                    html += `
                        <br><strong>ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:</strong><br>
                        â€¢ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${state.currentCountry || 'Ø§Ù„ÙƒÙ„'}<br>
                        â€¢ Ø§Ù„Ø¹Ù‚Ø§Ø±: ${state.currentProperty || 'Ø§Ù„ÙƒÙ„'}<br>
                        â€¢ Ø§Ù„Ø­Ø§Ù„Ø©: ${state.filterStatus || 'Ø§Ù„ÙƒÙ„'}<br>
                        â€¢ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¹Ø±Ø¶: ${state.currentView || 'Ø¨Ø·Ø§Ù‚Ø§Øª'}<br>
                        â€¢ ÙˆÙ‚Øª Ø§Ù„Ø­ÙØ¸: ${new Date(state.timestamp).toLocaleString('ar-SA')}
                    `;
                }
                
                if (typeof window.currentCountry !== 'undefined') {
                    html += `
                        <br><br><strong>ğŸ¯ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹:</strong><br>
                        â€¢ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${window.currentCountry || 'Ø§Ù„ÙƒÙ„'}<br>
                        â€¢ Ø§Ù„Ø¹Ù‚Ø§Ø±: ${window.currentProperty || 'Ø§Ù„ÙƒÙ„'}<br>
                        â€¢ Ø§Ù„Ø­Ø§Ù„Ø©: ${window.filterStatus || 'Ø§Ù„ÙƒÙ„'}
                    `;
                }
                
                stateDisplay.innerHTML = html;
            } catch (error) {
                stateDisplay.innerHTML = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø©: ${error.message}`;
            }
        }

        // ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        function checkCurrentState() {
            displayCurrentState();
            showResult('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø©', 'info');
        }

        // Ù…Ø­Ø§ÙƒØ§Ø© Ø²ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function simulateNewVisit() {
            try {
                // Ù…Ø³Ø­ Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø²ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©
                sessionStorage.removeItem('alsenidi_session_active');
                
                // ØªØ¹ÙŠÙŠÙ† ÙˆÙ‚Øª Ø²ÙŠØ§Ø±Ø© Ù‚Ø¯ÙŠÙ… (Ø£ÙƒØ«Ø± Ù…Ù† 30 Ø¯Ù‚ÙŠÙ‚Ø©)
                const oldTime = Date.now() - (35 * 60 * 1000);
                localStorage.setItem('alsenidi_last_visit', oldTime.toString());
                
                showResult('ØªÙ… Ù…Ø­Ø§ÙƒØ§Ø© Ø²ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø© - Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù†ØªÙŠØ¬Ø©', 'success');
                displayCurrentState();
            } catch (error) {
                showResult(`Ø®Ø·Ø£ ÙÙŠ Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ${error.message}`, 'error');
            }
        }

        // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„
        function simulateReload() {
            try {
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯
                const sessionId = 'session_' + Date.now() + '_test';
                sessionStorage.setItem('alsenidi_session_active', sessionId);
                
                // ØªØ¹ÙŠÙŠÙ† ÙˆÙ‚Øª Ø²ÙŠØ§Ø±Ø© Ø­Ø¯ÙŠØ«
                localStorage.setItem('alsenidi_last_visit', Date.now().toString());
                
                // Ø­ÙØ¸ Ø­Ø§Ù„Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                const testState = {
                    currentCountry: 'Ø§Ù„Ø±ÙŠØ§Ø¶',
                    currentProperty: 'Ø¹Ù‚Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ',
                    filterStatus: 'Ø¬Ø§Ø±ÙŠ',
                    currentView: 'cards',
                    timestamp: Date.now(),
                    sessionId: sessionId,
                    lastVisit: Date.now()
                };
                
                localStorage.setItem('alsenidi_app_state', JSON.stringify(testState));
                
                showResult('ØªÙ… Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ - Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù†ØªÙŠØ¬Ø©', 'success');
                displayCurrentState();
            } catch (error) {
                showResult(`Ø®Ø·Ø£ ÙÙŠ Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„: ${error.message}`, 'error');
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± ÙƒØ´Ù Ø§Ù„Ø¬Ù„Ø³Ø©
        function testSessionDetection() {
            try {
                if (typeof window.isPageReload === 'function') {
                    const isReload = window.isPageReload();
                    showResult(`Ù†ØªÙŠØ¬Ø© ÙƒØ´Ù Ø§Ù„Ø¬Ù„Ø³Ø©: ${isReload ? 'Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„' : 'Ø²ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©'}`, 'info');
                } else {
                    showResult('Ø¯Ø§Ù„Ø© isPageReload ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©', 'error');
                }
                displayCurrentState();
            } catch (error) {
                showResult(`Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± ÙƒØ´Ù Ø§Ù„Ø¬Ù„Ø³Ø©: ${error.message}`, 'error');
            }
        }

        // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function clearAllData() {
            try {
                sessionStorage.removeItem('alsenidi_session_active');
                localStorage.removeItem('alsenidi_last_visit');
                localStorage.removeItem('alsenidi_app_state');
                
                showResult('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'warning');
                displayCurrentState();
            } catch (error) {
                showResult(`Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}`, 'error');
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
        function showResult(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `
                <strong>${new Date().toLocaleTimeString('ar-SA')}:</strong> ${message}
            `;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', function() {
            displayCurrentState();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†
            setInterval(displayCurrentState, 5000);
        });
    </script>
</body>
</html>

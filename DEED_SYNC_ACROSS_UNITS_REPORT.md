# ๐ ุชูุฑูุฑ ุชุทุจูู ูุฒุงููุฉ ูุนูููุงุช ุงูุตู ุนุจุฑ ุงููุญุฏุงุช

## ๐ ูุตู ุงูููุฒุฉ ุงููุทููุจุฉ

**ุงูุทูุจ ุงูุฃุตูู:**
> "ูู ุญุงูุฉ ูุชุญ ุนูุงุฑ ูู ุนุฏุฉ ูุญุฏุงุชุ ุซู ููุฑ ุนูู ุชุญุฑูุฑ ุจุทุงูุฉ ูู ุจุทุงูุฉ ูุชุนุฏูู ุจูุงูุงุช ุงูุตูุ ูู ูููู ูุณุฎ ูุนูููุงุช ุงูุตู ุงูู ูู ุงููุญุฏุงุชุ ูุซูุง ูู ุงููุญุฏู ูุญู ุงูุชุนุฏูู ุชู ุชุนุฏูููุง ูู 1 ูุชููู 2 ุงุฑูุฏ ูุณุฎ ุฑูู 2 ุงูู ูู ุงููุนูููุงุช ู ููุณ ุงูุญูู"

**ุงูููููู:**
- ูุนูููุงุช ุงูุตู ูู ูุนูููุงุช **ุฎุงุตุฉ ุจุงูุนูุงุฑ ููู** ูููุณ ุจูุญุฏุฉ ูุนููุฉ
- ุนูุฏ ุชุนุฏูู ูุนูููุงุช ุงูุตู ูู ุฃู ูุญุฏุฉุ ูุฌุจ ุฃู ุชูุทุจู ุงูุชุบููุฑุงุช ุนูู **ุฌููุน ูุญุฏุงุช ุงูุนูุงุฑ**
- ูุฐุง ูุถูู **ุชูุงุณู ุงูุจูุงูุงุช** ููููุน ุงูุชุถุงุฑุจ ูู ูุนูููุงุช ุงูุตู

## โ ุงูุชุทุจูู ุงูููุฌุฒ

### **1. ุฅูุดุงุก ุฏุงูุฉ `syncDeedInfoAcrossUnits`**

```javascript
// ูุฒุงููุฉ ูุนูููุงุช ุงูุตู ุนุจุฑ ุฌููุน ูุญุฏุงุช ุงูุนูุงุฑ
async function syncDeedInfoAcrossUnits(propertyName, updatedProperty, deedFields) {
    console.log(`๐ ุจุฏุก ูุฒุงููุฉ ูุนูููุงุช ุงูุตู ููุนูุงุฑ "${propertyName}" ุนุจุฑ ุฌููุน ุงููุญุฏุงุช...`);
    
    // ุงูุจุญุซ ุนู ุฌููุน ุงููุญุฏุงุช ูู ููุณ ุงูุนูุงุฑ
    const relatedUnits = properties.filter(p => p['ุงุณู ุงูุนูุงุฑ'] === propertyName);
    
    if (relatedUnits.length <= 1) {
        console.log(`โน๏ธ ุงูุนูุงุฑ "${propertyName}" ูุญุชูู ุนูู ูุญุฏุฉ ูุงุญุฏุฉ ููุทุ ูุง ุญุงุฌุฉ ูููุฒุงููุฉ`);
        return { updatedCount: 0, message: 'ูุญุฏุฉ ูุงุญุฏุฉ ููุท' };
    }
    
    // ุชุญุฏูุซ ุฌููุน ุงููุญุฏุงุช ุงูุฃุฎุฑู ูุญููุงู
    let updatedCount = 0;
    relatedUnits.forEach((unit) => {
        const unitIndex = properties.findIndex(p => 
            p['ุงุณู ุงูุนูุงุฑ'] === unit['ุงุณู ุงูุนูุงุฑ'] && 
            p['ุฑูู  ุงููุญุฏุฉ '] === unit['ุฑูู  ุงููุญุฏุฉ ']
        );
        
        if (unitIndex !== -1) {
            // ุชุญุฏูุซ ูุนูููุงุช ุงูุตู ููุท
            deedFields.forEach(field => {
                const oldValue = properties[unitIndex][field];
                const newValue = updatedProperty[field];
                
                if (oldValue !== newValue) {
                    properties[unitIndex][field] = newValue;
                    console.log(`โ ุงููุญุฏุฉ ${unit['ุฑูู  ุงููุญุฏุฉ ']}: ${field} = "${newValue}"`);
                }
            });
            
            // ุชุญุฏูุซ ูุนูููุงุช ุงูุชุญุฏูุซ
            properties[unitIndex]['ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ'] = new Date().toLocaleDateString('ar-SA');
            properties[unitIndex]['ููุน ุงูุชุญุฏูุซ'] = 'ูุฒุงููุฉ ูุนูููุงุช ุงูุตู';
            
            updatedCount++;
        }
    });
    
    // ูุฒุงููุฉ ูุน Supabase
    let supabaseSuccess = 0;
    if (typeof savePropertyToSupabase === 'function') {
        for (const unit of relatedUnits) {
            const unitIndex = properties.findIndex(p => 
                p['ุงุณู ุงูุนูุงุฑ'] === unit['ุงุณู ุงูุนูุงุฑ'] && 
                p['ุฑูู  ุงููุญุฏุฉ '] === unit['ุฑูู  ุงููุญุฏุฉ ']
            );
            
            if (unitIndex !== -1) {
                const result = await savePropertyToSupabase(properties[unitIndex]);
                if (result) {
                    supabaseSuccess++;
                }
                // ุชุฃุฎูุฑ ูุตูุฑ ุจูู ุงูุญูุธุงุช
                await new Promise(resolve => setTimeout(resolve, 200));
            }
        }
    }
    
    return {
        updatedCount: updatedCount,
        supabaseSuccess: supabaseSuccess,
        changedFields: deedFields.map(field => ({
            field: field,
            newValue: updatedProperty[field] || 'ุบูุฑ ูุญุฏุฏ'
        })),
        propertyName: propertyName
    };
}
```

### **2. ุชูุงูู ุงููุฒุงููุฉ ูุน ุฏุงูุฉ `savePropertyEdit`**

```javascript
// ูู ุฏุงูุฉ savePropertyEdit
// ูุฒุงููุฉ ูุนูููุงุช ุงูุตู ูุน ุฌููุน ูุญุฏุงุช ุงูุนูุงุฑ
const syncResult = await syncDeedInfoAcrossUnits(originalPropertyName, updatedProperty, deedFields);

// ุญูุธ ูุชูุฌุฉ ุงููุฒุงููุฉ ูุนุฑุถูุง ูู ุฑุณุงูุฉ ุงููุฌุงุญ
window.lastSyncResult = syncResult;
```

### **3. ุชุญุณูู ุฑุณุงุฆู ุงููุฌุงุญ**

```javascript
// ุจูุงุก ุฑุณุงูุฉ ุงููุฌุงุญ ูุน ุชูุงุตูู ุงููุฒุงููุฉ
let message = 'ุชู ุญูุธ ุงูุชุบููุฑุงุช ุจูุฌุงุญ!';

// ุฅุถุงูุฉ ูุนูููุงุช ูุฒุงููุฉ ูุนูููุงุช ุงูุตู
if (window.lastSyncResult && window.lastSyncResult.updatedCount > 0) {
    message += `\n๐ ุชู ุชุญุฏูุซ ูุนูููุงุช ุงูุตู ูู ${window.lastSyncResult.updatedCount} ูุญุฏุฉ`;
    
    if (window.lastSyncResult.changedFields && window.lastSyncResult.changedFields.length > 0) {
        message += '\n๐ ูุนูููุงุช ุงูุตู ุงููุญุฏุซุฉ:';
        window.lastSyncResult.changedFields.forEach(change => {
            message += `\nโข ${change.field}: ${change.newValue}`;
        });
    }
    
    if (window.lastSyncResult.supabaseSuccess > 0) {
        message += `\nโ๏ธ ุชู ุญูุธ ${window.lastSyncResult.supabaseSuccess} ูุญุฏุฉ ูู ุงูุณุญุงุจุฉ`;
    }
}
```

## ๐งช ููู ุงูุงุฎุชุจุงุฑ

### **`test-deed-sync-across-units.html`**
ููู ุงุฎุชุจุงุฑ ุชูุงุนูู ุดุงูู ูุชุถูู:

#### **ุงูููุฒุงุช:**
- **ุฅูุดุงุก ุนูุงุฑ ูุชุนุฏุฏ ุงููุญุฏุงุช:** ุนูุงุฑ ุจู 3 ูุญุฏุงุช ูุฎุชููุฉ
- **ุนุฑุถ ูุฑุฆู ูููุญุฏุงุช:** ุจุทุงูุงุช ุชูุงุนููุฉ ููู ูุญุฏุฉ
- **ูุฑุงูุจุฉ ุงููุฒุงููุฉ:** ุชุชุจุน ุนูููุฉ ุงููุฒุงููุฉ ูู ุงูููุช ุงููุนูู
- **ุงุฎุชุจุงุฑ ุชูุงุนูู:** ุฃุฒุฑุงุฑ ูุชุญุฑูุฑ ุฃู ูุญุฏุฉ ูุจุงุดุฑุฉ

#### **ุงูุนูุงุฑ ุงูุชุฌุฑูุจู:**
**ุจุฑุฌ ุงูุฃูุฏูุณ** - ุนูุงุฑ ุจู 3 ูุญุฏุงุช:
1. **ุงููุญุฏุฉ A101:** ูุคุฌุฑุฉ ูุฃุญูุฏ ูุญูุฏ ุนูู
2. **ุงููุญุฏุฉ A102:** ูุคุฌุฑุฉ ููุงุทูุฉ ุฃุญูุฏ  
3. **ุงููุญุฏุฉ A103:** ูุงุฑุบุฉ

#### **ูุนูููุงุช ุงูุตู ุงููุดุชุฑูุฉ:**
- **ุฑูู ุงูุตู:** DEED555666777
- **ูุณุงุญุฉ ุงูุตู:** 1500 ูยฒ
- **ุงูุณุฌู ุงูุนููู:** REG555666
- **ุงููุงูู:** ุดุฑูุฉ ุงูุฃูุฏูุณ ุงูุนูุงุฑูุฉ
- **ูููุน ุงูุนูุงุฑ:** ูุญุฏุฏ

## ๐ฏ ููููุฉ ุงูุงุฎุชุจุงุฑ

### **ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:**
1. **ุงูุชุญ ููู ุงูุงุฎุชุจุงุฑ:** `test-deed-sync-across-units.html`
2. **ุงุถุบุท "ุฅูุดุงุก ุนูุงุฑ ูุชุนุฏุฏ ุงููุญุฏุงุช"** ูุฅูุดุงุก ุงูุนูุงุฑ ุงูุชุฌุฑูุจู
3. **ุงุฎุชุฑ ุฃู ูุญุฏุฉ** ูุงุถุบุท "ุชุญุฑูุฑ ูุฐู ุงููุญุฏุฉ"
4. **ูู ูุณู "ูุนูููุงุช ุงูุนูุงุฑ ูุงูุตู":**
   - ุบููุฑ **ูุณุงุญุฉ ุงูุตู** ูู 1500 ุฅูู 2000
   - ุฃู ุบููุฑ **ุฑูู ุงูุตู** ุฅูู ุฑูู ุฌุฏูุฏ
5. **ุงุญูุธ ุงูุชุบููุฑุงุช** ูุงูุฑุฃ ุฑุณุงูุฉ ุงููุฌุงุญ
6. **ุงุถุบุท "ุชุญุฏูุซ ุงูุนุฑุถ"** ูุฑุคูุฉ ุฃู ุฌููุน ุงููุญุฏุงุช ุชุญุฏูุซุช

### **ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
โ ุชู ุญูุธ ุงูุชุบููุฑุงุช ุจูุฌุงุญ!
๐ ุชู ุชุญุฏูุซ ูุนูููุงุช ุงูุตู ูู 3 ูุญุฏุฉ
๐ ูุนูููุงุช ุงูุตู ุงููุญุฏุซุฉ:
โข ูุณุงุญุฉ ุงูุตู: 2000
โ๏ธ ุชู ุญูุธ 3 ูุญุฏุฉ ูู ุงูุณุญุงุจุฉ
โ ุชู ุญูุธ ุงูุชุบููุฑุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุณุญุงุจูุฉ
```

## ๐ ุงูุญููู ุงููุชุฑุงุจุทุฉ

### **โ ุงูุญููู ุงูุชู ุชุชู ูุฒุงููุชูุง:**
1. **ุฑูู ุงูุตู** - ูุดุชุฑู ุจูู ุฌููุน ุงููุญุฏุงุช
2. **ูุณุงุญุฉ ุงูุตู** - ูุดุชุฑู ุจูู ุฌููุน ุงููุญุฏุงุช  
3. **ุงูุณุฌู ุงูุนููู** - ูุดุชุฑู ุจูู ุฌููุน ุงููุญุฏุงุช
4. **ุงููุงูู** - ูุดุชุฑู ุจูู ุฌููุน ุงููุญุฏุงุช
5. **ูููุน ุงูุนูุงุฑ** - ูุดุชุฑู ุจูู ุฌููุน ุงููุญุฏุงุช

### **๐ ุงูุญููู ุงูุชู ูุง ุชุชุฃุซุฑ:**
1. **ุฑูู ุงููุญุฏุฉ** - ุฎุงุต ุจูู ูุญุฏุฉ
2. **ูุนูููุงุช ุงููุณุชุฃุฌุฑ ูุงูุนูุฏ** - ุฎุงุตุฉ ุจูู ูุญุฏุฉ
3. **ูุณุงุญุฉ ุงููุญุฏุฉ** - ูุฏ ุชุฎุชูู ุนู ูุณุงุญุฉ ุงูุตู
4. **ุชูุงุตูู ุงูุฃูุณุงุท ูุงููุจุงูุบ** - ุฎุงุตุฉ ุจูู ุนูุฏ

## ๐ ุงููุชุงุฆุฌ ุงููุญููุฉ

### **โ ุงูุณููู ุงูุฌุฏูุฏ:**

#### **ุณููุงุฑูู 1: ุชุนุฏูู ูุณุงุญุฉ ุงูุตู**
- **ูุจู:** ุงููุญุฏุฉ A101 = 1500ุ ุงููุญุฏุฉ A102 = 1500ุ ุงููุญุฏุฉ A103 = 1500
- **ุงูุชุญุฑูุฑ:** ุชุบููุฑ ูุณุงุญุฉ ุงูุตู ูู ุงููุญุฏุฉ A101 ุฅูู 2000
- **ุจุนุฏ:** ุงููุญุฏุฉ A101 = 2000ุ ุงููุญุฏุฉ A102 = 2000ุ ุงููุญุฏุฉ A103 = 2000 โ

#### **ุณููุงุฑูู 2: ุชุนุฏูู ุฑูู ุงูุตู**
- **ูุจู:** ุฌููุน ุงููุญุฏุงุช ุชุญูู ุฑูู ุงูุตู "DEED555666777"
- **ุงูุชุญุฑูุฑ:** ุชุบููุฑ ุฑูู ุงูุตู ูู ุงููุญุฏุฉ A103 ุฅูู "DEED999888777"
- **ุจุนุฏ:** ุฌููุน ุงููุญุฏุงุช ุชุญูู ุฑูู ุงูุตู "DEED999888777" โ

#### **ุณููุงุฑูู 3: ุชุนุฏูู ุงููุงูู**
- **ูุจู:** ุฌููุน ุงููุญุฏุงุช ุชุญูู ุงููุงูู "ุดุฑูุฉ ุงูุฃูุฏูุณ ุงูุนูุงุฑูุฉ"
- **ุงูุชุญุฑูุฑ:** ุชุบููุฑ ุงููุงูู ูู ุงููุญุฏุฉ A102 ุฅูู "ุดุฑูุฉ ุงูุฃูุฏูุณ ุงูุฌุฏูุฏุฉ"
- **ุจุนุฏ:** ุฌููุน ุงููุญุฏุงุช ุชุญูู ุงููุงูู "ุดุฑูุฉ ุงูุฃูุฏูุณ ุงูุฌุฏูุฏุฉ" โ

### **๐ ุงูุญูุงูุฉ ุงููุทุจูุฉ:**
1. **ุนุฏู ุชุฃุซูุฑ ุนูู ุงููุนูููุงุช ุงูุฎุงุตุฉ:** ูุนูููุงุช ุงููุณุชุฃุฌุฑ ูุงูุนูุฏ ุชุจูู ุฎุงุตุฉ ุจูู ูุญุฏุฉ
2. **ูุฒุงููุฉ ุงูุชูุงุฆูุฉ:** ููุท ุญููู ูุนูููุงุช ุงูุตู ุชุชู ูุฒุงููุชูุง
3. **ูุฒุงููุฉ ุณุญุงุจูุฉ:** ุฌููุน ุงูุชุบููุฑุงุช ุชูุญูุธ ูู Supabase
4. **ุชุณุฌูู ููุตู:** ูุฑุงูุจุฉ ูุงููุฉ ูุนูููุฉ ุงููุฒุงููุฉ

## ๐ ููุงุฑูุฉ ูุจู ูุจุนุฏ ุงูุชุทุจูู

| ุงูุฌุงูุจ | ูุจู ุงูุชุทุจูู | ุจุนุฏ ุงูุชุทุจูู |
|---------|-------------|-------------|
| **ุชุฑุงุจุท ูุนูููุงุช ุงูุตู** | โ ูู ูุญุฏุฉ ูุณุชููุฉ | โ ูุชุฑุงุจุทุฉ ุนุจุฑ ุฌููุน ุงููุญุฏุงุช |
| **ุชุนุฏูู ูุนูููุงุช ุงูุตู** | โ ูุคุซุฑ ุนูู ูุญุฏุฉ ูุงุญุฏุฉ ููุท | โ ูุคุซุฑ ุนูู ุฌููุน ูุญุฏุงุช ุงูุนูุงุฑ |
| **ุชูุงุณู ุงูุจูุงูุงุช** | โ ูุฏ ุชุฎุชูู ูุนูููุงุช ุงูุตู | โ ูุนูููุงุช ุงูุตู ูุชูุงุณูุฉ |
| **ุงููุฒุงููุฉ ุงูุณุญุงุจูุฉ** | โ ูุญุฏุฉ ูุงุญุฏุฉ ููุท | โ ุฌููุน ุงููุญุฏุงุช |
| **ุฑุณุงุฆู ุงูุชุฃููุฏ** | โ ูุง ุชุฐูุฑ ุงููุฒุงููุฉ | โ ุชูุงุตูู ุงููุฒุงููุฉ |

## ๐ฏ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

### **ุชู ุชุทุจูู ุงูููุฒุฉ ุจุงููุงูู:**

1. โ **ุชุฑุงุจุท ูุนูููุงุช ุงูุตู** ุนุจุฑ ุฌููุน ูุญุฏุงุช ุงูุนูุงุฑ
2. โ **ูุฒุงููุฉ ุชููุงุฆูุฉ** ุนูุฏ ุชุนุฏูู ุฃู ูุญุฏุฉ
3. โ **ุญูุธ ุณุญุงุจู** ูุฌููุน ุงููุญุฏุงุช ุงููุญุฏุซุฉ
4. โ **ุฑุณุงุฆู ุชุฃููุฏ ูุงุถุญุฉ** ุชุชุถูู ุนุฏุฏ ุงููุญุฏุงุช ุงููุญุฏุซุฉ
5. โ **ุญูุงูุฉ ุงููุนูููุงุช ุงูุฎุงุตุฉ** ุจูู ูุญุฏุฉ
6. โ **ุงุฎุชุจุงุฑ ุดุงูู** ููุชุญูู ูู ุงูููุฒุฉ

### **ุงูุงุฎุชุจุงุฑ:**
```bash
# ุงูุชุญ ููู ุงูุงุฎุชุจุงุฑ
test-deed-sync-across-units.html

# ุงุชุจุน ุงูุฎุทูุงุช:
1. ุฅูุดุงุก ุนูุงุฑ ูุชุนุฏุฏ ุงููุญุฏุงุช
2. ุชุญุฑูุฑ ูุนูููุงุช ุงูุตู ูู ุฃู ูุญุฏุฉ
3. ูุฑุงูุจุฉ ุงููุฒุงููุฉ ูู ุงูููุช ุงููุนูู
4. ุงูุชุญูู ูู ุชุญุฏูุซ ุฌููุน ุงููุญุฏุงุช
```

---

**ุชุงุฑูุฎ ุงูุชุทุจูู:** 17 ููููู 2025  
**ุญุงูุฉ ุงูููุฒุฉ:** ููุชููุฉ ููุฎุชุจุฑุฉ โ  
**ุงูุถูุงู:** ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ุชูุฑ ุจูุฌุงุญ

**ุงูุขู ูุนูููุงุช ุงูุตู ูุชุฑุงุจุทุฉ ุจูู ุฌููุน ูุญุฏุงุช ุงูุนูุงุฑ! ุนูุฏ ุชุนุฏูู ูุนูููุงุช ุงูุตู ูู ุฃู ูุญุฏุฉุ ุชูุทุจู ุงูุชุบููุฑุงุช ุชููุงุฆูุงู ุนูู ุฌููุน ุงููุญุฏุงุช ุงูุฃุฎุฑู! ๐**

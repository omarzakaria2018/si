<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø®ØµØµ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background: #f5f5f5;
            direction: rtl;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-button.success {
            background: #28a745;
        }
        .test-button.error {
            background: #dc3545;
        }
        .test-button.warning {
            background: #ffc107;
            color: #000;
        }
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #007bff;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø®ØµØµ</h1>
        <p>Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙˆÙ„ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Supabase</p>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ -->
        <div class="test-section">
            <h3>ğŸ”Œ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</h3>
            <button class="test-button" onclick="testConnection()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase</button>
            <button class="test-button" onclick="testTableExists()">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
            <button class="test-button" onclick="testManagerLoaded()">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</button>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
        <div class="test-section">
            <h3>ğŸ“ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
            <button class="test-button" onclick="testInsertLog()">Ø¥Ø¯Ø±Ø§Ø¬ Ø³Ø¬Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ</button>
            <button class="test-button" onclick="testLoadLogs()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
            <button class="test-button" onclick="testSearchLogs()">Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
            <button class="test-button" onclick="testDeleteLog()">Ø­Ø°Ù Ø³Ø¬Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ</button>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="test-section">
            <h3>ğŸ“Š Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
            <button class="test-button" onclick="testGetStats()">Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
            <button class="test-button" onclick="testCleanupOldLogs()">ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</button>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙƒØ§Ù…Ù„ -->
        <div class="test-section">
            <h3>ğŸ”— Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙƒØ§Ù…Ù„</h3>
            <button class="test-button" onclick="testAddChangeLog()">Ø§Ø®ØªØ¨Ø§Ø± addChangeLog</button>
            <button class="test-button" onclick="testTrackingManagement()">Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
        </div>

        <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="test-section">
            <h3>ğŸ“ˆ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
            <div id="statsContainer" class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalLogs">-</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todayLogs">-</div>
                    <div class="stat-label">Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="weekLogs">-</div>
                    <div class="stat-label">Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="monthLogs">-</div>
                    <div class="stat-label">Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø´Ù‡Ø±</div>
                </div>
            </div>
            <button class="test-button" onclick="refreshStats()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
        </div>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
        <div class="test-section">
            <h3>ğŸ› ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ…</h3>
            <button class="test-button" onclick="runAllTests()">ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
            <button class="test-button warning" onclick="clearResults()">Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            <button class="test-button error" onclick="clearAllTestLogs()">Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
        </div>

        <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
        <div class="results" id="results">
Ø¬Ø§Ù‡Ø² Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª...

Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø®ØªÙ„Ù Ø¬ÙˆØ§Ù†Ø¨ Ù†Ø¸Ø§Ù… Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯.
        </div>
    </div>

    <!-- ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="tracking-logs-manager.js"></script>

    <script>
        let testLogId = null;

        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ù†ØªÙŠØ¬Ø©
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const statusClass = type === 'success' ? 'success' : 
                               type === 'error' ? 'error' : 
                               type === 'warning' ? 'warning' : 'info';
            
            results.innerHTML += `[${timestamp}] ${message}\n`;
            results.scrollTop = results.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function clearResults() {
            document.getElementById('results').innerHTML = 'ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬...\n';
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase
        async function testConnection() {
            addResult('ğŸ”Œ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase...', 'info');
            
            try {
                if (typeof supabaseClient === 'undefined') {
                    throw new Error('supabaseClient ØºÙŠØ± Ù…Ø¹Ø±Ù');
                }
                
                const { data, error } = await supabaseClient
                    .from('properties')
                    .select('count', { count: 'exact', head: true });
                
                if (error) {
                    throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`);
                }
                
                addResult('âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase ÙŠØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                addResult(`âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase: ${error.message}`, 'error');
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        async function testTableExists() {
            addResult('ğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ø¯ÙˆÙ„ tracking_logs...', 'info');
            
            try {
                if (typeof window.trackingLogsManager === 'undefined') {
                    throw new Error('Ù…Ø¯ÙŠØ± Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØªØ¨Ø¹ ØºÙŠØ± Ù…Ø­Ù…Ù„');
                }
                
                const exists = await window.trackingLogsManager.ensureTrackingLogsTableExists();
                
                if (exists) {
                    addResult('âœ… Ø¬Ø¯ÙˆÙ„ tracking_logs Ù…ÙˆØ¬ÙˆØ¯ ÙˆÙŠØ¹Ù…Ù„', 'success');
                } else {
                    addResult('âŒ Ø¬Ø¯ÙˆÙ„ tracking_logs ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø£Ùˆ Ù„Ø§ ÙŠØ¹Ù…Ù„', 'error');
                }
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„: ${error.message}`, 'error');
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±
        function testManagerLoaded() {
            addResult('ğŸ“¦ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ù…Ø¯ÙŠØ± Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØªØ¨Ø¹...', 'info');
            
            if (typeof window.trackingLogsManager !== 'undefined') {
                addResult('âœ… Ù…Ø¯ÙŠØ± Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØªØ¨Ø¹ Ù…Ø­Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                addResult(`ğŸ“‹ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ØªØ§Ø­Ø©: ${Object.keys(window.trackingLogsManager).join(', ')}`, 'info');
            } else {
                addResult('âŒ Ù…Ø¯ÙŠØ± Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØªØ¨Ø¹ ØºÙŠØ± Ù…Ø­Ù…Ù„', 'error');
            }
        }

        // Ø¥Ø¯Ø±Ø§Ø¬ Ø³Ø¬Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ
        async function testInsertLog() {
            addResult('ğŸ“ Ø¥Ø¯Ø±Ø§Ø¬ Ø³Ø¬Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ...', 'info');
            
            try {
                const testLog = {
                    operation_type: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…',
                    unit_number: 'TEST-' + Date.now(),
                    property_name: 'Ø¹Ù‚Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ',
                    tenant_name: 'Ù…Ø³ØªØ£Ø¬Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ',
                    tenant_phone: '0501234567',
                    tenant_phone_2: '0507654321',
                    description: 'Ø³Ø¬Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…',
                    changes: { test: true, timestamp: new Date().toISOString() },
                    additional_info: { source: 'test_page' }
                };
                
                const result = await window.trackingLogsManager.saveTrackingLogToSupabase(testLog);
                
                if (result && result.id) {
                    testLogId = result.id;
                    addResult(`âœ… ØªÙ… Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¨Ù†Ø¬Ø§Ø­: ${result.id}`, 'success');
                } else {
                    addResult('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ', 'error');
                }
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø³Ø¬Ù„: ${error.message}`, 'error');
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
        async function testLoadLogs() {
            addResult('ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª...', 'info');
            
            try {
                const logs = await window.trackingLogsManager.loadTrackingLogsFromSupabase(10);
                
                addResult(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${logs.length} Ø³Ø¬Ù„`, 'success');
                
                if (logs.length > 0) {
                    addResult(`ğŸ“‹ Ø¢Ø®Ø± Ø³Ø¬Ù„: ${logs[0].operation_type} - ${logs[0].unit_number}`, 'info');
                }
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${error.message}`, 'error');
            }
        }

        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
        async function testSearchLogs() {
            addResult('ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª...', 'info');
            
            try {
                const searchResults = await window.trackingLogsManager.searchTrackingLogs({
                    operation_type: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…',
                    limit: 5
                });
                
                addResult(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${searchResults.length} Ø³Ø¬Ù„ Ø§Ø®ØªØ¨Ø§Ø±`, 'success');
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«: ${error.message}`, 'error');
            }
        }

        // Ø­Ø°Ù Ø³Ø¬Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ
        async function testDeleteLog() {
            if (!testLogId) {
                addResult('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø­Ø°Ù. Ù‚Ù… Ø¨Ø¥Ø¯Ø±Ø§Ø¬ Ø³Ø¬Ù„ Ø£ÙˆÙ„Ø§Ù‹', 'warning');
                return;
            }
            
            addResult(`ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ: ${testLogId}...`, 'info');
            
            try {
                const result = await window.trackingLogsManager.deleteTrackingLog(testLogId);
                
                if (result) {
                    addResult('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    testLogId = null;
                } else {
                    addResult('âŒ ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ', 'error');
                }
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„: ${error.message}`, 'error');
            }
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        async function testGetStats() {
            addResult('ğŸ“Š ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...', 'info');
            
            try {
                const stats = await window.trackingLogsManager.getTrackingLogsStats();
                
                if (stats) {
                    addResult('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    addResult(`ğŸ“ˆ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${stats.total_logs}`, 'info');
                    addResult(`ğŸ“… Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…: ${stats.logs_today}`, 'info');
                    addResult(`ğŸ“Š Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ø§Ù‹: ${stats.most_common_operation}`, 'info');
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
                    updateStatsDisplay(stats);
                } else {
                    addResult('âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª', 'error');
                }
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: ${error.message}`, 'error');
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStatsDisplay(stats) {
            document.getElementById('totalLogs').textContent = stats.total_logs || 0;
            document.getElementById('todayLogs').textContent = stats.logs_today || 0;
            document.getElementById('weekLogs').textContent = stats.logs_this_week || 0;
            document.getElementById('monthLogs').textContent = stats.logs_this_month || 0;
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        async function refreshStats() {
            await testGetStats();
        }

        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        async function testCleanupOldLogs() {
            addResult('ğŸ§¹ Ø§Ø®ØªØ¨Ø§Ø± ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©...', 'info');
            
            try {
                const deletedCount = await window.trackingLogsManager.cleanupOldTrackingLogs(1); // Ø­Ø°Ù Ø§Ù„Ø£Ù‚Ø¯Ù… Ù…Ù† ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯
                
                addResult(`âœ… ØªÙ… Ø­Ø°Ù ${deletedCount} Ø³Ø¬Ù„ Ù‚Ø¯ÙŠÙ…`, 'success');
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${error.message}`, 'error');
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± addChangeLog
        async function testAddChangeLog() {
            addResult('ğŸ”— Ø§Ø®ØªØ¨Ø§Ø± Ø¯Ø§Ù„Ø© addChangeLog...', 'info');
            
            try {
                if (typeof addChangeLog === 'function') {
                    const unitData = {
                        'Ø±Ù‚Ù…  Ø§Ù„ÙˆØ­Ø¯Ø© ': 'TEST-INTEGRATION',
                        'Ø§Ø³Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±': 'Ø¹Ù‚Ø§Ø± Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙƒØ§Ù…Ù„',
                        'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±': 'Ù…Ø³ØªØ£Ø¬Ø± Ø§Ø®ØªØ¨Ø§Ø±',
                        'Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±': '0501111111',
                        'Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø¥Ø¶Ø§ÙÙŠ': '0502222222'
                    };
                    
                    await addChangeLog('Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙƒØ§Ù…Ù„', unitData, { test: true }, { integration: true });
                    
                    addResult('âœ… ØªÙ… Ø§Ø®ØªØ¨Ø§Ø± addChangeLog Ø¨Ù†Ø¬Ø§Ø­', 'success');
                } else {
                    addResult('âŒ Ø¯Ø§Ù„Ø© addChangeLog ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©', 'error');
                }
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± addChangeLog: ${error.message}`, 'error');
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        function testTrackingManagement() {
            addResult('ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØªØ¨Ø¹...', 'info');
            
            try {
                if (typeof showTrackingManagementModal === 'function') {
                    addResult('âœ… Ø¯Ø§Ù„Ø© showTrackingManagementModal Ù…ØªÙˆÙØ±Ø©', 'success');
                    addResult('ğŸ’¡ ÙŠÙ…ÙƒÙ†Ùƒ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', 'info');
                } else {
                    addResult('âŒ Ø¯Ø§Ù„Ø© showTrackingManagementModal ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©', 'error');
                }
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©: ${error.message}`, 'error');
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
        async function runAllTests() {
            addResult('ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª...', 'info');
            addResult('=' .repeat(50), 'info');
            
            await testConnection();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testManagerLoaded();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testTableExists();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testInsertLog();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testLoadLogs();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testSearchLogs();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testGetStats();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testAddChangeLog();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            testTrackingManagement();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await testDeleteLog();
            
            addResult('=' .repeat(50), 'info');
            addResult('ğŸ‰ Ø§Ù†ØªÙ‡Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª!', 'success');
        }

        // Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        async function clearAllTestLogs() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©ØŸ')) {
                return;
            }
            
            addResult('ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©...', 'warning');
            
            try {
                const testLogs = await window.trackingLogsManager.searchTrackingLogs({
                    operation_type: 'Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…'
                });
                
                let deletedCount = 0;
                for (const log of testLogs) {
                    const result = await window.trackingLogsManager.deleteTrackingLog(log.id);
                    if (result) deletedCount++;
                }
                
                addResult(`âœ… ØªÙ… Ø­Ø°Ù ${deletedCount} Ø³Ø¬Ù„ ØªØ¬Ø±ÙŠØ¨ÙŠ`, 'success');
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©: ${error.message}`, 'error');
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', async () => {
            addResult('ğŸ”„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©...', 'info');
            await new Promise(resolve => setTimeout(resolve, 1000)); // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
            await refreshStats();
        });
    </script>
</body>
</html>

# ุฅุตูุงุญ ุฎุทุฃ ุนููุฏ owner_name ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ูุตู ุงููุดููุฉ

ูุงู ุงูุชุทุจูู ููุงุฌู ุฎุทุฃ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:

```
"Could not find the 'owner_name' column of 'properties' in the schema cache"
```

### ุงูุณุจุจ
- ุงูููุฏ ูุญุงูู ุงููุตูู ุฅูู ุนููุฏ `owner_name` ูู ุฌุฏูู `properties`
- ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุญุชูู ุนูู ุนููุฏ `owner` ููุท ูููุณ `owner_name`
- ุนุฏู ุชุทุงุจู ุจูู schema ุงูููุฏ ูschema ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ง ุงูุญู ุงููุทุจู

### 1. ุฅุถุงูุฉ ุงูุนููุฏ ุงูููููุฏ
```sql
ALTER TABLE properties 
ADD COLUMN IF NOT EXISTS owner_name TEXT;
```

### 2. ูุณุฎ ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ
```sql
UPDATE properties 
SET owner_name = owner 
WHERE owner IS NOT NULL;
```

### 3. ุชุญุฏูุซ ุงูููุฏ
ุชู ุฅุถุงูุฉ ุฏูุงู ูุณุงุนุฏุฉ ูู `script.js`:

```javascript
// ุฏุงูุฉ ููุญุตูู ุนูู ูููุฉ ุงููุงูู ูู ุฃู ูู ุงูุนููุฏูู
function getOwnerValue(property) {
    return property.owner_name || property.owner || null;
}

// ุฏุงูุฉ ูุชุญุฏูุซ ุฃุนูุฏุฉ ุงููุงูู (ููุงููุง)
function setOwnerValue(propertyData, ownerValue) {
    propertyData.owner = ownerValue;
    propertyData.owner_name = ownerValue;
    return propertyData;
}
```

### 4. ุฅูุดุงุก Trigger ููุชุฒุงูู
```sql
CREATE OR REPLACE FUNCTION sync_owner_columns()
RETURNS TRIGGER AS $$
BEGIN
    IF NEW.owner IS DISTINCT FROM OLD.owner THEN
        NEW.owner_name = NEW.owner;
    END IF;
    
    IF NEW.owner_name IS DISTINCT FROM OLD.owner_name THEN
        NEW.owner = NEW.owner_name;
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

## โ ุงููุชุงุฆุฌ

### ูุจู ุงูุฅุตูุงุญ
- โ ุฎุทุฃ ูู ูุญุฏุฉ ุงูุชุญูู: "Could not find the 'owner_name' column"
- โ ูุดู ูู ุชุญููู ุงูุจูุงูุงุช ูู Supabase
- โ ุนุฏู ุนูู ูุธุงุฆู ุฅุฏุงุฑุฉ ุงูุนูุงุฑุงุช

### ุจุนุฏ ุงูุฅุตูุงุญ
- โ ุงุฎุชูุงุก ุฎุทุฃ ุงูุนููุฏ ุงูููููุฏ
- โ ุชุญููู ุงูุจูุงูุงุช ุจูุฌุงุญ ูู Supabase
- โ ุนูู ุฌููุน ูุธุงุฆู ุงูุชุทุจูู
- โ ุงูุชูุงูู ูุน ููุง ุงูุนููุฏูู (owner ู owner_name)

## ๐ ุฅุญุตุงุฆูุงุช ุงูุฅุตูุงุญ

```sql
-- ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ
SELECT 
    COUNT(*) as total_records,      -- 580 ุณุฌู
    COUNT(owner) as owner_count,    -- 580 ุณุฌู
    COUNT(owner_name) as owner_name_count  -- 580 ุณุฌู
FROM properties;
```

- **ุฅุฌูุงูู ุงูุณุฌูุงุช**: 580
- **ุงูุณุฌูุงุช ูุน owner**: 580
- **ุงูุณุฌูุงุช ูุน owner_name**: 580
- **ูุนุฏู ุงููุฌุงุญ**: 100%

## ๐ ุงูุชุญุฏูุซุงุช ุงููุทุจูุฉ

### ูู script.js
1. ุฅุถุงูุฉ ุฏูุงู ูุณุงุนุฏุฉ ููุชุนุงูู ูุน ุงูุนููุฏูู
2. ุชุญุฏูุซ mapping ุงูุจูุงูุงุช ูุฏุนู ููุง ุงูุนููุฏูู
3. ุชุญุฏูุซ schema ุงูุฌุฏูู ูู ุงูููุฏ

### ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
1. ุฅุถุงูุฉ ุนููุฏ `owner_name`
2. ูุณุฎ ุงูุจูุงูุงุช ูู `owner` ุฅูู `owner_name`
3. ุฅูุดุงุก trigger ููุญูุงุธ ุนูู ุงูุชุฒุงูู
4. ุฅุถุงูุฉ ููุฑุณ ููุจุญุซ ุงูุณุฑูุน

## ๐ก๏ธ ุงูุญูุงูุฉ ุงููุณุชูุจููุฉ

### Trigger ุงูุชุฒุงูู
- ูุถูู ุฃู ุฃู ุชุญุฏูุซ ุนูู `owner` ููุนูุณ ุนูู `owner_name`
- ูุถูู ุฃู ุฃู ุชุญุฏูุซ ุนูู `owner_name` ููุนูุณ ุนูู `owner`
- ูููุน ุนุฏู ุงูุชุทุงุจู ุจูู ุงูุนููุฏูู

### ุงูุฏูุงู ุงููุณุงุนุฏุฉ
- `getOwnerValue()`: ููุญุตูู ุนูู ูููุฉ ุงููุงูู ูู ุฃู ุนููุฏ
- `setOwnerValue()`: ูุชุญุฏูุซ ููุง ุงูุนููุฏูู ูุนุงู

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุชูุงูู ุงูุนูุณู**: ุงูููุฏ ูุฏุนู ุงูุขู ููุง ุงูุนููุฏูู
2. **ุนุฏู ููุฏุงู ุงูุจูุงูุงุช**: ุฌููุน ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ูุญููุธุฉ
3. **ุงูุฃุฏุงุก**: ุฅุถุงูุฉ ููุฑุณ ููุจุญุซ ุงูุณุฑูุน
4. **ุงููุฑููุฉ**: ูููู ุฅุฒุงูุฉ ุฃุญุฏ ุงูุนููุฏูู ูู ุงููุณุชูุจู ุฅุฐุง ูุฒู ุงูุฃูุฑ

## ๐ ุงูุชุญูู ูู ุงูุฅุตูุงุญ

ููุชุฃูุฏ ูู ูุฌุงุญ ุงูุฅุตูุงุญ:

```sql
-- ูุญุต ูุฌูุฏ ุงูุนููุฏูู
SELECT column_name FROM information_schema.columns 
WHERE table_name = 'properties' 
AND column_name IN ('owner', 'owner_name');

-- ูุญุต ุชุทุงุจู ุงูุจูุงูุงุช
SELECT COUNT(*) as mismatched_records
FROM properties 
WHERE owner != owner_name;
```

## ๐ ุงููููุงุช ุงููุญุฏุซุฉ

- `script.js` - ุฅุถุงูุฉ ุฏูุงู ูุณุงุนุฏุฉ ูุฏุนู ุงูุนููุฏูู
- `fix-owner-name-column.sql` - ุณูุฑูุจุช ุงูุฅุตูุงุญ ุงููุงูู
- `OWNER_NAME_COLUMN_FIX.md` - ูุฐุง ุงูููู (ุงูุชูุซูู)

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ**: 2025-06-16  
**ุงูุญุงูุฉ**: โ ููุชูู ููุฎุชุจุฑ  
**ุงููุทูุฑ**: Augment Agent

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± ØªØ¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØªØ¨Ø¹</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            margin: 0;
            padding: 20px;
            direction: rtl;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .content {
            padding: 20px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .test-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }
        
        .results {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .log {
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± ØªØ¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØªØ¨Ø¹</h1>
            <p>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¯Ù…Ø¬ ÙˆØªØ¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØªØ¨Ø¹</p>
        </div>
        
        <div class="content">
            <div class="test-section">
                <h3>ğŸ“Š Ø§Ø®ØªØ¨Ø§Ø± Ø¯Ù…Ø¬ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</h3>
                <p>Ø§Ø®ØªØ¨Ø§Ø± Ø¯Ù…Ø¬ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªÙŠ Ù„Ù‡Ø§ Ù†ÙØ³ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯ ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®</p>
                <button class="btn" onclick="testConsolidation()">ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯Ù…Ø¬</button>
                <div class="results" id="consolidationResults" style="display: none;"></div>
            </div>
            
            <div class="test-section">
                <h3>ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</h3>
                <p>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙˆØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§Øª</p>
                <button class="btn" onclick="testChangesExtraction()">ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                <div class="results" id="changesResults" style="display: none;"></div>
            </div>
            
            <div class="test-section">
                <h3>ğŸ“‹ Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„</h3>
                <p>Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ HTML Ù…Ø¹ Ø§Ù„ØªØ¬Ù…ÙŠØ¹ ÙˆØ§Ù„ØªÙ†Ø³ÙŠÙ‚</p>
                <button class="btn" onclick="testTableCreation()">ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
                <div class="results" id="tableResults" style="display: none;"></div>
            </div>
            
            <div class="log" id="testLog"></div>
        </div>
    </div>

    <script>
        let logMessages = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleString('ar-SA');
            const logEntry = `[${timestamp}] ${message}`;
            logMessages.push(logEntry);
            
            const logContainer = document.getElementById('testLog');
            if (logContainer) {
                logContainer.textContent = logMessages.join('\n');
                logContainer.scrollTop = logContainer.scrollHeight;
            }
            
            console.log(logEntry);
        }

        // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
        const sampleLogs = [
            {
                id: '1',
                contractNumber: '20987227961',
                operationType: 'ØªØ­Ø±ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª',
                timestamp: '2025-01-15T10:30:00Z',
                unitNumber: 'STR0020106',
                propertyName: 'Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø§Ù„Ø³Ø¹ÙŠØ¯',
                tenantName: 'Ø´Ø±ÙƒØ© Ø§Ù„Ø³Ù†ÙŠØ¯ÙŠ Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª',
                user: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
                city: 'Ø§Ù„Ø±ÙŠØ§Ø¶',
                changes: {
                    tenant_name: { old: '', new: 'Ø´Ø±ÙƒØ© Ø§Ù„Ø³Ù†ÙŠØ¯ÙŠ Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª' },
                    start_date: { old: '2024-01-01', new: '2025-01-01' }
                }
            },
            {
                id: '2',
                contractNumber: '20987227961',
                operationType: 'ØªØ­Ø±ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª',
                timestamp: '2025-01-15T10:32:00Z',
                unitNumber: 'STR0020107',
                propertyName: 'Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø§Ù„Ø³Ø¹ÙŠØ¯',
                tenantName: 'Ø´Ø±ÙƒØ© Ø§Ù„Ø³Ù†ÙŠØ¯ÙŠ Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª',
                user: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
                city: 'Ø§Ù„Ø±ÙŠØ§Ø¶',
                changes: {
                    tenant_name: { old: '', new: 'Ø´Ø±ÙƒØ© Ø§Ù„Ø³Ù†ÙŠØ¯ÙŠ Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª' },
                    end_date: { old: '2024-12-31', new: '2025-12-31' }
                }
            },
            {
                id: '3',
                contractNumber: '20987227961',
                operationType: 'ØªØ­Ø±ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª',
                timestamp: '2025-01-15T10:35:00Z',
                unitNumber: 'STR0020108',
                propertyName: 'Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø§Ù„Ø³Ø¹ÙŠØ¯',
                tenantName: 'Ø´Ø±ÙƒØ© Ø§Ù„Ø³Ù†ÙŠØ¯ÙŠ Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª',
                user: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
                city: 'Ø§Ù„Ø±ÙŠØ§Ø¶',
                changes: {
                    tenant_name: { old: '', new: 'Ø´Ø±ÙƒØ© Ø§Ù„Ø³Ù†ÙŠØ¯ÙŠ Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª' },
                    rent_value: { old: '50000', new: '55000' }
                }
            },
            {
                id: '4',
                contractNumber: '20268866526',
                operationType: 'Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯',
                timestamp: '2025-02-01T09:15:00Z',
                unitNumber: 'STR0040001',
                propertyName: 'Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø©',
                tenantName: 'ÙÙˆØ§ÙƒÙ‡Ø© ÙØ±ØºÙ„ÙŠ Ù„Ù„Ø¹ØµÙŠØ±Ø§Øª',
                user: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯',
                city: 'Ø§Ù„Ø±ÙŠØ§Ø¶',
                changes: {
                    tenant_name: { old: '', new: 'ÙÙˆØ§ÙƒÙ‡Ø© ÙØ±ØºÙ„ÙŠ Ù„Ù„Ø¹ØµÙŠØ±Ø§Øª' },
                    contract_status: { old: 'ÙØ§Ø±Øº', new: 'Ù…Ø¤Ø¬Ø±' }
                }
            }
        ];

        // Ù†Ø³Ø® Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…Ù† script.js Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function formatDate(timestamp) {
            if (!timestamp) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            try {
                const date = new Date(timestamp);
                if (isNaN(date.getTime())) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const day = date.getDate().toString().padStart(2, '0');
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const year = date.getFullYear();
                return `${day}/${month}/${year}`;
            } catch (error) {
                return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            }
        }

        function formatTime(timestamp) {
            if (!timestamp) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            try {
                const date = new Date(timestamp);
                if (isNaN(date.getTime())) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const hours = date.getHours().toString().padStart(2, '0');
                const minutes = date.getMinutes().toString().padStart(2, '0');
                return `${hours}:${minutes}`;
            } catch (error) {
                return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
            }
        }

        function getArabicFieldName(fieldName) {
            const fieldTranslations = {
                'tenant_name': 'Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±',
                'start_date': 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©',
                'end_date': 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©',
                'rent_value': 'Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±',
                'contract_status': 'Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù‚Ø¯'
            };
            return fieldTranslations[fieldName] || fieldName;
        }

        function extractChangesFromLog(log) {
            const changes = [];

            if (log.changes) {
                try {
                    let parsedChanges = log.changes;
                    if (typeof log.changes === 'string') {
                        parsedChanges = JSON.parse(log.changes);
                    }

                    if (typeof parsedChanges === 'object') {
                        Object.entries(parsedChanges).forEach(([field, change]) => {
                            if (typeof change === 'object' && change.old !== change.new) {
                                const fieldName = getArabicFieldName(field);
                                changes.push(`ØªÙ… ØªØºÙŠÙŠØ± ${fieldName} Ù…Ù† ${change.old || '(ÙØ§Ø±Øº)'} Ø¥Ù„Ù‰ ${change.new}`);
                            }
                        });
                    }
                } catch (e) {
                    changes.push(log.changes);
                }
            }

            const operationType = log.operationType || '';
            const unitNumber = log.unitNumber || '';

            if (operationType.includes('ØªØ­Ø±ÙŠØ±') || operationType.includes('ØªØ¹Ø¯ÙŠÙ„')) {
                changes.push(`ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø© ${unitNumber}`);
            } else if (operationType.includes('Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯')) {
                const tenantName = log.tenantName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                changes.push(`ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø± Ù…Ù† (ÙØ§Ø±Øº) Ø¥Ù„Ù‰ ${tenantName}`);
            }

            return changes.filter(change => change && change.trim());
        }

        function extractEventsFromLog(log) {
            const events = [];

            if (log.changes) {
                try {
                    let parsedChanges = log.changes;
                    if (typeof log.changes === 'string') {
                        parsedChanges = JSON.parse(log.changes);
                    }

                    if (typeof parsedChanges === 'object') {
                        Object.entries(parsedChanges).forEach(([field, change]) => {
                            if (typeof change === 'object' && change.old !== change.new) {
                                const fieldName = getArabicFieldName(field);
                                const oldValue = change.old || '(ÙØ§Ø±Øº)';
                                const newValue = change.new || '(ÙØ§Ø±Øº)';

                                if (field === 'tenant_name') {
                                    if (!change.old) {
                                        events.push(`Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ£Ø¬Ø± Ø¬Ø¯ÙŠØ¯: ${newValue}`);
                                    } else {
                                        events.push(`ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±: ${oldValue} â† ${newValue}`);
                                    }
                                } else if (field === 'rent_value') {
                                    events.push(`ØªØ¹Ø¯ÙŠÙ„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±: ${oldValue} Ø±ÙŠØ§Ù„ â† ${newValue} Ø±ÙŠØ§Ù„`);
                                } else {
                                    events.push(`ØªØ­Ø¯ÙŠØ« ${fieldName}: ${oldValue} â† ${newValue}`);
                                }
                            }
                        });
                    }
                } catch (e) {
                    events.push(`ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${log.changes}`);
                }
            }

            const operationType = log.operationType || '';
            const unitNumber = log.unitNumber || '';

            if (operationType.includes('Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯')) {
                events.push(`Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ£Ø¬Ø± Ø¬Ø¯ÙŠØ¯ Ù„Ù„ÙˆØ­Ø¯Ø© ${unitNumber}`);
            } else if (operationType.includes('ØªØ­Ø±ÙŠØ±')) {
                if (events.length === 0) {
                    events.push(`ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø© ${unitNumber}`);
                }
            }

            return events.filter(event => event && event.trim());
        }

        function consolidateTrackingLogs(logs) {
            if (!logs || logs.length === 0) return [];

            const groupedLogs = new Map();

            logs.forEach(log => {
                const contractNumber = log.contractNumber || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const operationType = log.operationType || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const date = formatDate(log.timestamp);
                
                const groupKey = `${contractNumber}|${operationType}|${date}`;

                if (!groupedLogs.has(groupKey)) {
                    groupedLogs.set(groupKey, {
                        date: date,
                        time: formatTime(log.timestamp),
                        operationType: operationType,
                        tenantName: log.tenantName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                        contractNumber: contractNumber,
                        user: log.user || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                        propertyName: log.propertyName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                        city: log.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                        unitNumbers: new Set(),
                        changes: new Set(),
                        events: new Set(),
                        originalLogs: []
                    });
                }

                const group = groupedLogs.get(groupKey);
                
                const unitNumber = log.unitNumber || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                if (unitNumber && unitNumber !== 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') {
                    group.unitNumbers.add(unitNumber);
                }

                const logChanges = extractChangesFromLog(log);
                logChanges.forEach(change => group.changes.add(change));

                const logEvents = extractEventsFromLog(log);
                logEvents.forEach(event => group.events.add(event));

                group.originalLogs.push(log);
            });

            return Array.from(groupedLogs.values()).map(group => ({
                date: group.date,
                time: group.time,
                operationType: group.operationType,
                tenantName: group.tenantName,
                contractNumber: group.contractNumber,
                user: group.user,
                propertyName: group.propertyName,
                unitNumbers: Array.from(group.unitNumbers).join('-'),
                city: group.city,
                changes: Array.from(group.changes).map(change => `âœ” ${change}`).join('\n'),
                events: Array.from(group.events).map(event => `â€¢ ${event}`).join('\n'),
                recordCount: group.originalLogs.length
            }));
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø¯Ù…Ø¬ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
        function testConsolidation() {
            log('ğŸ”„ Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¯Ù…Ø¬ Ø§Ù„Ø³Ø¬Ù„Ø§Øª...');
            
            const consolidated = consolidateTrackingLogs(sampleLogs);
            
            const resultsDiv = document.getElementById('consolidationResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = `
                <h4>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¯Ù…Ø¬:</h4>
                <p><strong>Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©:</strong> ${sampleLogs.length}</p>
                <p><strong>Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø¯Ù…ÙˆØ¬Ø©:</strong> ${consolidated.length}</p>
                <p><strong>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶ØºØ·:</strong> ${((1 - consolidated.length / sampleLogs.length) * 100).toFixed(1)}%</p>
                <pre>${JSON.stringify(consolidated, null, 2)}</pre>
            `;
            
            log(`âœ… ØªÙ… Ø¯Ù…Ø¬ ${sampleLogs.length} Ø³Ø¬Ù„ Ø¥Ù„Ù‰ ${consolidated.length} Ø³Ø¬Ù„ Ù…ÙˆØ­Ø¯`);
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        function testChangesExtraction() {
            log('ğŸ”§ Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª...');
            
            const resultsDiv = document.getElementById('changesResults');
            resultsDiv.style.display = 'block';
            
            let html = '<h4>Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©:</h4>';
            
            sampleLogs.forEach((log, index) => {
                const changes = extractChangesFromLog(log);
                html += `
                    <div style="margin-bottom: 15px; padding: 10px; border: 1px solid #dee2e6; border-radius: 6px;">
                        <strong>Ø§Ù„Ø³Ø¬Ù„ ${index + 1} (${log.unitNumber}):</strong>
                        <ul>
                            ${changes.map(change => `<li>âœ” ${change}</li>`).join('')}
                        </ul>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
            log('âœ… ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª');
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        function testTableCreation() {
            log('ğŸ“‹ Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„...');
            
            const consolidated = consolidateTrackingLogs(sampleLogs);
            
            const tableHtml = `
                <h4>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¯Ù…ÙˆØ¬:</h4>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                        <thead>
                            <tr style="background: #2c3e50; color: white;">
                                <th style="padding: 8px; border: 1px solid #ddd;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙˆØ­Ø¯Ø§Øª</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">Ø§Ù„Ø­Ø¯Ø«</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">Ø§Ù„ØªØºÙŠØ±Ø§Øª</th>
                                <th style="padding: 8px; border: 1px solid #ddd;">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${consolidated.map(log => `
                                <tr>
                                    <td style="padding: 8px; border: 1px solid #ddd;">${log.date}</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">${log.operationType}</td>
                                    <td style="padding: 8px; border: 1px solid #ddd;">${log.contractNumber}</td>
                                    <td style="padding: 8px; border: 1px solid #ddd; background: #e8f4fd;">${log.unitNumbers}</td>
                                    <td style="padding: 8px; border: 1px solid #ddd; background: #fff3e0; white-space: pre-line; max-width: 280px; color: #e65100;">${log.events}</td>
                                    <td style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; white-space: pre-line; max-width: 300px;">${log.changes}</td>
                                    <td style="padding: 8px; border: 1px solid #ddd; text-align: center; background: #fff3cd;">${log.recordCount}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            const resultsDiv = document.getElementById('tableResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = tableHtml;
            
            log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¯Ù…ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­');
        }

        // Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
        log('ğŸš€ Ø£Ø¯Ø§Ø© Ø§Ø®ØªØ¨Ø§Ø± ØªØ¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØªØ¨Ø¹ Ø¬Ø§Ù‡Ø²Ø©');
    </script>
</body>
</html>

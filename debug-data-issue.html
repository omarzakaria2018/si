<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ´Ø®ÙŠØµ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #dc3545;
            margin-bottom: 30px;
            font-size: 2.2em;
        }

        .diagnostic-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #dc3545;
        }

        .diagnostic-section h3 {
            color: #dc3545;
            margin-top: 0;
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .log-container {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            margin: 15px 0;
        }

        .log-entry {
            margin: 5px 0;
            padding: 3px 0;
        }

        .log-success { color: #68d391; }
        .log-error { color: #fc8181; }
        .log-warning { color: #f6e05e; }
        .log-info { color: #63b3ed; }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-size: 14px;
        }

        .data-table th,
        .data-table td {
            border: 1px solid #dee2e6;
            padding: 8px 12px;
            text-align: right;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .status-good { color: #28a745; font-weight: bold; }
        .status-bad { color: #dc3545; font-weight: bold; }
        .status-warning { color: #ffc107; font-weight: bold; }

        .code-block {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ØªØ´Ø®ÙŠØµ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©</h1>

        <div class="diagnostic-section">
            <h3>ğŸ“‹ ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</h3>
            <p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù…ÙØ¨Ù„Øº Ø¹Ù†Ù‡Ø§:</strong> Ø§Ø®ØªÙØª Ø¨Ø¹Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ù…Ø«Ù„ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· ÙˆØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙˆØ±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ù…Ù† Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª.</p>
            <p><strong>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ù„ÙƒÙ† Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ù…ÙÙ‚ÙˆØ¯Ø©.</p>
            <p><strong>Ø§Ù„Ù…ØµØ¯Ø±:</strong> Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Supabase Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….</p>
        </div>

        <div class="diagnostic-section">
            <h3>ğŸ”§ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ´Ø®ÙŠØµ</h3>
            <div class="button-group">
                <button class="btn btn-primary" onclick="checkLocalData()">ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©</button>
                <button class="btn btn-success" onclick="checkSupabaseData()">ÙØ­Øµ Ø¨ÙŠØ§Ù†Ø§Øª Supabase</button>
                <button class="btn btn-warning" onclick="compareData()">Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                <button class="btn btn-danger" onclick="fixDataIssue()">Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</button>
            </div>
        </div>

        <div class="diagnostic-section">
            <h3>ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ´Ø®ÙŠØµ</h3>
            <div class="log-container" id="diagnosticLog">
                <div class="log-entry log-info">ğŸ” Ø¬Ø§Ù‡Ø² Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´Ø®ÙŠØµ...</div>
            </div>
        </div>

        <div class="diagnostic-section">
            <h3>ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
            <table class="data-table" id="dataStats">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù…ØµØ¯Ø±</th>
                        <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</th>
                        <th>Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª</th>
                        <th>ÙˆØ­Ø¯Ø§Øª Ø¨Ø£Ù‚Ø³Ø§Ø·</th>
                        <th>ÙˆØ­Ø¯Ø§Øª Ø¨Ø£Ø±Ù‚Ø§Ù… Ø¬ÙˆØ§Ù„</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©</td>
                        <td id="localPropertiesCount">-</td>
                        <td id="localUnitsCount">-</td>
                        <td id="localUnitsWithInstallments">-</td>
                        <td id="localUnitsWithPhones">-</td>
                        <td id="localStatus">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</td>
                    </tr>
                    <tr>
                        <td>Supabase</td>
                        <td id="supabasePropertiesCount">-</td>
                        <td id="supabaseUnitsCount">-</td>
                        <td id="supabaseUnitsWithInstallments">-</td>
                        <td id="supabaseUnitsWithPhones">-</td>
                        <td id="supabaseStatus">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="diagnostic-section">
            <h3>ğŸ” Ø¹ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©</h3>
            <div id="missingDataSample"></div>
        </div>

        <div class="diagnostic-section">
            <h3>ğŸ’¡ Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</h3>
            <div id="suggestedSolutions">
                <p>Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø­Ù„ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ´Ø®ÙŠØµ...</p>
            </div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logContainer = document.getElementById('diagnosticLog');
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateStats(source, propertiesCount, unitsCount, unitsWithInstallments, unitsWithPhones, status) {
            document.getElementById(`${source}PropertiesCount`).textContent = propertiesCount;
            document.getElementById(`${source}UnitsCount`).textContent = unitsCount;
            document.getElementById(`${source}UnitsWithInstallments`).textContent = unitsWithInstallments;
            document.getElementById(`${source}UnitsWithPhones`).textContent = unitsWithPhones;
            
            const statusEl = document.getElementById(`${source}Status`);
            statusEl.textContent = status;
            statusEl.className = status === 'Ø³Ù„ÙŠÙ…' ? 'status-good' : 
                               status === 'Ù…Ø´ÙƒÙ„Ø©' ? 'status-bad' : 'status-warning';
        }

        function checkLocalData() {
            log('ğŸ” ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©...', 'info');

            try {
                // ÙØ­Øµ Ù…ØªØºÙŠØ± properties
                if (typeof properties === 'undefined') {
                    log('âŒ Ù…ØªØºÙŠØ± properties ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!', 'error');
                    updateStats('local', 0, 0, 0, 0, 'Ù…Ø´ÙƒÙ„Ø©');
                    return;
                }

                if (!Array.isArray(properties)) {
                    log('âŒ Ù…ØªØºÙŠØ± properties Ù„ÙŠØ³ Ù…ØµÙÙˆÙØ©!', 'error');
                    updateStats('local', 0, 0, 0, 0, 'Ù…Ø´ÙƒÙ„Ø©');
                    return;
                }

                const totalUnits = properties.length;
                log(`ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ­Ø¯Ø§Øª: ${totalUnits}`, 'info');

                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„ÙØ±ÙŠØ¯Ø©
                const uniqueProperties = [...new Set(properties.map(p => p['Ø§Ø³Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±']).filter(Boolean))];
                log(`ğŸ  Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„ÙØ±ÙŠØ¯Ø©: ${uniqueProperties.length}`, 'info');

                // ÙØ­Øµ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ù‚Ø³Ø§Ø·
                const unitsWithInstallments = properties.filter(p => 
                    p['Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ù‚Ø³Ø§Ø·'] && Number(p['Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ù‚Ø³Ø§Ø·']) > 0
                ).length;
                log(`ğŸ’° ÙˆØ­Ø¯Ø§Øª Ø¨Ø£Ù‚Ø³Ø§Ø·: ${unitsWithInstallments}`, 'info');

                // ÙØ­Øµ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… Ø¬ÙˆØ§Ù„
                const unitsWithPhones = properties.filter(p => 
                    p['Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±'] && p['Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±'].toString().trim() !== ''
                ).length;
                log(`ğŸ“± ÙˆØ­Ø¯Ø§Øª Ø¨Ø£Ø±Ù‚Ø§Ù… Ø¬ÙˆØ§Ù„: ${unitsWithPhones}`, 'info');

                // ÙØ­Øµ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                const unitsWithTotal = properties.filter(p => 
                    p['Ø§Ù„Ø§Ø¬Ù…Ø§Ù„Ù‰'] && Number(p['Ø§Ù„Ø§Ø¬Ù…Ø§Ù„Ù‰']) > 0
                ).length;
                log(`ğŸ’µ ÙˆØ­Ø¯Ø§Øª Ø¨Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${unitsWithTotal}`, 'info');

                // ÙØ­Øµ localStorage
                const localStorageData = localStorage.getItem('properties');
                if (localStorageData) {
                    try {
                        const parsedData = JSON.parse(localStorageData);
                        log(`ğŸ’¾ localStorage ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ${parsedData.length} ÙˆØ­Ø¯Ø©`, 'info');
                    } catch (e) {
                        log('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª localStorage', 'error');
                    }
                } else {
                    log('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage', 'warning');
                }

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                const status = (unitsWithInstallments > 0 && unitsWithPhones > 0) ? 'Ø³Ù„ÙŠÙ…' : 'Ù…Ø´ÙƒÙ„Ø©';
                updateStats('local', uniqueProperties.length, totalUnits, unitsWithInstallments, unitsWithPhones, status);

                // Ø¹Ø±Ø¶ Ø¹ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                if (totalUnits > 0) {
                    const sampleUnit = properties[0];
                    log('ğŸ“‹ Ø¹ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', 'info');
                    log(`   - Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©: ${sampleUnit['Ø±Ù‚Ù…  Ø§Ù„ÙˆØ­Ø¯Ø© '] || 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}`, 'info');
                    log(`   - Ø§Ø³Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±: ${sampleUnit['Ø§Ø³Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±'] || 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}`, 'info');
                    log(`   - Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±: ${sampleUnit['Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±'] || 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}`, 'info');
                    log(`   - Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„: ${sampleUnit['Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±'] || 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}`, 'info');
                    log(`   - Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·: ${sampleUnit['Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ù‚Ø³Ø§Ø·'] || 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}`, 'info');
                    log(`   - Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${sampleUnit['Ø§Ù„Ø§Ø¬Ù…Ø§Ù„Ù‰'] || 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'}`, 'info');
                }

                log('âœ… ØªÙ… ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©', 'success');

            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©: ${error.message}`, 'error');
                updateStats('local', 0, 0, 0, 0, 'Ù…Ø´ÙƒÙ„Ø©');
            }
        }

        function checkSupabaseData() {
            log('ğŸ” ÙØ­Øµ Ø¨ÙŠØ§Ù†Ø§Øª Supabase...', 'info');

            // Ù‡Ø°Ø§ ÙŠØªØ·Ù„Ø¨ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù€ Supabase
            if (typeof supabaseClient === 'undefined') {
                log('âŒ Ø¹Ù…ÙŠÙ„ Supabase ØºÙŠØ± Ù…ØªØ§Ø­', 'error');
                updateStats('supabase', 0, 0, 0, 0, 'ØºÙŠØ± Ù…ØªØ§Ø­');
                return;
            }

            log('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase...', 'info');
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase
            supabaseClient
                .from('properties_data')
                .select('*')
                .then(({ data, error }) => {
                    if (error) {
                        log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase: ${error.message}`, 'error');
                        updateStats('supabase', 0, 0, 0, 0, 'Ù…Ø´ÙƒÙ„Ø©');
                        return;
                    }

                    if (!data || data.length === 0) {
                        log('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Supabase', 'warning');
                        updateStats('supabase', 0, 0, 0, 0, 'ÙØ§Ø±Øº');
                        return;
                    }

                    log(`ğŸ“Š ØªÙ… Ø¬Ù„Ø¨ ${data.length} Ø³Ø¬Ù„ Ù…Ù† Supabase`, 'success');

                    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    let totalUnits = 0;
                    let unitsWithInstallments = 0;
                    let unitsWithPhones = 0;
                    const uniqueProperties = new Set();

                    data.forEach(record => {
                        if (record.data && typeof record.data === 'object') {
                            totalUnits++;
                            
                            if (record.data['Ø§Ø³Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±']) {
                                uniqueProperties.add(record.data['Ø§Ø³Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±']);
                            }

                            if (record.data['Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ù‚Ø³Ø§Ø·'] && Number(record.data['Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ù‚Ø³Ø§Ø·']) > 0) {
                                unitsWithInstallments++;
                            }

                            if (record.data['Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±'] && record.data['Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ù…Ø³ØªØ£Ø¬Ø±'].toString().trim() !== '') {
                                unitsWithPhones++;
                            }
                        }
                    });

                    log(`ğŸ  Ø¹Ù‚Ø§Ø±Ø§Øª ÙØ±ÙŠØ¯Ø© ÙÙŠ Supabase: ${uniqueProperties.size}`, 'info');
                    log(`ğŸ’° ÙˆØ­Ø¯Ø§Øª Ø¨Ø£Ù‚Ø³Ø§Ø· ÙÙŠ Supabase: ${unitsWithInstallments}`, 'info');
                    log(`ğŸ“± ÙˆØ­Ø¯Ø§Øª Ø¨Ø£Ø±Ù‚Ø§Ù… Ø¬ÙˆØ§Ù„ ÙÙŠ Supabase: ${unitsWithPhones}`, 'info');

                    const status = (unitsWithInstallments > 0 && unitsWithPhones > 0) ? 'Ø³Ù„ÙŠÙ…' : 'Ù…Ø´ÙƒÙ„Ø©';
                    updateStats('supabase', uniqueProperties.size, totalUnits, unitsWithInstallments, unitsWithPhones, status);

                    log('âœ… ØªÙ… ÙØ­Øµ Ø¨ÙŠØ§Ù†Ø§Øª Supabase', 'success');
                })
                .catch(error => {
                    log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase: ${error.message}`, 'error');
                    updateStats('supabase', 0, 0, 0, 0, 'Ù…Ø´ÙƒÙ„Ø©');
                });
        }

        function compareData() {
            log('ğŸ” Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ù…ØµØ§Ø¯Ø±...', 'info');
            
            checkLocalData();
            setTimeout(() => {
                checkSupabaseData();
            }, 1000);

            setTimeout(() => {
                log('ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø®ØªÙ„Ø§ÙØ§Øª...', 'info');
                
                const localUnits = document.getElementById('localUnitsCount').textContent;
                const supabaseUnits = document.getElementById('supabaseUnitsCount').textContent;
                
                if (localUnits !== '-' && supabaseUnits !== '-') {
                    if (localUnits === supabaseUnits) {
                        log('âœ… Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ù…ØªØ·Ø§Ø¨Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ù…ØµØ§Ø¯Ø±', 'success');
                    } else {
                        log(`âš ï¸ Ø§Ø®ØªÙ„Ø§Ù ÙÙŠ Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ­Ø¯Ø§Øª: Ù…Ø­Ù„ÙŠ=${localUnits}, Supabase=${supabaseUnits}`, 'warning');
                    }
                }

                // Ø§Ù‚ØªØ±Ø§Ø­ Ø§Ù„Ø­Ù„ÙˆÙ„
                suggestSolutions();
            }, 3000);
        }

        function suggestSolutions() {
            const solutionsDiv = document.getElementById('suggestedSolutions');
            
            const localStatus = document.getElementById('localStatus').textContent;
            const supabaseStatus = document.getElementById('supabaseStatus').textContent;

            let solutions = '<h4>ğŸ’¡ Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©:</h4>';

            if (localStatus === 'Ù…Ø´ÙƒÙ„Ø©' && supabaseStatus === 'Ø³Ù„ÙŠÙ…') {
                solutions += `
                    <div class="code-block">
                    ğŸ”„ Ø§Ù„Ø­Ù„ Ø§Ù„Ø£ÙˆÙ„: Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase
                    - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ù„ÙŠÙ…Ø© ÙÙŠ Supabase Ù„ÙƒÙ† Ù…Ø´ÙƒÙ„Ø© Ù…Ø­Ù„ÙŠØ§Ù‹
                    - ØªØ´ØºÙŠÙ„: loadDataFromSupabase() ÙÙŠ Console
                    </div>
                `;
            } else if (localStatus === 'Ø³Ù„ÙŠÙ…' && supabaseStatus === 'Ù…Ø´ÙƒÙ„Ø©') {
                solutions += `
                    <div class="code-block">
                    ğŸ“¤ Ø§Ù„Ø­Ù„ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¥Ù„Ù‰ Supabase
                    - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ù„ÙŠÙ…Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ Ù„ÙƒÙ† Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Supabase
                    - ØªØ´ØºÙŠÙ„: syncToSupabase() ÙÙŠ Console
                    </div>
                `;
            } else if (localStatus === 'Ù…Ø´ÙƒÙ„Ø©' && supabaseStatus === 'Ù…Ø´ÙƒÙ„Ø©') {
                solutions += `
                    <div class="code-block">
                    ğŸš¨ Ø§Ù„Ø­Ù„ Ø§Ù„Ø·Ø§Ø±Ø¦: Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                    - Ù…Ø´ÙƒÙ„Ø© ÙÙŠ ÙƒÙ„Ø§ Ø§Ù„Ù…ØµØ¯Ø±ÙŠÙ†
                    - ÙØ­Øµ localStorage Ù„Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                    - Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† Ø¢Ø®Ø± Ù†Ø³Ø®Ø© Ø³Ù„ÙŠÙ…Ø©
                    </div>
                `;
            }

            solutions += `
                <div class="code-block">
                ğŸ”§ Ø­Ù„ÙˆÙ„ Ø¥Ø¶Ø§ÙÙŠØ©:
                1. Ù…Ø³Ø­ cache Ø§Ù„Ù…ØªØµÙØ­ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                2. ÙØ­Øµ Console Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
                3. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
                4. Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                </div>
            `;

            solutionsDiv.innerHTML = solutions;
        }

        function fixDataIssue() {
            log('ğŸ”§ Ø¨Ø¯Ø¡ Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'warning');
            
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŸ\nØ³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase.')) {
                log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase...', 'info');
                
                if (typeof loadDataFromSupabase === 'function') {
                    loadDataFromSupabase()
                        .then(() => {
                            log('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                            setTimeout(() => {
                                checkLocalData();
                            }, 2000);
                        })
                        .catch(error => {
                            log(`âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„: ${error.message}`, 'error');
                        });
                } else {
                    log('âŒ Ø¯Ø§Ù„Ø© loadDataFromSupabase ØºÙŠØ± Ù…ØªØ§Ø­Ø©', 'error');
                    
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¯ÙŠÙ„Ø©
                    if (typeof restoreDataFromLocalStorage === 'function') {
                        log('ğŸ”„ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† localStorage...', 'info');
                        restoreDataFromLocalStorage();
                        setTimeout(() => {
                            checkLocalData();
                        }, 1000);
                    }
                }
            }
        }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ” Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ...', 'info');
            setTimeout(() => {
                checkLocalData();
            }, 1000);
        });
    </script>
</body>
</html>

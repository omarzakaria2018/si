<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>๐งช ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ูุญุฏุฉ ููุนูุงุฑ</title>
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            margin: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #28a745, #20c997);
            border-radius: 10px;
            color: white;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            background: #f8f9fa;
        }
        .result {
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
        .result.success { border-left-color: #28a745; background: #d4edda; }
        .result.error { border-left-color: #dc3545; background: #f8d7da; }
        .result.warning { border-left-color: #ffc107; background: #fff3cd; }
        .result.info { border-left-color: #17a2b8; background: #d1ecf1; }
        
        button {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }
        .btn-danger { background: linear-gradient(135deg, #dc3545, #c82333); }
        .btn-warning { background: linear-gradient(135deg, #ffc107, #e0a800); }
        .btn-success { background: linear-gradient(135deg, #28a745, #1e7e34); }
        
        .solution-demo {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .data-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .property-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 10px;
            margin: 5px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-home"></i> ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ูุญุฏุฉ ููุนูุงุฑ</h1>
            <p>ุงูุชุฃูุฏ ูู ุฃู ุงูุนูุงุฑุงุช ุจุฏูู ูุญุฏุงุช ุชุธูุฑ ูู ูุงุฆูุฉ ุฅุถุงูุฉ ุงููุญุฏุงุช</p>
        </div>

        <div class="solution-demo">
            <h3><i class="fas fa-lightbulb"></i> ุงูุญู ุงููุทุจู:</h3>
            <ul>
                <li>โ <strong>ุฏุงูุฉ getUniqueProperties ูุญุณูุฉ:</strong> ุชุจุญุซ ูู properties ู propertyDefinitions</li>
                <li>โ <strong>ุฏุงูุฉ addNewUnit ูุญุณูุฉ:</strong> ุชุจุญุซ ูู ุงููุตุฏุฑูู ููุนุซูุฑ ุนูู ุงูุนูุงุฑ</li>
                <li>โ <strong>ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ุดุงููุฉ:</strong> ุชุนุฑุถ ุฌููุน ุงูุนูุงุฑุงุช ุญุชู ุจุฏูู ูุญุฏุงุช</li>
                <li>โ <strong>ุฅุถุงูุฉ ูุญุฏุฉ ูุธููุฉ:</strong> ุจุฏูู ูุดุงูู ุฃู ุฃุฎุทุงุก</li>
            </ul>
        </div>

        <div class="test-section">
            <h2><i class="fas fa-plus"></i> ุงุฎุชุจุงุฑ 1: ุฅุถุงูุฉ ุนูุงุฑ ุจุฏูู ูุญุฏุงุช</h2>
            <p>ุฅุถุงูุฉ ุนูุงุฑ ุฌุฏูุฏ ูู propertyDefinitions ููุท</p>
            <button onclick="testAddProperty()" class="btn-success">
                <i class="fas fa-plus"></i> ุฅุถุงูุฉ ุนูุงุฑ ุชุฌุฑูุจู
            </button>
            <div id="addPropertyResults"></div>
        </div>

        <div class="test-section">
            <h2><i class="fas fa-list"></i> ุงุฎุชุจุงุฑ 2: ูุญุต ูุงุฆูุฉ ุงูุนูุงุฑุงุช</h2>
            <p>ุงูุชุฃูุฏ ูู ุธููุฑ ุงูุนูุงุฑ ูู ูุงุฆูุฉ ุฅุถุงูุฉ ุงููุญุฏุงุช</p>
            <button onclick="testPropertyList()" class="btn-warning">
                <i class="fas fa-list"></i> ูุญุต ุงููุงุฆูุฉ
            </button>
            <div id="propertyListResults"></div>
        </div>

        <div class="test-section">
            <h2><i class="fas fa-search"></i> ุงุฎุชุจุงุฑ 3: ูุญุงูุงุฉ ุงูุจุญุซ ุนู ุงูุนูุงุฑ</h2>
            <p>ุงุฎุชุจุงุฑ ุฏุงูุฉ addNewUnit ุงููุญุณูุฉ ููุจุญุซ ูู ุงููุตุฏุฑูู</p>
            <button onclick="testFindProperty()" class="btn-warning">
                <i class="fas fa-search"></i> ุงุฎุชุจุงุฑ ุงูุจุญุซ
            </button>
            <div id="findPropertyResults"></div>
        </div>

        <div class="test-section">
            <h2><i class="fas fa-home"></i> ุงุฎุชุจุงุฑ 4: ุฅุถุงูุฉ ูุญุฏุฉ ููุนูุงุฑ</h2>
            <p>ูุญุงูุงุฉ ุฅุถุงูุฉ ูุญุฏุฉ ููุนูุงุฑ ุงูุฐู ุจุฏูู ูุญุฏุงุช</p>
            <button onclick="testAddUnit()" class="btn-warning">
                <i class="fas fa-home"></i> ุฅุถุงูุฉ ูุญุฏุฉ
            </button>
            <div id="addUnitResults"></div>
        </div>

        <div class="test-section">
            <h2><i class="fas fa-copy"></i> ุงุฎุชุจุงุฑ 4.5: ูุญุต ุงูุชูุฑุงุฑ</h2>
            <p>ุงูุชุญูู ูู ุนุฏู ุชูุฑุงุฑ ุงูุนูุงุฑ ูู ุงููุตุฏุฑูู ุจุนุฏ ุฅุถุงูุฉ ุงููุญุฏุฉ</p>
            <button onclick="testDuplication()" class="btn-warning">
                <i class="fas fa-copy"></i> ูุญุต ุงูุชูุฑุงุฑ
            </button>
            <div id="duplicationResults"></div>
        </div>

        <div class="test-section">
            <h2><i class="fas fa-trash"></i> ุงุฎุชุจุงุฑ 5: ุชูุธูู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ</h2>
            <p>ุญุฐู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ุงููุถุงูุฉ</p>
            <button onclick="cleanupTestData()" class="btn-danger">
                <i class="fas fa-trash"></i> ุชูุธูู ุงูุจูุงูุงุช
            </button>
            <div id="cleanupResults"></div>
        </div>

        <div class="test-section">
            <h2><i class="fas fa-file-alt"></i> ุชูุฑูุฑ ุงูุงุฎุชุจุงุฑ ุงูููุงุฆู</h2>
            <button onclick="generateFinalReport()" class="btn-success">
                <i class="fas fa-file-alt"></i> ุฅูุดุงุก ุชูุฑูุฑ ุดุงูู
            </button>
            <div id="finalReport"></div>
        </div>
    </div>

    <!-- ุชุญููู ุงููููุงุช ุงููุทููุจุฉ -->
    <script src="script.js"></script>
    
    <script>
        // ูุชุบูุฑุงุช ุงูุงุฎุชุจุงุฑ
        let testResults = {
            addProperty: null,
            propertyList: null,
            findProperty: null,
            addUnit: null,
            duplication: null,
            cleanup: null
        };
        
        let testPropertyName = 'ุนูุงุฑ ุงุฎุชุจุงุฑ ุงููุญุฏุฉ ' + Date.now();
        let testCityName = 'ุงูุฑูุงุถ';
        let testUnitNumber = 'A101';

        function addResult(containerId, type, title, content) {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `
                <strong><i class="fas fa-${getIcon(type)}"></i> ${title}</strong><br>
                ${content}
            `;
            container.appendChild(resultDiv);
            container.scrollTop = container.scrollHeight;
        }

        function getIcon(type) {
            switch(type) {
                case 'success': return 'check-circle';
                case 'error': return 'times-circle';
                case 'warning': return 'exclamation-triangle';
                case 'info': return 'info-circle';
                default: return 'circle';
            }
        }

        // ุงุฎุชุจุงุฑ 1: ุฅุถุงูุฉ ุนูุงุฑ ุจุฏูู ูุญุฏุงุช
        function testAddProperty() {
            addResult('addPropertyResults', 'info', 'ุจุฏุก ุฅุถุงูุฉ ุงูุนูุงุฑ', 'ุฌุงุฑู ุฅุถุงูุฉ ุนูุงุฑ ุชุฌุฑูุจู ุจุฏูู ูุญุฏุงุช...');
            
            try {
                // ุงูุชุฃูุฏ ูู ูุฌูุฏ ุงููุตูููุงุช ุงููุทููุจุฉ
                if (typeof window.properties === 'undefined') {
                    window.properties = [];
                }
                if (typeof window.propertyDefinitions === 'undefined') {
                    window.propertyDefinitions = [];
                }
                
                const propertiesCountBefore = window.properties.length;
                const definitionsCountBefore = window.propertyDefinitions.length;
                
                addResult('addPropertyResults', 'info', 'ุญุงูุฉ ุงูุจูุงูุงุช ูุจู ุงูุฅุถุงูุฉ', 
                    `ุงููุญุฏุงุช: ${propertiesCountBefore}, ุงูุชุนุฑููุงุช: ${definitionsCountBefore}`);
                
                // ุฅุถุงูุฉ ุงูุนูุงุฑ ููุชุนุฑููุงุช ููุท (ูุญุงูุงุฉ ุฏุงูุฉ addNewProperty ุงูุฌุฏูุฏุฉ)
                const propertyDefinition = {
                    name: testPropertyName,
                    city: testCityName,
                    deed: '12345',
                    area: '500',
                    registry: '67890',
                    location: 'ูููุน ุงุฎุชุจุงุฑ',
                    owner: 'ูุงูู ุงุฎุชุจุงุฑ',
                    createdAt: new Date().toISOString()
                };
                
                // ุฅุถุงูุฉ ููุชุนุฑููุงุช ููุท (ุจุฏูู ุฅุถุงูุฉ ูุญุฏุฉ)
                window.propertyDefinitions.push(propertyDefinition);
                localStorage.setItem('propertyDefinitions', JSON.stringify(window.propertyDefinitions));
                
                const propertiesCountAfter = window.properties.length;
                const definitionsCountAfter = window.propertyDefinitions.length;
                
                addResult('addPropertyResults', 'info', 'ุญุงูุฉ ุงูุจูุงูุงุช ุจุนุฏ ุงูุฅุถุงูุฉ', 
                    `ุงููุญุฏุงุช: ${propertiesCountAfter}, ุงูุชุนุฑููุงุช: ${definitionsCountAfter}`);
                
                // ุงูุชุญูู ูู ุงููุชุงุฆุฌ
                const noUnitsAdded = propertiesCountAfter === propertiesCountBefore;
                const definitionAdded = definitionsCountAfter > definitionsCountBefore;
                
                if (noUnitsAdded && definitionAdded) {
                    addResult('addPropertyResults', 'success', 'ูุฌุญ ุงูุงุฎุชุจุงุฑ! โ', 
                        `ุชู ุฅุถุงูุฉ ุงูุนูุงุฑ "${testPropertyName}" ูู ุงูุชุนุฑููุงุช ููุท ุจุฏูู ูุญุฏุงุช`);
                    testResults.addProperty = true;
                } else {
                    addResult('addPropertyResults', 'error', 'ูุดู ุงูุงุฎุชุจุงุฑ! โ', 
                        `ูุญุฏุงุช ูุถุงูุฉ: ${!noUnitsAdded}, ุชุนุฑูู ูุถุงู: ${definitionAdded}`);
                    testResults.addProperty = false;
                }
                
            } catch (error) {
                addResult('addPropertyResults', 'error', 'ุฎุทุฃ ูู ุฅุถุงูุฉ ุงูุนูุงุฑ',
                    `ุฎุทุฃ: ${error.message}`);
                testResults.addProperty = false;
            }
        }

        // ุงุฎุชุจุงุฑ 2: ูุญุต ูุงุฆูุฉ ุงูุนูุงุฑุงุช
        function testPropertyList() {
            addResult('propertyListResults', 'info', 'ุจุฏุก ูุญุต ุงููุงุฆูุฉ', 'ุฌุงุฑู ูุญุต ูุงุฆูุฉ ุงูุนูุงุฑุงุช ุงููุชุงุญุฉ...');

            try {
                // ุงุฎุชุจุงุฑ ุฏุงูุฉ getUniqueProperties
                let uniqueProperties = [];
                if (typeof getUniqueProperties === 'function') {
                    uniqueProperties = getUniqueProperties();
                    addResult('propertyListResults', 'info', 'ูุชูุฌุฉ getUniqueProperties',
                        `ุชู ุงูุนุซูุฑ ุนูู ${uniqueProperties.length} ุนูุงุฑ`);
                } else {
                    addResult('propertyListResults', 'warning', 'ุฏุงูุฉ getUniqueProperties ุบูุฑ ููุฌูุฏุฉ',
                        'ุงูุฏุงูุฉ ุบูุฑ ูุนุฑูุฉ ูู ุงููุธุงู');
                }

                // ุงูุชุญูู ูู ูุฌูุฏ ุงูุนูุงุฑ ุงูุชุฌุฑูุจู
                const testPropertyFound = uniqueProperties.includes(testPropertyName);

                // ุนุฑุถ ูุงุฆูุฉ ุงูุนูุงุฑุงุช
                let html = '<div class="data-display"><h4>ุงูุนูุงุฑุงุช ุงููุชุงุญุฉ:</h4>';
                uniqueProperties.forEach((propertyName, index) => {
                    const isTestProperty = propertyName === testPropertyName;
                    html += `
                        <div class="property-item" style="${isTestProperty ? 'background: #d4edda; border-color: #28a745;' : ''}">
                            <span>${index + 1}. ${propertyName}</span>
                            ${isTestProperty ? '<span style="color: #28a745; font-weight: bold;">ุนูุงุฑ ุงูุงุฎุชุจุงุฑ</span>' : '<i class="fas fa-building" style="color: #007bff;"></i>'}
                        </div>
                    `;
                });
                html += '</div>';

                if (testPropertyFound) {
                    addResult('propertyListResults', 'success', 'ูุฌุญ ูุญุต ุงููุงุฆูุฉ! โ',
                        `ุงูุนูุงุฑ ุงูุชุฌุฑูุจู "${testPropertyName}" ูุธูุฑ ูู ูุงุฆูุฉ ุงูุนูุงุฑุงุช`);
                    testResults.propertyList = true;
                } else {
                    addResult('propertyListResults', 'error', 'ูุดู ูุญุต ุงููุงุฆูุฉ! โ',
                        'ุงูุนูุงุฑ ุงูุชุฌุฑูุจู ูุง ูุธูุฑ ูู ุงููุงุฆูุฉ');
                    testResults.propertyList = false;
                }

                addResult('propertyListResults', 'info', 'ูุงุฆูุฉ ุงูุนูุงุฑุงุช', html);

            } catch (error) {
                addResult('propertyListResults', 'error', 'ุฎุทุฃ ูู ูุญุต ุงููุงุฆูุฉ',
                    `ุฎุทุฃ: ${error.message}`);
                testResults.propertyList = false;
            }
        }

        // ุงุฎุชุจุงุฑ 3: ูุญุงูุงุฉ ุงูุจุญุซ ุนู ุงูุนูุงุฑ
        function testFindProperty() {
            addResult('findPropertyResults', 'info', 'ุจุฏุก ุงุฎุชุจุงุฑ ุงูุจุญุซ', 'ุฌุงุฑู ูุญุงูุงุฉ ุงูุจุญุซ ุนู ุงูุนูุงุฑ ูู addNewUnit...');

            try {
                const propertyName = testPropertyName;

                // ูุญุงูุงุฉ ุฏุงูุฉ addNewUnit ุงููุญุณูุฉ
                // 1. ุงูุจุญุซ ูู properties ุฃููุงู
                let baseProperty = window.properties ?
                    window.properties.find(p => p['ุงุณู ุงูุนูุงุฑ'] === propertyName) : null;

                addResult('findPropertyResults', 'info', 'ุงูุจุญุซ ูู properties',
                    `ุงููุชูุฌุฉ: ${baseProperty ? 'ููุฌูุฏ' : 'ุบูุฑ ููุฌูุฏ'}`);

                // 2. ุฅุฐุง ูู ููุฌุฏุ ุงูุจุญุซ ูู propertyDefinitions
                if (!baseProperty) {
                    const propertyDefinition = window.propertyDefinitions ?
                        window.propertyDefinitions.find(p => p.name === propertyName) : null;

                    addResult('findPropertyResults', 'info', 'ุงูุจุญุซ ูู propertyDefinitions',
                        `ุงููุชูุฌุฉ: ${propertyDefinition ? 'ููุฌูุฏ' : 'ุบูุฑ ููุฌูุฏ'}`);

                    if (propertyDefinition) {
                        // ุชุญููู ุชุนุฑูู ุงูุนูุงุฑ ุฅูู ุชูุณูู properties
                        baseProperty = {
                            'ุงุณู ุงูุนูุงุฑ': propertyDefinition.name,
                            'ุงููุฏููุฉ': propertyDefinition.city,
                            'ุฑูู ุงูุตู': propertyDefinition.deed,
                            'ูุณุงุญุฉุงูุตู': propertyDefinition.area,
                            'ุงูุณุฌู ุงูุนููู ': propertyDefinition.registry,
                            'ูููุน ุงูุนูุงุฑ': propertyDefinition.location,
                            'ุงููุงูู': propertyDefinition.owner,
                            // ููู ุงูุชุฑุงุถูุฉ ููุญููู ุงููุทููุจุฉ
                            'ุงูุงุฑุชูุงุน': null,
                            'ุงุณู ุงููุณุชุฃุฌุฑ': null,
                            'ุฑูู ุงูุนูุฏ': null,
                            'ูููุฉ  ุงูุงูุฌุงุฑ ': null,
                            'ุชุงุฑูุฎ ุงูุจุฏุงูุฉ': null,
                            'ุชุงุฑูุฎ ุงูููุงูุฉ': null,
                            'ุงูุงุฌูุงูู': 0.0,
                            'ุฑูู ุญุณุงุจ ุงูููุฑุจุงุก': null,
                            'ุนุฏุฏ ุงูุงูุณุงุท ุงููุชุจููุฉ': null,
                            'ุชุงุฑูุฎ ุงููุณุท ุงูุงูู': null,
                            'ูุจูุบ ุงููุณุท ุงูุงูู': null,
                            'ุชุงุฑูุฎ ุงููุณุท ุงูุซุงูู': null,
                            'ูุจูุบ ุงููุณุท ุงูุซุงูู': null,
                            'ุชุงุฑูุฎ ููุงูุฉ ุงููุณุท': null,
                            'ููุน ุงูุนูุฏ': 'ุณููู'
                        };

                        addResult('findPropertyResults', 'success', 'ุชู ุชุญููู ุงูุชุนุฑูู! โ',
                            'ุชู ุชุญููู ุชุนุฑูู ุงูุนูุงุฑ ุฅูู ุชูุณูู properties ุจูุฌุงุญ');
                    }
                }

                // ุงููุชูุฌุฉ ุงูููุงุฆูุฉ
                if (baseProperty) {
                    addResult('findPropertyResults', 'success', 'ูุฌุญ ุงุฎุชุจุงุฑ ุงูุจุญุซ! โ',
                        `ุชู ุงูุนุซูุฑ ุนูู ุงูุนูุงุฑ "${propertyName}" ูุชุญูููู ููุชูุณูู ุงููุทููุจ`);
                    testResults.findProperty = true;

                    // ุนุฑุถ ุชูุงุตูู ุงูุนูุงุฑ
                    let html = '<div class="data-display"><h4>ุชูุงุตูู ุงูุนูุงุฑ ุงูููุฌูุฏ:</h4>';
                    html += `<p><strong>ุงุณู ุงูุนูุงุฑ:</strong> ${baseProperty['ุงุณู ุงูุนูุงุฑ']}</p>`;
                    html += `<p><strong>ุงููุฏููุฉ:</strong> ${baseProperty['ุงููุฏููุฉ']}</p>`;
                    html += `<p><strong>ุงููุงูู:</strong> ${baseProperty['ุงููุงูู']}</p>`;
                    html += `<p><strong>ุฑูู ุงูุตู:</strong> ${baseProperty['ุฑูู ุงูุตู']}</p>`;
                    html += '</div>';

                    addResult('findPropertyResults', 'info', 'ุชูุงุตูู ุงูุนูุงุฑ', html);
                } else {
                    addResult('findPropertyResults', 'error', 'ูุดู ุงุฎุชุจุงุฑ ุงูุจุญุซ! โ',
                        'ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูุนูุงุฑ ูู ุฃู ูู ุงููุตุฏุฑูู');
                    testResults.findProperty = false;
                }

            } catch (error) {
                addResult('findPropertyResults', 'error', 'ุฎุทุฃ ูู ุงุฎุชุจุงุฑ ุงูุจุญุซ',
                    `ุฎุทุฃ: ${error.message}`);
                testResults.findProperty = false;
            }
        }

        // ุงุฎุชุจุงุฑ 4.5: ูุญุต ุงูุชูุฑุงุฑ
        function testDuplication() {
            addResult('duplicationResults', 'info', 'ุจุฏุก ูุญุต ุงูุชูุฑุงุฑ', 'ุฌุงุฑู ูุญุต ุชูุฑุงุฑ ุงูุนูุงุฑ ูู ุงููุตุฏุฑูู...');

            try {
                const propertyName = testPropertyName;

                // ูุญุต ูุฌูุฏ ุงูุนูุงุฑ ูู properties
                const inProperties = window.properties ?
                    window.properties.filter(p => p['ุงุณู ุงูุนูุงุฑ'] === propertyName) : [];

                // ูุญุต ูุฌูุฏ ุงูุนูุงุฑ ูู propertyDefinitions
                const inDefinitions = window.propertyDefinitions ?
                    window.propertyDefinitions.filter(p => p.name === propertyName) : [];

                addResult('duplicationResults', 'info', 'ูุชุงุฆุฌ ุงูุจุญุซ',
                    `ูู properties: ${inProperties.length} ุนูุตุฑ<br>ูู propertyDefinitions: ${inDefinitions.length} ุนูุตุฑ`);

                // ุงูุชุญูู ูู ุงูุชูุฑุงุฑ
                const totalCount = inProperties.length + inDefinitions.length;
                const hasUnits = inProperties.length > 0;
                const hasDefinition = inDefinitions.length > 0;

                if (hasUnits && hasDefinition) {
                    addResult('duplicationResults', 'error', 'ุชู ุงูุชุดุงู ุชูุฑุงุฑ! โ',
                        `ุงูุนูุงุฑ ููุฌูุฏ ูู ุงููุตุฏุฑูู:<br>- properties: ${inProperties.length} ูุญุฏุฉ<br>- propertyDefinitions: ${inDefinitions.length} ุชุนุฑูู`);
                    testResults.duplication = false;
                } else if (hasUnits && !hasDefinition) {
                    addResult('duplicationResults', 'success', 'ูุง ููุฌุฏ ุชูุฑุงุฑ! โ',
                        `ุงูุนูุงุฑ ููุฌูุฏ ูู properties ููุท (${inProperties.length} ูุญุฏุฉ) ูุชู ุญุฐูู ูู propertyDefinitions`);
                    testResults.duplication = true;
                } else if (!hasUnits && hasDefinition) {
                    addResult('duplicationResults', 'info', 'ุงูุนูุงุฑ ูู ุงูุชุนุฑููุงุช ููุท',
                        `ุงูุนูุงุฑ ููุฌูุฏ ูู propertyDefinitions ููุท (${inDefinitions.length} ุชุนุฑูู) - ูู ุชุชู ุฅุถุงูุฉ ูุญุฏุงุช ุจุนุฏ`);
                    testResults.duplication = true;
                } else {
                    addResult('duplicationResults', 'warning', 'ุงูุนูุงุฑ ุบูุฑ ููุฌูุฏ',
                        'ุงูุนูุงุฑ ุบูุฑ ููุฌูุฏ ูู ุฃู ูู ุงููุตุฏุฑูู');
                    testResults.duplication = false;
                }

                // ุนุฑุถ ุชูุงุตูู ุฅุถุงููุฉ
                if (inProperties.length > 0) {
                    let html = '<div class="data-display"><h4>ุงููุญุฏุงุช ูู properties:</h4>';
                    inProperties.forEach((unit, index) => {
                        html += `<p>${index + 1}. ูุญุฏุฉ ${unit['ุฑูู  ุงููุญุฏุฉ '] || 'ุบูุฑ ูุญุฏุฏ'}</p>`;
                    });
                    html += '</div>';
                    addResult('duplicationResults', 'info', 'ุชูุงุตูู ุงููุญุฏุงุช', html);
                }

                if (inDefinitions.length > 0) {
                    let html = '<div class="data-display"><h4>ุงูุชุนุฑููุงุช ูู propertyDefinitions:</h4>';
                    inDefinitions.forEach((def, index) => {
                        html += `<p>${index + 1}. ุชุนุฑูู: ${def.name}</p>`;
                    });
                    html += '</div>';
                    addResult('duplicationResults', 'info', 'ุชูุงุตูู ุงูุชุนุฑููุงุช', html);
                }

            } catch (error) {
                addResult('duplicationResults', 'error', 'ุฎุทุฃ ูู ูุญุต ุงูุชูุฑุงุฑ',
                    `ุฎุทุฃ: ${error.message}`);
                testResults.duplication = false;
            }
        }

        // ุงุฎุชุจุงุฑ 4: ุฅุถุงูุฉ ูุญุฏุฉ ููุนูุงุฑ
        function testAddUnit() {
            addResult('addUnitResults', 'info', 'ุจุฏุก ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ุงููุญุฏุฉ', 'ุฌุงุฑู ูุญุงูุงุฉ ุฅุถุงูุฉ ูุญุฏุฉ ููุนูุงุฑ...');

            try {
                const propertyName = testPropertyName;
                const unitNumber = testUnitNumber;
                const unitArea = '120';
                const electricity = 'ELE123';

                // ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ูุญุฏุฉ ุจููุณ ุงูุฑูู
                const existingUnit = window.properties ?
                    window.properties.find(p => p['ุงุณู ุงูุนูุงุฑ'] === propertyName && p['ุฑูู  ุงููุญุฏุฉ '] === unitNumber) : null;

                if (existingUnit) {
                    addResult('addUnitResults', 'warning', 'ุงููุญุฏุฉ ููุฌูุฏุฉ ุจุงููุนู',
                        'ููุฌุฏ ูุญุฏุฉ ุจููุณ ุงูุฑูู ูู ูุฐุง ุงูุนูุงุฑ');
                    testResults.addUnit = false;
                    return;
                }

                // ุงูุจุญุซ ุนู ุงูุนูุงุฑ (ูุญุงูุงุฉ ุงูููุฏ ุงููุญุณู)
                let baseProperty = window.properties ?
                    window.properties.find(p => p['ุงุณู ุงูุนูุงุฑ'] === propertyName) : null;

                if (!baseProperty) {
                    const propertyDefinition = window.propertyDefinitions ?
                        window.propertyDefinitions.find(p => p.name === propertyName) : null;

                    if (propertyDefinition) {
                        baseProperty = {
                            'ุงุณู ุงูุนูุงุฑ': propertyDefinition.name,
                            'ุงููุฏููุฉ': propertyDefinition.city,
                            'ุฑูู ุงูุตู': propertyDefinition.deed,
                            'ูุณุงุญุฉุงูุตู': propertyDefinition.area,
                            'ุงูุณุฌู ุงูุนููู ': propertyDefinition.registry,
                            'ูููุน ุงูุนูุงุฑ': propertyDefinition.location,
                            'ุงููุงูู': propertyDefinition.owner,
                            'ุงูุงุฑุชูุงุน': null,
                            'ุงุณู ุงููุณุชุฃุฌุฑ': null,
                            'ุฑูู ุงูุนูุฏ': null,
                            'ูููุฉ  ุงูุงูุฌุงุฑ ': null,
                            'ุชุงุฑูุฎ ุงูุจุฏุงูุฉ': null,
                            'ุชุงุฑูุฎ ุงูููุงูุฉ': null,
                            'ุงูุงุฌูุงูู': 0.0,
                            'ุฑูู ุญุณุงุจ ุงูููุฑุจุงุก': null,
                            'ุนุฏุฏ ุงูุงูุณุงุท ุงููุชุจููุฉ': null,
                            'ุชุงุฑูุฎ ุงููุณุท ุงูุงูู': null,
                            'ูุจูุบ ุงููุณุท ุงูุงูู': null,
                            'ุชุงุฑูุฎ ุงููุณุท ุงูุซุงูู': null,
                            'ูุจูุบ ุงููุณุท ุงูุซุงูู': null,
                            'ุชุงุฑูุฎ ููุงูุฉ ุงููุณุท': null,
                            'ููุน ุงูุนูุฏ': 'ุณููู'
                        };
                    }
                }

                if (!baseProperty) {
                    addResult('addUnitResults', 'error', 'ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูุนูุงุฑ',
                        'ุงูุนูุงุฑ ุบูุฑ ููุฌูุฏ ูู ุงููุธุงู');
                    testResults.addUnit = false;
                    return;
                }

                // ุฅูุดุงุก ุงููุญุฏุฉ ุงูุฌุฏูุฏุฉ
                const newUnit = {
                    ...baseProperty,
                    'ุฑูู  ุงููุญุฏุฉ ': unitNumber,
                    'ุงููุณุงุญุฉ': parseFloat(unitArea) || null,
                    'ุฑูู ุญุณุงุจ ุงูููุฑุจุงุก': electricity || null,
                    'ุงุณู ุงููุณุชุฃุฌุฑ': null,
                    'ุฑูู ุงูุนูุฏ': null,
                    'ูููุฉ  ุงูุงูุฌุงุฑ ': null,
                    'ุชุงุฑูุฎ ุงูุจุฏุงูุฉ': null,
                    'ุชุงุฑูุฎ ุงูููุงูุฉ': null,
                    'ุงูุงุฌูุงูู': 0.0,
                    'ุนุฏุฏ ุงูุงูุณุงุท ุงููุชุจููุฉ': null,
                    'ุชุงุฑูุฎ ุงููุณุท ุงูุงูู': null,
                    'ูุจูุบ ุงููุณุท ุงูุงูู': null,
                    'ุชุงุฑูุฎ ุงููุณุท ุงูุซุงูู': null,
                    'ูุจูุบ ุงููุณุท ุงูุซุงูู': null,
                    'ุชุงุฑูุฎ ููุงูุฉ ุงููุณุท': null
                };

                // ุฅุถุงูุฉ ุงููุญุฏุฉ ุฅูู ุงููุตูููุฉ
                window.properties.push(newUnit);
                localStorage.setItem('properties', JSON.stringify(window.properties));

                addResult('addUnitResults', 'success', 'ูุฌุญ ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ุงููุญุฏุฉ! โ',
                    `ุชู ุฅุถุงูุฉ ุงููุญุฏุฉ "${unitNumber}" ููุนูุงุฑ "${propertyName}" ุจูุฌุงุญ`);
                testResults.addUnit = true;

                // ุนุฑุถ ุชูุงุตูู ุงููุญุฏุฉ ุงููุถุงูุฉ
                let html = '<div class="data-display"><h4>ุชูุงุตูู ุงููุญุฏุฉ ุงููุถุงูุฉ:</h4>';
                html += `<p><strong>ุฑูู ุงููุญุฏุฉ:</strong> ${newUnit['ุฑูู  ุงููุญุฏุฉ ']}</p>`;
                html += `<p><strong>ุงุณู ุงูุนูุงุฑ:</strong> ${newUnit['ุงุณู ุงูุนูุงุฑ']}</p>`;
                html += `<p><strong>ุงููุฏููุฉ:</strong> ${newUnit['ุงููุฏููุฉ']}</p>`;
                html += `<p><strong>ุงููุณุงุญุฉ:</strong> ${newUnit['ุงููุณุงุญุฉ']} ูยฒ</p>`;
                html += `<p><strong>ุฑูู ุญุณุงุจ ุงูููุฑุจุงุก:</strong> ${newUnit['ุฑูู ุญุณุงุจ ุงูููุฑุจุงุก']}</p>`;
                html += '</div>';

                addResult('addUnitResults', 'info', 'ุชูุงุตูู ุงููุญุฏุฉ', html);

            } catch (error) {
                addResult('addUnitResults', 'error', 'ุฎุทุฃ ูู ุฅุถุงูุฉ ุงููุญุฏุฉ',
                    `ุฎุทุฃ: ${error.message}`);
                testResults.addUnit = false;
            }
        }

        // ุงุฎุชุจุงุฑ 5: ุชูุธูู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ
        function cleanupTestData() {
            addResult('cleanupResults', 'info', 'ุจุฏุก ุชูุธูู ุงูุจูุงูุงุช', 'ุฌุงุฑู ุญุฐู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ...');

            try {
                let deletedCount = 0;

                // ุญุฐู ุงูุนูุงุฑ ุงูุชุฌุฑูุจู ูู propertyDefinitions
                if (window.propertyDefinitions) {
                    const definitionIndex = window.propertyDefinitions.findIndex(p => p.name === testPropertyName);
                    if (definitionIndex !== -1) {
                        window.propertyDefinitions.splice(definitionIndex, 1);
                        localStorage.setItem('propertyDefinitions', JSON.stringify(window.propertyDefinitions));
                        deletedCount++;
                    }
                }

                // ุญุฐู ุงููุญุฏุฉ ุงูุชุฌุฑูุจูุฉ ูู properties
                if (window.properties) {
                    for (let i = window.properties.length - 1; i >= 0; i--) {
                        if (window.properties[i]['ุงุณู ุงูุนูุงุฑ'] === testPropertyName) {
                            window.properties.splice(i, 1);
                            deletedCount++;
                        }
                    }
                    localStorage.setItem('properties', JSON.stringify(window.properties));
                }

                if (deletedCount > 0) {
                    addResult('cleanupResults', 'success', 'ุชู ุชูุธูู ุงูุจูุงูุงุช! โ',
                        `ุชู ุญุฐู ${deletedCount} ุนูุตุฑ ูู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ`);
                    testResults.cleanup = true;
                } else {
                    addResult('cleanupResults', 'warning', 'ูุง ุชูุฌุฏ ุจูุงูุงุช ููุญุฐู',
                        'ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ุบูุฑ ููุฌูุฏุฉ ุฃู ุชู ุญุฐููุง ูุณุจูุงู');
                    testResults.cleanup = true; // ูุนุชุจุฑู ูุฌุงุญ
                }

            } catch (error) {
                addResult('cleanupResults', 'error', 'ุฎุทุฃ ูู ุชูุธูู ุงูุจูุงูุงุช',
                    `ุฎุทุฃ: ${error.message}`);
                testResults.cleanup = false;
            }
        }

        // ุฅูุดุงุก ุชูุฑูุฑ ููุงุฆู
        function generateFinalReport() {
            addResult('finalReport', 'info', 'ุฅูุดุงุก ุงูุชูุฑูุฑ ุงูููุงุฆู', 'ุฌุงุฑู ุชุฌููุน ูุชุงุฆุฌ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช...');

            let reportHtml = '<div style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 8px; padding: 15px; margin: 15px 0;">';
            reportHtml += '<h4><i class="fas fa-chart-bar"></i> ุชูุฑูุฑ ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ูุญุฏุฉ ููุนูุงุฑ</h4>';

            // ููุฎุต ุงููุชุงุฆุฌ
            const tests = [
                { name: 'ุฅุถุงูุฉ ุงูุนูุงุฑ ุจุฏูู ูุญุฏุงุช', result: testResults.addProperty },
                { name: 'ูุญุต ูุงุฆูุฉ ุงูุนูุงุฑุงุช', result: testResults.propertyList },
                { name: 'ูุญุงูุงุฉ ุงูุจุญุซ ุนู ุงูุนูุงุฑ', result: testResults.findProperty },
                { name: 'ุฅุถุงูุฉ ูุญุฏุฉ ููุนูุงุฑ', result: testResults.addUnit },
                { name: 'ูุญุต ุงูุชูุฑุงุฑ', result: testResults.duplication },
                { name: 'ุชูุธูู ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ', result: testResults.cleanup }
            ];

            let passedTests = 0;
            let totalTests = 0;

            reportHtml += '<h5>ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑุงุช:</h5><ul>';
            tests.forEach(test => {
                if (test.result !== null) {
                    totalTests++;
                    if (test.result === true) {
                        passedTests++;
                        reportHtml += `<li style="color: #28a745;">โ ${test.name}: ูุฌุญ</li>`;
                    } else {
                        reportHtml += `<li style="color: #dc3545;">โ ${test.name}: ูุดู</li>`;
                    }
                } else {
                    reportHtml += `<li style="color: #6c757d;">โ ${test.name}: ูู ูุชู ุชุดุบููู</li>`;
                }
            });
            reportHtml += '</ul>';

            // ุงูุชูุตูุงุช
            reportHtml += '<h5>ุงูุชูุตูุงุช:</h5>';
            if (passedTests === totalTests) {
                reportHtml += '<p style="color: #28a745;">๐ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ูุฌุญุช! ุงููุดููุฉ ูุญูููุฉ ุจุงููุงูู.</p>';
                reportHtml += '<p><strong>โ ุงููุชุงุฆุฌ ุงููุญููุฉ:</strong></p>';
                reportHtml += '<ul>';
                reportHtml += '<li>โ ุงูุนูุงุฑุงุช ุจุฏูู ูุญุฏุงุช ุชุธูุฑ ูู ูุงุฆูุฉ ุฅุถุงูุฉ ุงููุญุฏุงุช</li>';
                reportHtml += '<li>โ ุฏุงูุฉ addNewUnit ุชุจุญุซ ูู ุงููุตุฏุฑูู ุจูุฌุงุญ</li>';
                reportHtml += '<li>โ ูููู ุฅุถุงูุฉ ูุญุฏุงุช ููุนูุงุฑุงุช ุจุฏูู ูุดุงูู</li>';
                reportHtml += '<li>โ ุงููุธุงู ูุญูู ุชุนุฑููุงุช ุงูุนูุงุฑุงุช ููุชูุณูู ุงููุทููุจ</li>';
                reportHtml += '<li>โ ูุง ุชูุฌุฏ ุฑุณุงูุฉ "ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูุนูุงุฑ ุงููุญุฏุฏ"</li>';
                reportHtml += '</ul>';
            } else {
                reportHtml += '<p style="color: #ffc107;">โ๏ธ ุจุนุถ ุงูุงุฎุชุจุงุฑุงุช ุชุญุชุงุฌ ุชุญุณูู</p>';
            }

            reportHtml += '</div>';

            const reportType = passedTests === totalTests ? 'success' : 'warning';
            addResult('finalReport', reportType, `ุงูุชูู ุงูุชูุฑูุฑ (${passedTests}/${totalTests})`, reportHtml);
        }

        // ุชุดุบูู ุชููุงุฆู ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        window.addEventListener('load', () => {
            addResult('addPropertyResults', 'info', '๐ ูุฑุญุจุงู ุจู ูู ุงุฎุชุจุงุฑ ุฅุถุงูุฉ ุงููุญุฏุงุช',
                'ุงุถุบุท ุนูู ุงูุฃุฒุฑุงุฑ ุฃุนูุงู ูุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช ุงููุฎุชููุฉ');
        });
    </script>
</body>
</html>

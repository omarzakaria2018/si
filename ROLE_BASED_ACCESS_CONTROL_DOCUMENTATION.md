# ๐ ูุธุงู ุงูุชุญูู ูู ุงููุตูู ุงููุงุฆู ุนูู ุงูุฃุฏูุงุฑ (RBAC)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทุจูู ูุธุงู ุดุงูู ููุชุญูู ูู ุงููุตูู ุงููุงุฆู ุนูู ุงูุฃุฏูุงุฑ ูุชูููุฏ ูุตูู ุงููุณุชุฎุฏููู ูุญุฏูุฏู ุงูุตูุงุญูุงุช ุฅูู ููุฒุงุช ูุนููุฉ ูู ุงูุชุทุจูู. ูุฐุง ุงููุธุงู ูููุฑ ุญูุงูุฉ ุนูู ูุณุชูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ูุงูุฎูููุฉ.

## ๐ค ุงููุณุชุฎุฏู ุงููุณุชูุฏู

**ุงุณู ุงููุณุชุฎุฏู:** `sa12345`  
**ูููุฉ ุงููุฑูุฑ:** `sa12345`  
**ุงูุฏูุฑ:** `limited` (ูุณุชุฎุฏู ูุญุฏูุฏ ุงูุตูุงุญูุงุช)

## ๐ซ ุงูููุฒุงุช ุงููุญุธูุฑุฉ

### 1. ุฅุนุงุฏุฉ ุชุนููู ุงูุญุงูุฉ (Status Reset)
- **ุงููุธุงุฆู ุงููุญุธูุฑุฉ:**
  - `clearAppStateWithConfirmation()`
  - ุฒุฑ "ุฅุนุงุฏุฉ ุชุนููู ุงูุญุงูุฉ" ูู ุงููุงุฆูุฉ ุงููุญูููุฉ
- **ุงูุชุทุจูู:** ุฅุฎูุงุก ุงูุฃุฒุฑุงุฑ + ููุน ุชูููุฐ ุงููุธุงุฆู

### 2. ุฅุตูุงุญ ุงูุฅุญุตุงุฆูุงุช (Statistics Correction)
- **ุงููุธุงุฆู ุงููุญุธูุฑุฉ:**
  - `fixStatisticsNow()`
  - ุฃุฒุฑุงุฑ "ุฅุตูุงุญ ุงูุฅุญุตุงุฆูุงุช" ูู ุงููุงุฌูุฉ ููุงุฆูุฉ ุงูุฌูุงู
- **ุงูุชุทุจูู:** ุฅุฎูุงุก ุงูุฃุฒุฑุงุฑ + ููุน ุชูููุฐ ุงููุธุงุฆู

### 3. ุชุญุฏูุซ ุงูุชูุงุฑูุฎ (Date Updates)
- **ุงููุธุงุฆู ุงููุญุธูุฑุฉ:**
  - `showDateUpdateModal()`
  - `openDateUpdateModal()`
  - ุฃุฒุฑุงุฑ "ุชุญุฏูุซ ุงูุชูุงุฑูุฎ" ูู ุงููุงุฌูุฉ ููุงุฆูุฉ ุงูุฌูุงู
- **ุงูุชุทุจูู:** ุฅุฎูุงุก ุงูุฃุฒุฑุงุฑ + ููุน ุชูููุฐ ุงููุธุงุฆู

### 4. ุณุฌูุงุช ุงูุชุชุจุน ูุงููุฑุงุฌุนุฉ (Tracking/Audit Logs)
- **ุงููุธุงุฆู ุงููุญุธูุฑุฉ:**
  - `createSampleTrackingDataAndShow()`
  - `deleteTrackingLog()`
  - `cleanupOldTrackingLogs()`
  - ุฃุฒุฑุงุฑ "ุณุฌู ุงูุชุชุจุน" ูู ุงููุงุฌูุฉ ููุงุฆูุฉ ุงูุฌูุงู
- **ุงูุชุทุจูู:** ุฅุฎูุงุก ุงูุฃุฒุฑุงุฑ + ููุน ุงููุตูู ููุณุฌูุงุช + ููุน ุงูุญุฐู

### 5. ููุฒุงุช ุฅุถุงููุฉ ูุญุธูุฑุฉ
- **ุฅุฏุงุฑุฉ ุงูุนูุงุฑุงุช:** `showPropertyManager()`
- **ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช:** `showDataImportModal()`
- **ุชูุธูู ุงูุชุฎุฒูู:** `showStorageCleanupModal()`
- **ุฅุฏุงุฑุฉ ุงููุฑููุงุช:** ุฑูุน ูุญุฐู ุงููููุงุช

## โ ุงูููุฒุงุช ุงููุณููุญุฉ

### 1. ุนุฑุถ ุงูุจูุงูุงุช
- ูุดุงูุฏุฉ ุฌููุน ุงูุนูุงุฑุงุช ูุงููุญุฏุงุช
- ุงููุตูู ูุฌููุน ุงููุนูููุงุช (ููุนุฑุถ ููุท)

### 2. ุงูุจุญุซ ูุงูููุชุฑุฉ
- ุงุณุชุฎุฏุงู ุฌููุน ุฃุฏูุงุช ุงูุจุญุซ
- ุชุทุจูู ุงูููุงุชุฑ ุงููุฎุชููุฉ
- ุงูุชููู ุจูู ุงูุตูุญุงุช

### 3. ุงูุชุตุฏูุฑ
- ุชุตุฏูุฑ ุงูุจูุงูุงุช ุฅูู Excel
- ุชุญููู ุงูุชูุงุฑูุฑ

### 4. ุงููุฑููุงุช (ุนุฑุถ ููุท)
- ูุดุงูุฏุฉ ุงููุฑููุงุช ุงูููุฌูุฏุฉ
- ุชุญููู ุงููููุงุช
- **ููููุน:** ุฑูุน ุฃู ุญุฐู ูููุงุช ุฌุฏูุฏุฉ

## ๐๏ธ ุงูุชุทุจูู ุงูุชููู

### 1. ูุณุชูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ (Frontend)

#### ุฃ) ุฅุฎูุงุก ุงูุนูุงุตุฑ ุจู CSS
```css
/* ุฅุฎูุงุก ุงูุฃุฒุฑุงุฑ ุงูุฅุฏุงุฑูุฉ ูููุณุชุฎุฏู ูุญุฏูุฏ ุงูุตูุงุญูุงุช */
.limited-user .admin-only-feature {
  display: none !important;
}

/* ุฅุฎูุงุก ุฃุฒุฑุงุฑ ูุญุฏุฏุฉ */
.limited-user #trackingManagementBtn,
.limited-user #mobile-change-tracking-btn,
.limited-user #dataImportBtn,
.limited-user #cleanStorageBtn {
  display: none !important;
}
```

#### ุจ) ุชูููุฏ ุงููุตูู ุจู JavaScript
```javascript
// ุญูุงูุฉ ุงููุธุงุฆู ุจูุญุต ุงูุตูุงุญูุงุช
const originalFixStatisticsNow = window.fixStatisticsNow;
window.fixStatisticsNow = function() {
    if (!checkPermission('fixStatistics')) {
        showNoPermissionMessage('ููุณ ูุฏูู ุตูุงุญูุฉ ูุฅุตูุงุญ ุงูุฅุญุตุงุฆูุงุช');
        return;
    }
    if (originalFixStatisticsNow) originalFixStatisticsNow();
};
```

#### ุฌ) ูุธุงู ุงูุตูุงุญูุงุช
```javascript
// ุชุนุฑูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู sa12345
'sa12345': {
    password: 'sa12345',
    role: 'limited',
    fullName: 'ูุณุชุฎุฏู ูุญุฏูุฏ ุงูุตูุงุญูุงุช',
    permissions: {
        viewData: true,
        editData: false,
        deleteData: false,
        manageProperties: false,
        manageAttachments: false,
        exportData: true,
        importData: false,
        manageSettings: false,
        resetStatus: false,
        fixStatistics: false,
        updateDates: false,
        accessTrackingLogs: false,
        deleteTrackingLogs: false
    }
}
```

### 2. ูุณุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (Backend)

#### ุฃ) Row Level Security (RLS)
```sql
-- ุชูุนูู RLS ุนูู ุฌุฏูู ุณุฌูุงุช ุงูุชุชุจุน
ALTER TABLE tracking_logs ENABLE ROW LEVEL SECURITY;

-- ุณูุงุณุฉ ุงููุฑุงุกุฉ: ูููุฏูุฑูู ููุท
CREATE POLICY "Allow tracking logs read for admins" ON tracking_logs
    FOR SELECT USING (
        EXISTS (
            SELECT 1 FROM user_roles 
            WHERE username = current_setting('app.current_user', true)
            AND role IN ('admin', 'assistant_admin')
        )
    );
```

#### ุจ) ุฏูุงู ุงูุชุญูู ูู ุงูุตูุงุญูุงุช
```sql
-- ุฏุงูุฉ ููุชุญูู ูู ุตูุงุญูุฉ ุงููุณุชุฎุฏู
CREATE OR REPLACE FUNCTION check_user_permission(username_param TEXT, permission_name TEXT)
RETURNS BOOLEAN AS $$
DECLARE
    user_permissions JSONB;
BEGIN
    SELECT permissions INTO user_permissions
    FROM user_roles
    WHERE username = username_param;
    
    RETURN COALESCE((user_permissions ->> permission_name)::BOOLEAN, FALSE);
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

### 3. ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูู ุงูููุฏ

#### ุฃ) ูู tracking-logs-manager.js
```javascript
// ุญุฐู ุณุฌู ุชุชุจุน ูุญุฏุฏ
async function deleteTrackingLog(logId) {
    // ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู
    if (typeof window !== 'undefined' && window.checkPermission) {
        if (!window.checkPermission('deleteTrackingLogs')) {
            console.warn('๐ ุงููุณุชุฎุฏู ูุง ูููู ุตูุงุญูุฉ ุญุฐู ุณุฌูุงุช ุงูุชุชุจุน');
            return false;
        }
    }
    // ุจุงูู ุงูููุฏ...
}
```

## ๐งช ุงูุงุฎุชุจุงุฑ

### 1. ููู ุงูุงุฎุชุจุงุฑ
ุชู ุฅูุดุงุก ููู `test-limited-user-access-control.html` ูุงุฎุชุจุงุฑ ุงููุธุงู ุดุงููุงู.

### 2. ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ
1. ูุชุญ ุงูุชุทุจูู ุงูุฑุฆูุณู
2. ุชุณุฌูู ุงูุฏุฎูู ุจู `sa12345` / `sa12345`
3. ุงูุชุญูู ูู ุฅุฎูุงุก ุงูุฃุฒุฑุงุฑ ุงููุญุธูุฑุฉ
4. ูุญุงููุฉ ุงููุตูู ูููุธุงุฆู ุงููุญุธูุฑุฉ (ูุฌุจ ุธููุฑ ุฑุณุงูุฉ ููุน)
5. ุงุฎุชุจุงุฑ ุงููุธุงุฆู ุงููุณููุญุฉ (ูุฌุจ ุฃู ุชุนูู ุจุดูู ุทุจูุนู)

### 3. ุงููุชุงุฆุฌ ุงููุชููุนุฉ
- โ ุฅุฎูุงุก ุฌููุน ุงูุฃุฒุฑุงุฑ ุงููุญุธูุฑุฉ ูู ุงููุงุฌูุฉ
- โ ุธููุฑ ุฑุณุงูุฉ ููุน ุนูุฏ ูุญุงููุฉ ุงููุตูู ูููุธุงุฆู ุงููุญุธูุฑุฉ
- โ ุนูู ุงููุธุงุฆู ุงููุณููุญุฉ ุจุดูู ุทุจูุนู
- โ ููุน ุงููุตูู ูุณุฌูุงุช ุงูุชุชุจุน ุนูู ูุณุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

### 1. ูููุงุช CSS
- `style.css`: ุฅุถุงูุฉ ููุงุนุฏ ุฅุฎูุงุก ุงูุนูุงุตุฑ ูููุณุชุฎุฏู ูุญุฏูุฏ ุงูุตูุงุญูุงุช

### 2. ูููุงุช JavaScript
- `script.js`: ุชุญุฏูุซ ูุธุงู ุงูุตูุงุญูุงุช ูุฅุถุงูุฉ ุญูุงูุฉ ุงููุธุงุฆู
- `tracking-logs-manager.js`: ุฅุถุงูุฉ ูุญุต ุงูุตูุงุญูุงุช ููุธุงุฆู ุณุฌูุงุช ุงูุชุชุจุน

### 3. ูููุงุช SQL
- `limited-user-security-policies.sql`: ุณูุงุณุงุช ุงูุฃูุงู ููุงุนุฏุฉ ุงูุจูุงูุงุช

### 4. ูููุงุช ุงูุงุฎุชุจุงุฑ
- `test-limited-user-access-control.html`: ุฃุฏุงุฉ ุงุฎุชุจุงุฑ ุดุงููุฉ ูููุธุงู

## ๐ง ุงูุตูุงูุฉ ูุงูุชุทููุฑ

### ุฅุถุงูุฉ ููุฒุฉ ุฌุฏูุฏุฉ ูุญุธูุฑุฉ
1. ุฅุถุงูุฉ ุงูุตูุงุญูุฉ ุงูุฌุฏูุฏุฉ ูู `users['sa12345'].permissions`
2. ุฅุถุงูุฉ ุญูุงูุฉ ุงููุธููุฉ ูู JavaScript
3. ุฅุถุงูุฉ ูุงุนุฏุฉ CSS ูุฅุฎูุงุก ุงูุนูุตุฑ ุฅุฐุง ูุฒู ุงูุฃูุฑ
4. ุชุญุฏูุซ ุณูุงุณุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฅุฐุง ูุฒู ุงูุฃูุฑ

### ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ
1. ุฅุถุงูุฉ ุงููุณุชุฎุฏู ูู ูุงุฆู `users` ูู `script.js`
2. ุฅุถุงูุฉ ุงููุณุชุฎุฏู ูู ุฌุฏูู `user_roles` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ุชุญุฏูุฏ ุงูุตูุงุญูุงุช ุงูููุงุณุจุฉ

## ๐งน ุญู ูุดููุฉ ุงููุณุงุญุงุช ุงููุงุฑุบุฉ

### ุงููุดููุฉ
ุนูุฏ ุฅุฎูุงุก ุงูุฃุฒุฑุงุฑ ุงููุญุธูุฑุฉุ ูุงูุช ุชุธูุฑ ูุณุงุญุงุช ูุงุฑุบุฉ ูู ุงููุงุฌูุฉ ููุง ูุคุซุฑ ุนูู ุงูุชุฎุทูุท ูุงููุธูุฑ ุงูุนุงู.

### ุงูุญู ุงููุทุจู

#### 1. ุชุญุณูู CSS
```css
/* ุฅุฒุงูุฉ ุงููุณุงุญุงุช ุงููุงุฑุบุฉ ุจุงููุงูู */
.limited-user .admin-only-feature {
  display: none !important;
  width: 0 !important;
  height: 0 !important;
  margin: 0 !important;
  padding: 0 !important;
  border: none !important;
  overflow: hidden !important;
}

/* ุชุญุณูู ุชุฎุทูุท ุงูุญุงููุงุช */
.limited-user .header-actions {
  display: flex !important;
  flex-wrap: wrap !important;
  gap: 8px !important;
  align-items: center !important;
}
```

#### 2. ุฅุฒุงูุฉ ุฏููุงููููุฉ ุจู JavaScript
```javascript
// ุฏุงูุฉ ูุฅุฒุงูุฉ ุงููุณุงุญุงุช ุงููุงุฑุบุฉ
function removeEmptySpacesFromHiddenElements() {
    // ุฅุนุงุฏุฉ ุชุฑุชูุจ ุงูุนูุงุตุฑ ุงููุฑุฆูุฉ ููุท
    const headerActions = document.querySelector('.header-section.header-actions');
    if (headerActions) {
        const visibleElements = Array.from(headerActions.children).filter(child => {
            const computedStyle = window.getComputedStyle(child);
            return computedStyle.display !== 'none' && computedStyle.visibility !== 'hidden';
        });

        headerActions.innerHTML = '';
        visibleElements.forEach(element => {
            headerActions.appendChild(element);
        });
    }
}
```

#### 3. ุฅุฒุงูุฉ ูุชูุฏูุฉ
```javascript
// ุฏุงูุฉ ูุชูุฏูุฉ ูุฅุฒุงูุฉ ุดุงููุฉ ูููุณุงุญุงุช
function advancedSpaceRemoval() {
    // ุฅุฒุงูุฉ ุงูุนูุงุตุฑ ุงููุฎููุฉ ุชูุงูุงู ูู DOM
    // ุชุทุจูู flexbox ููุชุฑุชูุจ ุงููุญุณู
    // ุฅุฒุงูุฉ ุงูููุงุตู ุงููุชุชุงููุฉ
    // ุชุญุณูู ุงููุงุฆูุฉ ุงููุญูููุฉ
}
```

### ุงููุชุงุฆุฌ
- โ ุฅุฒุงูุฉ ูุงููุฉ ูููุณุงุญุงุช ุงููุงุฑุบุฉ
- โ ุชุฎุทูุท ูุธูู ููุฑุชุจ
- โ ุชุฑุชูุจ ุงูุฃุฒุฑุงุฑ ุงููุฑุฆูุฉ ุจุดูู ูุชุชุงูู
- โ ุนุฏู ูุฌูุฏ ููุงุตู ุฒุงุฆุฏุฉ ูู ุงูููุงุฆู

## ๐ก๏ธ ุงูุฃูุงู

ุงููุธุงู ูููุฑ ุญูุงูุฉ ูุชุนุฏุฏุฉ ุงููุณุชููุงุช:
1. **ูุณุชูู ุงููุงุฌูุฉ:** ุฅุฎูุงุก ุงูุนูุงุตุฑ ูุชูููุฏ ุงููุตูู + ุฅุฒุงูุฉ ุงููุณุงุญุงุช ุงููุงุฑุบุฉ
2. **ูุณุชูู ุงูุชุทุจูู:** ูุญุต ุงูุตูุงุญูุงุช ูุจู ุชูููุฐ ุงููุธุงุฆู
3. **ูุณุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:** Row Level Security ูุณูุงุณุงุช ุงููุตูู

ูุฐุง ูุถูู ุนุฏู ุฅููุงููุฉ ุชุฌุงูุฒ ุงููููุฏ ุญุชู ูู ุชู ุงูุชูุงุนุจ ุจุงููุงุฌูุฉ ุงูุฃูุงููุฉ.

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” ÙØ­Øµ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¯ÙˆØ¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</title>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            margin: 20px;
            background: #f8f9fa;
            direction: rtl;
        }
        .debug-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .debug-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .debug-button:hover {
            background: #0056b3;
        }
        .urgent-button {
            background: #dc3545;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .results {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .warning { color: #ffc107; font-weight: bold; }
        .info { color: #17a2b8; font-weight: bold; }
        .status-box {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        .status-good { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-bad { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status-unknown { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ” ÙØ­Øµ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¯ÙˆØ¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</h1>
        
        <div class="debug-section">
            <h3>ğŸš¨ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù…Ø¨Ù„Øº Ø¹Ù†Ù‡Ø§</h3>
            <p><strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong> Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ù…Ø§ Ø²Ø§Ù„Øª Ø¸Ø§Ù‡Ø±Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¯ÙˆØ¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</p>
            <p><strong>Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…ÙØªØ±Ø¶ Ø¥Ø®ÙØ§Ø¤Ù‡Ø§:</strong></p>
            <ul>
                <li>ğŸ¢ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</li>
                <li>ğŸ“… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</li>
                <li>ğŸ“Š Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</li>
                <li>ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø©</li>
            </ul>
        </div>

        <div id="statusBox" class="status-box status-unknown">
            ğŸ”„ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…...
        </div>

        <div class="debug-section">
            <h3>ğŸ§ª Ø£Ø¯ÙˆØ§Øª Ø§Ù„ÙØ­Øµ Ø§Ù„Ø³Ø±ÙŠØ¹</h3>
            
            <button class="debug-button urgent-button" onclick="openMainAppAndTest()">
                ğŸš¨ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙˆØ§Ø®ØªØ¨Ø§Ø± ÙÙˆØ±ÙŠ
            </button>
            
            <button class="debug-button" onclick="checkCurrentState()">
                ğŸ” ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            </button>
            
            <button class="debug-button" onclick="simulateLogin()">
                ğŸ‘¤ Ù…Ø­Ø§ÙƒØ§Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ sa12345
            </button>
            
            <button class="debug-button" onclick="forceHideButtons()">
                ğŸ”’ Ø¥Ø¬Ø¨Ø§Ø± Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            </button>
            
            <button class="debug-button" onclick="clearResults()">
                ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            </button>
        </div>

        <div class="debug-section">
            <h3>ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­Øµ</h3>
            <div id="debugResults" class="results">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©" Ù„Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ...</div>
        </div>

        <div class="debug-section">
            <h3>ğŸ”§ Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø§Ù„Ø¥ØµÙ„Ø§Ø­</h3>
            <ol>
                <li><strong>Ø§ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ:</strong> Ø§Ø¶ØºØ· Ø§Ù„Ø²Ø± Ø§Ù„Ø£Ø­Ù…Ø± Ø£Ø¹Ù„Ø§Ù‡</li>
                <li><strong>Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„:</strong> Ø§Ø³ØªØ®Ø¯Ù… sa12345 ÙƒØ§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±</li>
                <li><strong>ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø±:</strong> Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø±Ø¨Ø¹Ø© Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø©</li>
                <li><strong>Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¸Ø§Ù‡Ø±Ø©:</strong> Ø§ÙØªØ­ Console ÙˆØ§ÙƒØªØ¨: <code>hideAdminButtonsForLimitedUser()</code></li>
                <li><strong>Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙ„Ø§Ø³:</strong> Ø§ÙƒØªØ¨: <code>document.body.classList.contains('limited-user')</code></li>
            </ol>
        </div>

        <div class="debug-section">
            <h3>ğŸ› ï¸ Ø£ÙˆØ§Ù…Ø± Console Ù„Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ÙÙˆØ±ÙŠ</h3>
            <div class="results">
// ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
console.log('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', currentUser);
console.log('Ø§Ù„Ù†ÙˆØ¹:', users[currentUser]?.role);

// ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙ„Ø§Ø³
console.log('ÙƒÙ„Ø§Ø³ limited-user:', document.body.classList.contains('limited-user'));

// Ø¥Ø¬Ø¨Ø§Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ„Ø§Ø³
document.body.classList.add('limited-user');

// Ø¥Ø¬Ø¨Ø§Ø± Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
hideAdminButtonsForLimitedUser();

// ÙØ­Øµ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø®ÙÙŠØ©
const adminButtons = document.querySelectorAll('.admin-only-feature');
console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©:', adminButtons.length);
adminButtons.forEach((btn, i) => {
    console.log(`Ø§Ù„Ø²Ø± ${i+1}:`, btn.textContent?.trim(), 'Ù…Ø®ÙÙŠ:', getComputedStyle(btn).display === 'none');
});
            </div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('debugResults');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            results.textContent += logEntry;
            results.scrollTop = results.scrollHeight;
        }

        function updateStatus(message, type = 'unknown') {
            const statusBox = document.getElementById('statusBox');
            statusBox.textContent = message;
            statusBox.className = `status-box status-${type}`;
        }

        function clearResults() {
            document.getElementById('debugResults').textContent = '';
            log('ğŸ§¹ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬', 'info');
        }

        function checkCurrentState() {
            log('ğŸ” Ø¨Ø¯Ø¡ ÙØ­Øµ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©...', 'info');
            
            // ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù…ÙØªÙˆØ­
            try {
                if (window.opener && window.opener.currentUser) {
                    log('âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', 'success');
                    log(`ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: ${window.opener.currentUser}`, 'info');
                    log(`ğŸ”‘ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${window.opener.users[window.opener.currentUser]?.role}`, 'info');
                    
                    const hasLimitedClass = window.opener.document.body.classList.contains('limited-user');
                    log(`ğŸ·ï¸ ÙƒÙ„Ø§Ø³ limited-user: ${hasLimitedClass}`, hasLimitedClass ? 'success' : 'error');
                    
                    const adminButtons = window.opener.document.querySelectorAll('.admin-only-feature');
                    log(`ğŸ” Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©: ${adminButtons.length}`, 'info');
                    
                    let hiddenCount = 0;
                    adminButtons.forEach((btn, i) => {
                        const isHidden = window.opener.getComputedStyle(btn).display === 'none';
                        if (isHidden) hiddenCount++;
                        log(`   Ø§Ù„Ø²Ø± ${i+1}: ${btn.textContent?.trim()} - ${isHidden ? 'Ù…Ø®ÙÙŠ âœ…' : 'Ø¸Ø§Ù‡Ø± âŒ'}`, isHidden ? 'success' : 'error');
                    });
                    
                    log(`ğŸ“Š Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${hiddenCount}/${adminButtons.length} Ø£Ø²Ø±Ø§Ø± Ù…Ø®ÙÙŠØ©`, hiddenCount === adminButtons.length ? 'success' : 'error');
                    
                    if (hiddenCount === adminButtons.length) {
                        updateStatus('âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù…Ø®ÙÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'good');
                    } else {
                        updateStatus('âŒ Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù…Ø§ Ø²Ø§Ù„Øª Ø¸Ø§Ù‡Ø±Ø©', 'bad');
                    }
                } else {
                    log('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', 'warning');
                    log('ğŸ’¡ Ø§Ø¶ØºØ· "ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙˆØ§Ø®ØªØ¨Ø§Ø± ÙÙˆØ±ÙŠ" Ø£ÙˆÙ„Ø§Ù‹', 'info');
                    updateStatus('âš ï¸ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ØºÙŠØ± Ù…ÙØªÙˆØ­', 'unknown');
                }
            } catch (error) {
                log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: ' + error.message, 'error');
                updateStatus('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙØ­Øµ', 'bad');
            }
        }

        function openMainAppAndTest() {
            log('ğŸš¨ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙÙˆØ±ÙŠ...', 'info');
            
            const testWindow = window.open('index.html', 'mainApp', 'width=1200,height=800');
            
            if (testWindow) {
                log('âœ… ØªÙ… ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', 'success');
                log('â³ Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...', 'info');
                
                setTimeout(() => {
                    try {
                        if (testWindow.setCurrentUser && testWindow.users) {
                            log('ğŸ”‘ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¯ÙˆØ¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©...', 'info');
                            testWindow.setCurrentUser('sa12345');
                            
                            setTimeout(() => {
                                log('ğŸ” ÙØ­Øµ Ø§Ù„Ø£Ø²Ø±Ø§Ø±...', 'info');
                                checkCurrentState();
                            }, 2000);
                        } else {
                            log('âš ï¸ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù… ÙŠØ­Ù…Ù„ Ø¨Ø¹Ø¯ØŒ Ø¬Ø±Ø¨ Ø§Ù„ÙØ­Øµ ÙŠØ¯ÙˆÙŠØ§Ù‹', 'warning');
                        }
                    } catch (error) {
                        log('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŒ Ø¬Ø±Ø¨ ÙŠØ¯ÙˆÙŠØ§Ù‹', 'warning');
                        log('ğŸ’¡ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø¨Ù€ sa12345 ÙˆØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø±', 'info');
                    }
                }, 3000);
            } else {
                log('âŒ ÙØ´Ù„ ÙÙŠ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', 'error');
                updateStatus('âŒ ÙØ´Ù„ ÙÙŠ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', 'bad');
            }
        }

        function simulateLogin() {
            log('ğŸ‘¤ Ù…Ø­Ø§ÙƒØ§Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ sa12345...', 'info');
            
            try {
                if (window.opener && window.opener.setCurrentUser) {
                    window.opener.setCurrentUser('sa12345');
                    log('âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¯ÙˆØ¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©', 'success');
                    
                    setTimeout(() => {
                        checkCurrentState();
                    }, 1000);
                } else {
                    log('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', 'warning');
                }
            } catch (error) {
                log('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø­Ø§ÙƒØ§Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message, 'error');
            }
        }

        function forceHideButtons() {
            log('ğŸ”’ Ø¥Ø¬Ø¨Ø§Ø± Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø±...', 'info');
            
            try {
                if (window.opener && window.opener.hideAdminButtonsForLimitedUser) {
                    window.opener.document.body.classList.add('limited-user');
                    window.opener.hideAdminButtonsForLimitedUser();
                    log('âœ… ØªÙ… Ø¥Ø¬Ø¨Ø§Ø± Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø±', 'success');
                    
                    setTimeout(() => {
                        checkCurrentState();
                    }, 500);
                } else {
                    log('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', 'warning');
                }
            } catch (error) {
                log('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ø¥Ø®ÙØ§Ø¡: ' + error.message, 'error');
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ” Ø£Ø¯Ø§Ø© ÙØ­Øµ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø¯ÙˆØ¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø¬Ø§Ù‡Ø²Ø©', 'success');
            log('ğŸ’¡ Ø§Ø¶ØºØ· "ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙˆØ§Ø®ØªØ¨Ø§Ø± ÙÙˆØ±ÙŠ" Ù„Ù„Ø¨Ø¯Ø¡', 'info');
            updateStatus('ğŸ”„ Ø¬Ø§Ù‡Ø² Ù„Ù„ÙØ­Øµ', 'unknown');
        });
    </script>
</body>
</html>
